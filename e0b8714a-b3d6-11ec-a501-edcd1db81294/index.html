<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="Gradle下载jar包慢到飞起？Github同步一半断了？Docker下载频繁报错？是时候为你的终端统一设置一个代理了。本文以Mac(Unix平台)与HTTP_PROXY为例，讲解如何在终端下进行配置代理。"><meta name="keyword" content="Mac"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>在Mac终端下配置Proxy</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://eu.umami.is/script.js" data-website-id="449a84b6-be9e-49de-a4cc-e0fa6fea1df9"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">在Mac终端下配置Proxy</div><div class="date no-print">2015-11-21 / modified at 2024-03-02 / 1.6k words / 6 mins</div><div class="content"><blockquote><span>️This article has been <strong>over 1 years</strong> since the last update.</span></blockquote><p>Gradle下载jar包慢到飞起？Github同步一半断了？Docker下载频繁报错？是时候为你的终端统一设置一个代理了。本文以Mac(Unix平台)与HTTP_PROXY为例，讲解如何在终端下进行配置代理。</p><span id="more"></span><h2>1. 选择Proxy</h2><p>首先，要购买挑选一个Proxy，购买前需要注意服务商需要能够提供<code>Http Proxy</code>，或者使用转换工具配合SS</p><blockquote><p>AD: 我目前使用的服务器商<a target="_blank" rel="noopener" href="https://cn1.fengzg.net/#/register?code=q33wVW8X">AFF地址</a> ，一定不要年付，防止跑路</p></blockquote><h2>2. 配置终端</h2><h4>2.1. 打开终端Terminal</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查当前Shell</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$0</span></span><br><span class="line"><span class="comment"># 用bash的终端使用这个文件</span></span><br><span class="line">open -t ~/.bash_profile</span><br><span class="line"><span class="comment"># 如果用zsh的话，用下面的文件，没有就新建一个文件</span></span><br><span class="line">open -t ~/.zshenv</span><br></pre></td></tr></table></figure><blockquote><p>.bash_profile 可以理解为Term打开后能够自动执行的脚本文件</p></blockquote><h4>2.2. 在文本中添加如下内容</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#proxy </span></span><br><span class="line">LANTERN=127.0.0.1:8787</span><br><span class="line">COW=<span class="string">&#x27;127.0.0.1:7777&#x27;</span></span><br><span class="line">LO=<span class="string">&#x27;127.0.0.1:1087&#x27;</span></span><br><span class="line">defp=<span class="variable">$LO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># No Proxy</span></span><br><span class="line"><span class="keyword">function</span> noproxy</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">unset</span> http_proxy HTTP_PROXY https_proxy HTTPS_PROXY all_proxy ALL_PROXY ftp_proxy FTP_PROXY dns_proxy DNS_PROXY JAVA_OPTS GRADLE_OPTS MAVEN_OPTS</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;clear proxy done&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> setproxy</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    inArg=<span class="variable">$defp</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    inArg=<span class="variable">$1</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  HOST=$(<span class="built_in">echo</span> <span class="variable">$inArg</span> |<span class="built_in">cut</span> -d: -f1)</span><br><span class="line">  PORT=$(<span class="built_in">echo</span> <span class="variable">$inArg</span> |<span class="built_in">cut</span> -d: -f2)</span><br><span class="line">  http_proxy=http://<span class="variable">$HOST</span>:<span class="variable">$PORT</span></span><br><span class="line">  HTTP_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">  all_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">  ALL_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">  ftp_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">  FTP_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">  dns_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">  DNS_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">  https_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">  HTTPS_PROXY=<span class="variable">$https_proxy</span></span><br><span class="line">  JAVA_OPTS=<span class="string">&quot;-Dhttp.proxyHost=<span class="variable">$HOST</span> -Dhttp.proxyPort=<span class="variable">$PORT</span> -Dhttps.proxyHost=<span class="variable">$HOST</span> -Dhttps.proxyPort=<span class="variable">$PORT</span>&quot;</span></span><br><span class="line">  GRADLE_OPTS=<span class="string">&quot;-Dgradle.user.home=<span class="variable">$HOME</span>/.gradle&quot;</span></span><br><span class="line">  MAVEN_OPTS=<span class="variable">$JAVA_OPTS</span></span><br><span class="line">  no_proxy=<span class="string">&quot;.cn,.aliyun.com,localhost,127.0.0.1,localaddress,.huaweicloud.com,.localdomain.com,.coding.net,.ruby-china.org&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;current proxy is <span class="variable">$&#123;http_proxy&#125;</span>&quot;</span> &gt;&gt; /dev/stderr</span><br><span class="line">  <span class="built_in">export</span> no_proxy http_proxy HTTP_PROXY https_proxy HTTPS_PROXY all_proxy ALL_PROXY ftp_proxy FTP_PROXY dns_proxy DNS_PROXY JAVA_OPTS GRADLE_OPTS MAVEN_OPTS</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setproxy</span><br></pre></td></tr></table></figure><h4>2.3. 保存配置</h4><p>重启shell即可</p><blockquote><p>该方法配置好后，在IDEA等工具的<code>终端</code>下同样有用，但是IDEA本身的maven, gradle需要再次配置</p></blockquote><h2>3. 使用</h2><p>打开终端后，默认会提示正在使用默认的<code>$defp</code>地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">current proxy is http://127.0.0.1:8123</span><br></pre></td></tr></table></figure><p>当不需要时，可以执行<code>noproxy</code>以取消</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">noproxy</span> </span><br><span class="line">clear proxy done</span><br></pre></td></tr></table></figure><p>当然可以在某些情况下手动修改地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">setproxy <span class="variable">$depf</span></span></span><br><span class="line">current proxy is http://127.0.0.1:8123</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">setproxy <span class="variable">$LANTERN</span></span></span><br><span class="line">current proxy is http://127.0.0.1:8787</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">setproxy 127.0.0.1:443</span></span><br><span class="line">current proxy is http://127.0.0.1:443</span><br></pre></td></tr></table></figure><h2>4. 查看效果</h2><p>我们可以执行curl的命令，此网站会自动告诉了你当前的位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl https://ifconfig.co/country</span><br><span class="line"><span class="comment"># ==&gt; Hong Kong</span></span><br></pre></td></tr></table></figure><p>我们也可以使用wget/curl进行SpeedTest</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试下载(run speed <span class="built_in">test</span>)</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget -O /dev/null http://speedtest-sfo1.digitalocean.com/10mb.<span class="built_in">test</span></span></span><br></pre></td></tr></table></figure><p>最难折腾的Gradle现在也飞速了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">折腾Gradle项目</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gradle package -d</span></span><br></pre></td></tr></table></figure><p>最后，体验Git，Brew，Gradle等工具的飞速下载吧！</p><blockquote><p>注意：</p><ul><li>亲测Go，Git over HTTP ，Brew，Curl，Wget，NPM是可以正常使用的，可以达到物理带宽</li><li>不支持<code>git://</code>与<code>svn://</code>，那两个是基于socket的，你可以使用cow/ss配置</li><li>如果需要设置内网地址的正则（比如192，10，172），目前暂时没有完美的方案，只能枚举并手动加入<code>no_proxy</code>中</li><li>Gradle是java相关的，用的不是curl，所以需要<code>JAVA_OPTS</code>作为环境变量，注意这个环境变量只是终端的，而不是IDE下的</li></ul></blockquote><h2>附录</h2><h4>Cow的配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/.cow/rc</span><br><span class="line"><span class="comment"># uncomment </span></span><br><span class="line">alwaysProxy=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 启动 </span></span><br><span class="line">$./cow --debug</span><br></pre></td></tr></table></figure><p>可以配置plist使它自动启动</p><h4>Git-ssh配置</h4><p>需要配置如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 或 创建 文件，如下位置  ~/.ssh/config</span></span><br><span class="line">Host github.com</span><br><span class="line">   HostName github.com</span><br><span class="line">   User git</span><br><span class="line">   <span class="comment"># socks5 代理</span></span><br><span class="line">   ProxyCommand nc -v -x 127.0.0.1:1080 %h %p</span><br></pre></td></tr></table></figure><h4>Intellij下的Gradle/maven配置</h4><p>虽然本文讲的是Terminals的Proxy，但是Intellij的用户也很多。因此也介绍下吧</p><p>首先打开Preference，点击</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Build,Execution,Deployment &gt; Build Tools &gt; Gradle</span><br></pre></td></tr></table></figure><p>配置Gradle VM options(以polipo为例，使用其它工具的自己改端口)</p><p>下文的<code>-d</code>表示啰嗦模式，如果你确认已经ok，可以把它删除。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dhttp.proxyHost=localhost -Dhttp.proxyPort=8123 -Dhttps.proxyHost=localhost -Dhttps.proxyPort=8123 -d</span><br></pre></td></tr></table></figure><p>这样你用鼠标点击Build后，它就会自动走代理了</p><blockquote><p>我个人更推荐直接在终端里跑完(比如mvn package)，然后再打开IDEA，这时所有的依赖已经下载完了</p></blockquote><h4>清空DNS缓存</h4><p>如果仍然无法连接，试试清空DNS。尤其是Git的SSH，非常容易被中间人入侵。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 处理DNS投毒遗留缓存</span></span><br><span class="line"><span class="built_in">sudo</span> killall -HUP mDNSResponder</span><br></pre></td></tr></table></figure><h4>Docker配置</h4><p>Docker分为三种</p><ul><li>下载Docker镜像：在Mac下推荐使用虚拟机，然后基于Linux进行配置即可，个人更推荐直接配置mirror（比如<a target="_blank" rel="noopener" href="https://www.daocloud.io/mirror">daocloud</a>），或者搭建一个Harbor/Artifactory作为前置代理。</li><li>Dockerfile本身构建：考虑在RUN中硬编码配置apt/yum的mirror，或者<code>-e</code>传入HTTP_PROXY环境。过程中需要下载的第三方二进制也建议通过Artifactory私服实现缓存中转。</li><li>Docker容器内部程序运行：不推荐跑在Mac上，建议部署到K8S中走透明网关。</li></ul><p>总体来说，更推荐使用Artifactory私服来进行全局的Docker/yun/二进制等缓存。如果有企业级安全的单向通道需求，欢迎讨论方案。</p><h4>配置Mirror</h4><p>如果你舍不得流量，可以使用mirror而不用代理，比如<a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/">HuaweiCloud Mirror</a></p><h4>PAC与ACL的区别</h4><p>如下为分类</p><ul><li>手动模式：不配置任何ACL/PAC，均在应用侧（比如mvn/SwitchyOmega/HTTP_PROXY）等手动配置方法进行切换，比如如下是配置了专门开一个火狐上外网，safari只用来上内网，npm下载全部走外网。这个方案也是大型IT企业的外网安全审计方案。</li></ul><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="191px" preserveAspectRatio="none" style="width:785px;height:191px;background:#fff" version="1.1" viewBox="0 0 785 191" width="785px" zoomAndPan="magnify" class="kroki">$2<defs/><g><g class="entity" data-entity="browser1" data-source-line="4" data-uid="ent0003" id="entity_browser1"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="190.6387" x="97.54" y="78"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170.6387" x="107.54" y="100.9951">firefox with proxy config</text></g><g class="entity" data-entity="browser2" data-source-line="6" data-uid="ent0004" id="entity_browser2"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="67.6055" x="159.05" y="149"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.6055" x="169.05" y="171.9951">safarai</text></g><g class="entity" data-entity="npm" data-source-line="8" data-uid="ent0005" id="entity_npm"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="180.4053" x="102.65" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.4053" x="112.65" y="29.9951">npm with HTTP_PROXY</text></g><g class="entity" data-entity="ss" data-source-line="10" data-uid="ent0006" id="entity_ss"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="173.4053" x="423.17" y="43"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153.4053" x="433.17" y="65.9951">socket localhost:1080</text></g><g class="entity" data-entity="bypass" data-source-line="12" data-uid="ent0007" id="entity_bypass"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="108.1357" x="671.58" y="149"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.1357" x="681.58" y="171.9951">DirectServer</text></g><g class="entity" data-entity="proxy" data-source-line="14" data-uid="ent0008" id="entity_proxy"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="105.2441" x="673.03" y="43"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.2441" x="683.03" y="65.9951">ProxyServer</text></g><g class="entity" data-entity="user" data-source-line="3" data-uid="ent0002" id="entity_user"><ellipse cx="21.2681" cy="66.5" fill="#454645" rx="8" ry="8" style="stroke:#454645;stroke-width:.5"/><path d="M21.2681,74.5 L21.2681,101.5 M8.2681,82.5 L34.2681,82.5 M21.2681,101.5 L8.2681,116.5 M21.2681,101.5 L34.2681,116.5" fill="none" style="stroke:#454645;stroke-width:.5"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.5361" x="6" y="130.9951">user</text></g><g class="link" data-entity-1="user" data-entity-2="browser1" data-source-line="16" data-uid="lnk9" id="link_user_browser1"><path d="M37.02,96.15 C51.12,96.15 67.67,96.15 91.25,96.15" fill="none" id="user-to-browser1" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="97.25,96.15,88.25,92.15,92.25,96.15,88.25,100.15,97.25,96.15" style="stroke:#454645;stroke-width:1"/></g><g class="link" data-entity-1="user" data-entity-2="browser2" data-source-line="17" data-uid="lnk10" id="link_user_browser2"><path d="M36.8,103.59 C51.83,111.16 76.06,123.05 97.54,132.15 C117.64,140.67 134.9505,147.1894 153.1805,153.7094" fill="none" id="user-to-browser2" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="158.83,155.73,151.7027,148.9328,154.1221,154.0462,149.0086,156.4655,158.83,155.73" style="stroke:#454645;stroke-width:1"/></g><g class="link" data-entity-1="user" data-entity-2="npm" data-source-line="18" data-uid="lnk11" id="link_user_npm"><path d="M36.65,86.78 C45.14,81.49 56.2,74.99 66.54,70.15 C87.68,60.25 105.9815,53.1268 127.2515,45.7468" fill="none" id="user-to-npm" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="132.92,43.78,123.1061,42.9512,128.1963,45.419,125.7285,50.5092,132.92,43.78" style="stroke:#454645;stroke-width:1"/></g><g class="link" data-entity-1="npm" data-entity-2="ss" data-source-line="19" data-uid="lnk12" id="link_npm_ss"><path d="M283.29,35.37 C327.03,40.37 373.4988,45.6784 416.7888,50.6284" fill="none" id="npm-to-ss" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="422.75,51.31,414.2627,46.3135,417.7824,50.742,413.3538,54.2617,422.75,51.31" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.563" x="319.17" y="36.2169">http/socket</text></g><g class="link" data-entity-1="browser1" data-entity-2="ss" data-source-line="20" data-uid="lnk13" id="link_browser1_ss"><path d="M288.48,96.74 C321.71,95.91 359.21,93.81 393.17,89.15 C409.15,86.96 420.2904,84.8881 436.1804,81.1381" fill="none" id="browser1-to-ss" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="442.02,79.76,432.3419,77.9341,437.1537,80.9084,434.1794,85.7202,442.02,79.76" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.563" x="319.17" y="85.2169">http/socket</text></g><g class="link" data-entity-1="browser2" data-entity-2="bypass" data-source-line="21" data-uid="lnk14" id="link_browser2_bypass"><path d="M227.06,167.15 C316.37,167.15 556.31,167.15 665.38,167.15" fill="none" id="browser2-to-bypass" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="671.38,167.15,662.38,163.15,666.38,167.15,662.38,171.15,671.38,167.15" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37.4512" x="491.38" y="163.2169">direct</text></g><g class="link" data-entity-1="ss" data-entity-2="proxy" data-source-line="22" data-uid="lnk15" id="link_ss_proxy"><path d="M596.9,61.15 C622.54,61.15 643.85,61.15 666.61,61.15" fill="none" id="ss-to-proxy" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="672.61,61.15,663.61,57.15,667.61,61.15,663.61,65.15,672.61,61.15" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13.5459" x="627.58" y="57.2169">ss</text></g></g></svg><ul><li>白名单（bypass）模式：所有流量经过本地socket后，ss侧进行判断，假定所有的国外 IP 都被 GFWed，国外全部代理</li></ul><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="183px" preserveAspectRatio="none" style="width:823px;height:183px;background:#fff" version="1.1" viewBox="0 0 823 183" width="823px" zoomAndPan="magnify" class="kroki">$2<defs/><g><g class="cluster" data-entity="ss" data-source-line="8" data-uid="ent0005" id="cluster_ss"><rect fill="none" height="123" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1" width="188" x="428.53" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="172.7578" x="436.1511" y="21.9951">socket localhost:1080</text></g><g class="entity" data-entity="browser" data-source-line="4" data-uid="ent0003" id="entity_browser"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="201.9932" x="97.54" y="69.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181.9932" x="107.54" y="92.8451">browser with proxy config</text></g><g class="entity" data-entity="npm" data-source-line="6" data-uid="ent0004" id="entity_npm"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="180.4053" x="108.33" y="140.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.4053" x="118.33" y="163.8451">npm with HTTP_PROXY</text></g><g class="entity" data-entity="acl" data-source-line="9" data-uid="ent0006" id="entity_acl"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="90" x="477.53" y="49.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="487.53" y="72.8451">ACL Rules</text></g><g class="entity" data-entity="bypass" data-source-line="11" data-uid="ent0007" id="entity_bypass"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="108.1357" x="709.53" y="14.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.1357" x="719.53" y="37.8451">DirectServer</text></g><g class="entity" data-entity="proxy" data-source-line="13" data-uid="ent0008" id="entity_proxy"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="105.2441" x="710.98" y="85.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.2441" x="720.98" y="108.8451">ProxyServer</text></g><g class="entity" data-entity="user" data-source-line="3" data-uid="ent0002" id="entity_user"><ellipse cx="21.2681" cy="94.35" fill="#454645" rx="8" ry="8" style="stroke:#454645;stroke-width:.5"/><path d="M21.2681,102.35 L21.2681,129.35 M8.2681,110.35 L34.2681,110.35 M21.2681,129.35 L8.2681,144.35 M21.2681,129.35 L34.2681,144.35" fill="none" style="stroke:#454645;stroke-width:.5"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.5361" x="6" y="158.8451">user</text></g><g class="link" data-entity-1="user" data-entity-2="browser" data-source-line="15" data-uid="lnk9" id="link_user_browser"><path d="M36.91,120.99 C52.87,117.72 73.9229,113.3982 101.2129,107.7882" fill="none" id="user-to-browser" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="107.09,106.58,97.4689,104.4742,102.1924,107.5868,99.0798,112.3103,107.09,106.58" style="stroke:#454645;stroke-width:1"/></g><g class="link" data-entity-1="user" data-entity-2="npm" data-source-line="16" data-uid="lnk10" id="link_user_npm"><path d="M36.91,126.93 C53.03,130.15 74.4663,134.4245 102.0463,139.9345" fill="none" id="user-to-npm" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="107.93,141.11,99.888,135.4243,103.0269,140.1304,98.3208,143.2693,107.93,141.11" style="stroke:#454645;stroke-width:1"/></g><g class="link" data-entity-1="npm" data-entity-2="ss" data-source-line="17" data-uid="lnk11" id="link_npm_ss"><path d="M289.23,148.7 C336.12,143.31 393.1275,136.7575 438.9338,131.4925 C441.7966,131.1634 444.6158,130.8394 447.386,130.521 C448.771,130.3618 444.1831,130.8891 445.5431,130.7328" fill="none" id="npm-to-ss" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="451.5038,130.0477,442.106,127.1015,446.5366,130.6186,443.0195,135.0492,451.5038,130.0477" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.563" x="330.53" y="132.0669">http/socket</text></g><g class="link" data-entity-1="browser" data-entity-2="ss" data-source-line="18" data-uid="lnk12" id="link_browser_ss"><path d="M299.65,98.57 C322.9125,101.0275 348.1631,103.6944 373.0145,106.3188 C385.4402,107.6309 397.7661,108.9325 409.6938,110.192 C415.6576,110.8217 421.5219,111.4409 427.2494,112.0456 C427.6073,112.0834 421.9979,111.4911 422.3548,111.5288" fill="none" id="browser-to-ss" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="428.3216,112.1588,419.7914,107.2359,423.3493,111.6338,418.9514,115.1917,428.3216,112.1588" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.563" x="330.53" y="97.0669">http/socket</text></g><g class="link" data-entity-1="acl" data-entity-2="bypass" data-source-line="19" data-uid="lnk13" id="link_acl_bypass"><path d="M567.94,61.5 C607.91,55.65 660.7834,47.91 703.2934,41.68" fill="none" id="acl-to-bypass" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="709.23,40.81,699.7451,38.1573,704.2828,41.535,700.9051,46.0728,709.23,40.81" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37.4512" x="641.53" y="42.0669">direct</text></g><g class="link" data-entity-1="acl" data-entity-2="proxy" data-source-line="20" data-uid="lnk14" id="link_acl_proxy"><path d="M567.94,74.69 C608.31,80.77 661.987,88.8459 704.587,95.2659" fill="none" id="acl-to-proxy" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="710.52,96.16,702.2166,90.8635,705.5758,95.4149,701.0244,98.7741,710.52,96.16" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13.5459" x="653.53" y="82.0669">ss</text></g></g></svg><p>不推荐使用的：多个规则混在一起，难以分析定位</p><ul><li>PAC模式：将判断先交给浏览器，再扔给ss客户端，这里流程变复杂了，而且pac是维护的proxylist，需要频繁更新</li><li>全局模式：所有流量（理论上包括系统更新/下载/QQ/音乐等）都经过本地socket后，全部走外网，也就是所谓的Digital nomad。然而事实上很多应用无法透明地支持（比如curl），因此比较鸡肋。这种场景建议把国内应用扔到虚拟机中，并做二级代理。</li><li>ACL自动：版本与实现非常混乱，不推荐折腾</li></ul></div><div class="tags"><a class="tag-link" href="/tags/Mac/" rel="tag">Mac</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry.</a><span> All contents are not allowed to be redistributed or synthesised without an explicit permission.</span></div></footer></div></body></html>