<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="Nomad is an easy-to-use workload orchestrator which is more lightweight and operational than Kubernetes. With nomad, we can create a scalable jenkins cluster running up to 1k jobs on the bare metal machines."><meta name="keyword" content="DevOps,Jenkins,Nomad,System Design"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Resilient Jenkins Agents Provisioning with HashiCorp's Nomad</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"></head><body class="container"><header id="header"><div class="header"><div class="header-left"><div class="author"><div class="author-name"><a href="/">諺</a></div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">Archives</a></li><li style="font-size:.9rem"><a href="/archives" rel="nofollow">zh</a></li><li style="font-size:.9rem"><a href="#" rel="nofollow">|</a></li><li style="font-size:.9rem"><a href="/en" rel="nofollow">en</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">Epistemology</a></li><li><a href="/books" rel="nofollow">読書</a></li></ul></div></div></header><div class="content-wrapper"><div class="post"><section class="article"><div class="title">Resilient Jenkins Agents Provisioning with HashiCorp's Nomad</div><div class="date">2019-10-20に投稿</div><div class="content"><p>Nomad is an easy-to-use workload orchestrator which is more lightweight and operational than Kubernetes. With nomad, we can create a scalable jenkins cluster running up to 1k jobs on the bare metal machines.</p><span id="more"></span><h2>How Agent Works</h2><h4>Bytecodes Interceptor</h4><p>The agent(TCP/WebSocket based) is an asynchronous event-driven application for bytecode commands intercepting. And there are no concepts with Jenkinsfile in the agent, they are all but java bytecodes. Most commands can be considered as pipeline steps(eg: <code>sh</code>/<code>echo</code>)…</p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iNDY5cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo2OTlweDtoZWlnaHQ6NDY5cHg7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA2OTkgNDY5IiB3aWR0aD0iNjk5cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tTUQ1PVs2NGVmNzdjZDVmZTg5MmFmNTY3YjYzODk0MWJhM2E5NF0KY2x1c3RlciBhZ2VudC0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNDU2IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI1NjIiIHg9IjEzMS41IiB5PSI3Ii8+PHBhdGggZD0iTTIwMi41LDcgTDIwMi41LDE2Ljc5OTkgTDE5Mi41LDI2Ljc5OTkgTDEzMS41LDI2Ljc5OTkgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjEiIHg9IjEzNC41IiB5PSIyMS45OTk5Ij5BZ2VudC5qYXI8L3RleHQ+PCEtLU1ENT1bOGVmZGYxNzVmNDNmNDU2NTBmY2Y2ZDg1NThiMTNjOGZdCmNsdXN0ZXIgZS0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTAwIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIyMTUiIHg9IjE1NS41IiB5PSI1MCIvPjxwYXRoIGQ9Ik0yNjguNSw1MCBMMjY4LjUsNTkuNzk5OSBMMjU4LjUsNjkuNzk5OSBMMTU1LjUsNjkuNzk5OSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDMiIHg9IjE1OC41IiB5PSI2NC45OTk5Ij5OSU8gRGlzcGF0Y2hlcjwvdGV4dD48IS0tTUQ1PVs3NmZlOTY1ZjgwMmFiODJmODg0YTgwYzYwMzM4NTgwMF0KY2x1c3RlciBDb21tYW5kUmVjZWl2ZXItLT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI0MCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDk4IiB4PSIxNjMuNSIgeT0iMTkxIi8+PHBhdGggZD0iTTMwMy41LDE5MSBMMzAzLjUsMjAwLjc5OTkgTDI5My41LDIxMC43OTk5IEwxNjMuNSwyMTAuNzk5OSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzAiIHg9IjE2Ni41IiB5PSIyMDUuOTk5OSI+Q29tbWFuZFJlY2VpdmVyPC90ZXh0PjwhLS1NRDU9W2NjYmQ5YWE4YzA0Nzg5OWVhNmJmNGMyM2I1YWE0MDc3XQpjbHVzdGVyIGludGVyY2VwdG9yLS0+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIxNTciIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQyNiIgeD0iMjAzLjUiIHk9IjI0MiIvPjxwYXRoIGQ9Ik01NzcuNSwyNDIgTDU3Ny41LDI1MyBMNTY3LjUsMjYzIEwyMDMuNSwyNjMgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYyIiB4PSIyMDYuNSIgeT0iMjU4LjIiPkludGVyY2VwdGluZ0V4ZWN1dG9yU2VydmljZShmcm9tIDAgdG88L3RleHQ+PHN2ZyB4PSI0NzIuNSIgeT0iMjQzIj48ZGVmcy8+PGc+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMiIgeD0iNSIgeT0iMTYuMiI+Ml4zMjwvdGV4dD48L2c+PC9zdmc+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSI1MTQuNSIgeT0iMjU4LjIiPnRocmVhZHMpPC90ZXh0PjwhLS1NRDU9W2UzOGEwNjU2ZDFhNDc0ZDQ5YjljNjkwN2UzNGY5NmZkXQpjbHVzdGVyIFJlbW90aW5nQ2xhc3NMb2FkZXIyLS0+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI4OCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTc3IiB4PSI0MjguNSIgeT0iMjg3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2MSIgeD0iNDM2LjUiIHk9IjMwMi45OTk5Ij5SZW1vdGluZ0NsYXNzTG9hZGVyMjwvdGV4dD48IS0tTUQ1PVszNWJlMDJlOTQzNTEzOTg5MTVmZDMxZTYwZGViZTRmNV0KY2x1c3RlciBSZW1vdGluZ0NsYXNzTG9hZGVyMS0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iODgiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE3NyIgeD0iMjI3LjUiIHk9IjI4NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjEiIHg9IjIzNS41IiB5PSIzMDIuOTk5OSI+UmVtb3RpbmdDbGFzc0xvYWRlcjE8L3RleHQ+PCEtLU1ENT1bYTZhMmI0MmRjMDU0YTMxZThlOGYyYTQzMjI3ZjFhYzZdCmVudGl0eSBTZWxlY3Rvci0tPjxwYXRoIGQ9Ik0zMDAsODkgTDMwMCwxMTMgTTMwMCwxMDEgTDMxNywxMDEgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48ZWxsaXBzZSBjeD0iMzI5IiBjeT0iMTAxIiBmaWxsPSIjRkVGRUNFIiByeD0iMTIiIHJ5PSIxMiIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjciIHg9IjI4NyIgeT0iMTMwLjk5OTkiPkRpc3BhdGNoZXI8L3RleHQ+PCEtLU1ENT1bZDM3ZTdiNmU0ZTAxZTlkY2IzODhmMTQ3NzQ5M2QyNjVdCmVudGl0eSB3b3JrZXItLT48cGF0aCBkPSJNMTc2LjUsOTYgTDI0Ni41LDk2IEMyNTEuNSw5NiAyNTEuNSwxMDkuNCAyNTEuNSwxMDkuNCBDMjUxLjUsMTA5LjQgMjUxLjUsMTIyLjc5OTkgMjQ2LjUsMTIyLjc5OTkgTDE3Ni41LDEyMi43OTk5IEMxNzEuNSwxMjIuNzk5OSAxNzEuNSwxMDkuNCAxNzEuNSwxMDkuNCBDMTcxLjUsMTA5LjQgMTcxLjUsOTYgMTc2LjUsOTYgIiBmaWxsPSIjRkVGRUNFIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cGF0aCBkPSJNMjQ2LjUsOTYgQzI0MS41LDk2IDI0MS41LDEwOS40IDI0MS41LDEwOS40IEMyNDEuNSwxMjIuNzk5OSAyNDYuNSwxMjIuNzk5OSAyNDYuNSwxMjIuNzk5OSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwIiB4PSIxNzYuNSIgeT0iMTE0Ljk5OTkiPklPIFF1ZXVlPC90ZXh0PjwhLS1NRDU9WzMzYjg4MGMyN2IyZTNiMzE0ZmQxOGMzNjU2Y2YxYThhXQplbnRpdHkgYnl0ZWNvZGVzLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIzNi43OTk5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI4MyIgeD0iNDc1IiB5PSIzMjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MyIgeD0iNDg1IiB5PSIzNDUuOTk5OSI+Qnl0ZWNvZGVzPC90ZXh0PjwhLS1NRDU9WzU0ZjYyM2Q5MGIzMmUzMTgxZTgxMGI3M2U3YzU4YmUwXQplbnRpdHkgYnl0ZWNvZGVzMi0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMzYuNzk5OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iODMiIHg9IjI3NCIgeT0iMzIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjMiIHg9IjI4NCIgeT0iMzQ1Ljk5OTkiPkJ5dGVjb2RlczwvdGV4dD48IS0tTUQ1PVtlNjAwMWFmMTZkNDc3NGUwZmRhZDI3MTU1NzAxMTlkOV0KZW50aXR5IG1hc3Rlci0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMzYuNzk5OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNjMiIHg9IjciIHk9IjkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMiIHg9IjE3IiB5PSIxMTQuOTk5OSI+TWFzdGVyPC90ZXh0PjwhLS1NRDU9W2Q3MzhlYWM1NjkyNGNhZWUwOTdmMWVjOWYyYmFhNjUyXQpsaW5rIG1hc3RlciB0byB3b3JrZXItLT48cGF0aCBkPSJNNzAuMjMsMTA5LjUgQzk3LjE2LDEwOS41IDEzNi4xMSwxMDkuNSAxNjYuMywxMDkuNSAiIGZpbGw9Im5vbmUiIGlkPSJtYXN0ZXItdG8td29ya2VyIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjE3MS40NCwxMDkuNSwxNjIuNDQsMTA1LjUsMTY2LjQ0LDEwOS41LDE2Mi40NCwxMTMuNSwxNzEuNDQsMTA5LjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1IiB4PSI4OC4yNSIgeT0iMTAzLjUiPkNvbW1hbmRzPC90ZXh0PjwhLS1NRDU9WzkxOTQxMTEyMGFhM2ExMjJiMTBkMjc0NDMzNzRlMWZlXQpsaW5rIHdvcmtlciB0byBTZWxlY3Rvci0tPjxwYXRoIGQ9Ik0yNTEuNTIsMTA5LjUgQzI2MS41NCwxMDkuNSAyNzEuNTYsMTA5LjUgMjgxLjU4LDEwOS41ICIgZmlsbD0ibm9uZSIgaWQ9Indvcmtlci10by1TZWxlY3RvciIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSIyODYuODIsMTA5LjUsMjc3LjgyLDEwNS41LDI4MS44MiwxMDkuNSwyNzcuODIsMTEzLjUsMjg2LjgyLDEwOS41IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48IS0tTUQ1PVs4OGFiZmE1ZDg5OWQxYTE0YzJkODU1NWZlNmVkMjQ3Zl0KbGluayBTZWxlY3RvciB0byBDb21tYW5kUmVjZWl2ZXItLT48cGF0aCBkPSJNMjk0LjE1LDEzNC4wOSBDMjgyLjEsMTQ1LjY4IDI2OC4xNiwxNjAuMyAyNTcuNSwxNzUgQzI1NC41MTk0LDE3OS4xMDgxIDI1MS41OCwxODMuMzMzNCAyNDguNjg4MSwxODcuNjQ1OSBDMjQ3Ljk2NTEsMTg4LjcyNCAyNDcuMjQ1MSwxODkuODA3NSAyNDYuNTI4MSwxOTAuODk2MSAiIGZpbGw9Im5vbmUiIGlkPSJTZWxlY3Rvci10by1Db21tYW5kUmVjZWl2ZXIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMjQ2LjUyODEsMTkwLjg5NjEsMjU0LjgxOTEsMTg1LjU4MDEsMjQ5LjI3ODQsMTg2LjcyMDQsMjQ4LjEzOCwxODEuMTc5NywyNDYuNTI4MSwxOTAuODk2MSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PCEtLU1ENT1bYWVkMmRhMzgyNDE1NjJlNDBiNjVjZWEyZTc4MDlhNmJdCkBzdGFydHVtbA0Kc2tpbnBhcmFtIHNoYWRvd2luZyBmYWxzZQ0KDQphZ2VudCBtYXN0ZXIgYXMgIk1hc3RlciIgDQpmcmFtZSBhZ2VudCBhcyAiQWdlbnQuamFyIiB7DQogICAgZnJhbWUgZSBhcyAiTklPIERpc3BhdGNoZXIiew0KICAgIA0KICAgICAgICBib3VuZGFyeSBTZWxlY3RvciBhcyAiRGlzcGF0Y2hlciINCiAgICAgICAgcXVldWUgd29ya2VyIGFzICJJTyBRdWV1ZSINCiAgICB9DQogICAgZnJhbWUgQ29tbWFuZFJlY2VpdmVyIGFzICJDb21tYW5kUmVjZWl2ZXIiIHsNCiAgICAgIGZyYW1lIGludGVyY2VwdG9yIGFzICJJbnRlcmNlcHRpbmdFeGVjdXRvclNlcnZpY2UoZnJvbSAwIHRvIDxtYXRoPjJeMzI8L21hdGg+IHRocmVhZHMpIiB7DQogICAgICAgIHJlY3RhbmdsZSBSZW1vdGluZ0NsYXNzTG9hZGVyMiBhcyAiUmVtb3RpbmdDbGFzc0xvYWRlcjIiIHsNCiAgICAgICAgICAgIHJlY3RhbmdsZSBieXRlY29kZXMgYXMgIkJ5dGVjb2RlcyINCiAgICAgICAgfQ0KICAgICAgICByZWN0YW5nbGUgUmVtb3RpbmdDbGFzc0xvYWRlcjEgYXMgIlJlbW90aW5nQ2xhc3NMb2FkZXIxIiB7DQogICAgICAgICAgICByZWN0YW5nbGUgYnl0ZWNvZGVzMiBhcyAiQnl0ZWNvZGVzIg0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIG1hc3RlciAtPiB3b3JrZXI6IENvbW1hbmRzDQogICAgd29ya2VyIC0+IFNlbGVjdG9yDQogICAgU2VsZWN0b3IgLSAtPiBDb21tYW5kUmVjZWl2ZXINCn0NCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMS40KFN1biBBcHIgMDQgMDg6NDk6MzkgR01UIDIwMjEpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBPcGVuSkRLIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBPcGVuSkRLIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IFVTCi0tPjwvZz48L3N2Zz4="><h4>Master and Agent</h4><p>The master sends and receives commands to the agent via JNLP(TCP). In most situation, a fixed TCP port is recommand.</p><h4>Agent internal</h4><ul><li>Dispatcher: Networking and dispatching in a single thread by NIO.</li><li>InterceptingExecutorService: Running commands by the cached thread pool, corePoolSize is 0, idle time is 60s</li></ul><h2>Resilient Agent Pool</h2><p>Here is an example using HashiCorp’s nomad for scheduling</p><h4>Provision Flow</h4><p>Nomad will use cgroups(Linux Control Groups) and chroot for resource isolation(based on <a target="_blank" rel="noopener" href="https://github.com/opencontainers/runc">runc</a>). Nomad can be replaced with Kubernetes, but Nomad is more easy to install and use.</p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iOTE1cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo2NzdweDtoZWlnaHQ6OTE1cHg7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA2NzcgOTE1IiB3aWR0aD0iNjc3cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZWxsaXBzZSBjeD0iMTQwIiBjeT0iNDguNjk5OCIgZmlsbD0iIzAwMDAwMCIgcng9IjEwIiByeT0iMTAiIHN0eWxlPSJzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS4wOyIvPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMzQuNDAwMSIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMjkiIHg9Ijc1LjUiIHk9Ijc4LjY5OTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkiIHg9Ijg1LjUiIHk9IjEwMC42OTk5Ij5UaW1lcihQZXJpb2RpY1dvcmspPC90ZXh0PjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMzQuNDAwMSIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxNDMiIHg9IjY4LjUiIHk9IjE1NC40OTk4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIzIiB4PSI3OC41IiB5PSIxNzYuNDk5OSI+Tm9kZVByb3Zpc2lvbmVySW52b2tlcjwvdGV4dD48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjM0LjQwMDEiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTE5IiB4PSI4MC41IiB5PSIyNTcuNDk5OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk5IiB4PSI5MC41IiB5PSIyNzkuNSI+dXNlIGV4aXN0aW5nIGFnZW50czwvdGV4dD48ZWxsaXBzZSBjeD0iMTQwIiBjeT0iMzUxLjA5OTkiIGZpbGw9IiNGRkZGRkYiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuMDsiLz48ZWxsaXBzZSBjeD0iMTQwIiBjeT0iMzUxLjA5OTkiIGZpbGw9IiMwMDAwMDAiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojN0Y3RjdGO3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iI0ZFRkVDRSIgcG9pbnRzPSI3NCwyMDguODk5OSwyMDYsMjA4Ljg5OTksMjE4LDIyMC44OTk5LDIwNiwyMzIuODk5OSw3NCwyMzIuODk5OSw2MiwyMjAuODk5OSw3NCwyMDguODk5OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIiIHg9IjE0NCIgeT0iMjQzLjg5OTgiPm5vPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMiIgeD0iNzQiIHk9IjIyNS4yOTk5Ij5qb2JzIHN0YXJ2aW5nIGZvciBleGVjdXRvcnM/PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2IiB4PSIyMTgiIHk9IjIxOC42OTk5Ij55ZXM8L3RleHQ+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIzNC40MDAxIiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjIzOCIgeD0iMjEiIHk9IjQwNC4wOTk5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjE4IiB4PSIzMSIgeT0iNDI2LjEiPm9yZy5qZW5raW5zY2kucGx1Z2lucy5ub21hZC5Ob21hZENsb3VkPC90ZXh0PjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMzQuNDAwMSIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMDAiIHg9IjkwIiB5PSI0NTguNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgwIiB4PSIxMDAiIHk9IjQ4MC41MDAxIj5BZ2VudChwZW5kaW5nKTwvdGV4dD48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjM0LjQwMDEiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iODMiIHg9Ijk4LjUiIHk9Ijc1MS4zNTAxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjMiIHg9IjEwOC41IiB5PSI3NzMuMzUwMiI+QWdlbnQoYnVzeSk8L3RleHQ+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIzNC40MDAxIiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjExOCIgeD0iODEiIHk9IjgyNy4xNTAxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTgiIHg9IjkxIiB5PSI4NDkuMTUwMiI+QWdlbnQoaWRsZS9yZWxlYXNlKTwvdGV4dD48ZWxsaXBzZSBjeD0iMTQwIiBjeT0iODkyLjU1MDIiIGZpbGw9IiNGRkZGRkYiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuMDsiLz48ZWxsaXBzZSBjeD0iMTQwIiBjeT0iODkyLjU1MDIiIGZpbGw9IiMwMDAwMDAiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojN0Y3RjdGO3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjA7IiB4MT0iMTUiIHgyPSIxNSIgeTE9IjEyLjEiIHkyPSI5MDMuNTUwMiIvPjxyZWN0IGZpbGw9IiNGQUVCRDciIGhlaWdodD0iODkxLjQ1MDIiIHN0eWxlPSJzdHJva2U6I0ZBRUJENztzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEzMCIgeD0iMzU0IiB5PSIxMi4xIi8+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIzNC40MDAxIiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjEyMCIgeD0iMzYwIiB5PSI1MzAuODUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDAiIHg9IjM3MCIgeT0iNTUyLjg1MDEiPmNhbGN1bGF0ZSByZXNvdXJjZXM8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjA7IiB4MT0iMzU0IiB4Mj0iMzU0IiB5MT0iMTIuMSIgeTI9IjkwMy41NTAyIi8+PHJlY3QgZmlsbD0iI0ZBRUJENyIgaGVpZ2h0PSI4OTEuNDUwMiIgc3R5bGU9InN0cm9rZTojRkFFQkQ3O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTQ0IiB4PSI0ODQiIHk9IjEyLjEiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjM0LjQwMDEiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTIyIiB4PSI0OTAiIHk9IjYwMy4yMDAxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyIiB4PSI1MDAiIHk9IjYyNS4yMDAyIj5ydW5jKG9wZW5jb250YWluZXIpPC90ZXh0PjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMzQuNDAwMSIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMDciIHg9IjQ5Ny41IiB5PSI2NzkuMDAwMSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg3IiB4PSI1MDcuNSIgeT0iNzAxLjAwMDEiPnJ1bm5pbmcgYWdlbnQuamFyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6Mi4wOyIgeDE9IjQ4NCIgeDI9IjQ4NCIgeTE9IjEyLjEiIHkyPSI5MDMuNTUwMiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6Mi4wOyIgeDE9IjYyOCIgeDI9IjYyOCIgeTE9IjEyLjEiIHkyPSI5MDMuNTUwMiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjE0MCIgeDI9IjE0MCIgeTE9IjU4LjY5OTgiIHkyPSI3OC42OTk4Ii8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSIxMzYsNjguNjk5OCwxNDAsNzguNjk5OCwxNDQsNjguNjk5OCwxNDAsNzIuNjk5OCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTQwIiB4Mj0iMTQwIiB5MT0iMTEzLjA5OTkiIHkyPSIxNTQuNDk5OCIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTM2LDE0NC40OTk4LDE0MCwxNTQuNDk5OCwxNDQsMTQ0LjQ5OTgsMTQwLDE0OC40OTk4IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMDUiIHg9IjE0NCIgeT0iMTM0Ljc5OTgiPmh1ZHNvbi5tb2RlbC5Mb2FkU3RhdGlzdGljcy5jbG9jayhkZnQgMTBzKTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNDAiIHgyPSIxNDAiIHkxPSIyOTEuOSIgeTI9IjM0MC4wOTk5Ii8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSIxMzYsMzMwLjA5OTksMTQwLDM0MC4wOTk5LDE0NCwzMzAuMDk5OSwxNDAsMzM0LjA5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0NSIgeD0iMTQ0IiB5PSIzMjAuMzk5OSI+SmVua2lucyBpbnRlcm5hbCBMb2FkQmFsYW5jZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTQwIiB4Mj0iMTQwIiB5MT0iMjMyLjg5OTkiIHkyPSIyNTcuNDk5OSIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTM2LDI0Ny40OTk5LDE0MCwyNTcuNDk5OSwxNDQsMjQ3LjQ5OTksMTQwLDI1MS40OTk5IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIyMTgiIHgyPSIyOTkiIHkxPSIyMjAuODk5OSIgeTI9IjIyMC44OTk5Ii8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSIyOTUsMjk2Ljc5OTksMjk5LDMwNi43OTk5LDMwMywyOTYuNzk5OSwyOTksMzAwLjc5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjI5OSIgeDI9IjI5OSIgeTE9IjIyMC44OTk5IiB5Mj0iMzg0LjA5OTkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIyOTkiIHgyPSIxNDAiIHkxPSIzODQuMDk5OSIgeTI9IjM4NC4wOTk5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTQwIiB4Mj0iMTQwIiB5MT0iMzg0LjA5OTkiIHkyPSI0MDQuMDk5OSIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTM2LDM5NC4wOTk5LDE0MCw0MDQuMDk5OSwxNDQsMzk0LjA5OTksMTQwLDM5OC4wOTk5IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNDAiIHgyPSIxNDAiIHkxPSIxODguODk5OSIgeTI9IjIwOC44OTk5Ii8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSIxMzYsMTk4Ljg5OTksMTQwLDIwOC44OTk5LDE0NCwxOTguODk5OSwxNDAsMjAyLjg5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjE0MCIgeDI9IjE0MCIgeTE9IjQzOC41IiB5Mj0iNDU4LjUiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjEzNiw0NDguNSwxNDAsNDU4LjUsMTQ0LDQ0OC41LDE0MCw0NTIuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTQwIiB4Mj0iMTQwIiB5MT0iNzg1Ljc1MDIiIHkyPSI4MjcuMTUwMSIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTM2LDgxNy4xNTAxLDE0MCw4MjcuMTUwMSwxNDQsODE3LjE1MDEsMTQwLDgyMS4xNTAxIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDIiIHg9IjE0NCIgeT0iODA3LjQ1MDEiPkFsbCBwZW5kaW5nIGpvYnMgZG9uZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNDAiIHgyPSIxNDAiIHkxPSI4NjEuNTUwMiIgeTI9Ijg4MS41NTAyIi8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSIxMzYsODcxLjU1MDIsMTQwLDg4MS41NTAyLDE0NCw4NzEuNTUwMiwxNDAsODc1LjU1MDIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjU1MSIgeDI9IjU1MSIgeTE9IjYzNy42MDAyIiB5Mj0iNjc5LjAwMDEiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjU0Nyw2NjkuMDAwMSw1NTEsNjc5LjAwMDEsNTU1LDY2OS4wMDAxLDU1MSw2NzMuMDAwMSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjgiIHg9IjU1NSIgeT0iNjU5LjMwMDEiPmNncm91cC9jaHJvb3Q8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTQwIiB4Mj0iMTQwIiB5MT0iNDkyLjkwMDEiIHkyPSI1MTUuODUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNDAiIHgyPSI0MjAiIHkxPSI1MTUuODUiIHkyPSI1MTUuODUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI0MjAiIHgyPSI0MjAiIHkxPSI1MTUuODUiIHkyPSI1MzAuODUiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjQxNiw1MjAuODUsNDIwLDUzMC44NSw0MjQsNTIwLjg1LDQyMCw1MjQuODUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxMiIgeD0iMTQ0IiB5PSI1MDkuMzUiPnN1Ym1pdCBhIGpvYiBjYWxsZWQgamVua2lucy1hZ2VudC14eHgubm9tYWQ8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNDIwIiB4Mj0iNDIwIiB5MT0iNTY1LjI1MDEiIHkyPSI1ODguMjAwMSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjQyMCIgeDI9IjU1MSIgeTE9IjU4OC4yMDAxIiB5Mj0iNTg4LjIwMDEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1NTEiIHgyPSI1NTEiIHkxPSI1ODguMjAwMSIgeTI9IjYwMy4yMDAxIi8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSI1NDcsNTkzLjIwMDEsNTUxLDYwMy4yMDAxLDU1NSw1OTMuMjAwMSw1NTEsNTk3LjIwMDEiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMiIgeD0iNDI0IiB5PSI1ODEuNzAwMSI+YmluIHBhY2tpbmcgYWxnb3JpdGhtPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjU1MSIgeDI9IjU1MSIgeTE9IjcxMy40MDAyIiB5Mj0iNzM2LjM1MDEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1NTEiIHgyPSIxNDAiIHkxPSI3MzYuMzUwMSIgeTI9IjczNi4zNTAxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTQwIiB4Mj0iMTQwIiB5MT0iNzM2LjM1MDEiIHkyPSI3NTEuMzUwMSIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTM2LDc0MS4zNTAxLDE0MCw3NTEuMzUwMSwxNDQsNzQxLjM1MDEsMTQwLDc0NS4zNTAxIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAiIHg9IjU1NSIgeT0iNzI5Ljg1MDEiPkpOTFAgY29ubmVjdGlvbiBiYWNrPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYyIiB4PSIxNTMuNSIgeT0iMzAuMDk5OSI+SmVua2luczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTEiIHg9IjM2My41IiB5PSIzMC4wOTk5Ij5Ob21hZFNlcnZlcjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MyIgeD0iNTI0LjUiIHk9IjMwLjA5OTkiPkhvc3RPUzwvdGV4dD48IS0tTUQ1PVtiNWQ4M2M4NGU0ZTg5OWY4NzliZDkyMjQyZjU3ZmZlNV0KQHN0YXJ0dW1sDQpza2lucGFyYW0gc2hhZG93aW5nIGZhbHNlDQoNCnxKZW5raW5zfA0Kc3RhcnQNCjpUaW1lcihQZXJpb2RpY1dvcmspOw0KLT5odWRzb24ubW9kZWwuTG9hZFN0YXRpc3RpY3MuY2xvY2soZGZ0IDEwcyk7DQo6Tm9kZVByb3Zpc2lvbmVySW52b2tlcjsNCmlmIChqb2JzIHN0YXJ2aW5nIGZvciBleGVjdXRvcnM/KSB0aGVuIChubykNCiAgOnVzZSBleGlzdGluZyBhZ2VudHM7DQogIC0+SmVua2lucyBpbnRlcm5hbCBMb2FkQmFsYW5jZXI7DQogIHN0b3A7DQplbHNlICh5ZXMpDQplbmRpZg0KOm9yZy5qZW5raW5zY2kucGx1Z2lucy5ub21hZC5Ob21hZENsb3VkOw0KOkFnZW50KHBlbmRpbmcpOw0KLT5zdWJtaXQgYSBqb2IgY2FsbGVkIGplbmtpbnMtYWdlbnQteHh4Lm5vbWFkOw0KfCNBbnRpcXVlV2hpdGV8Tm9tYWRTZXJ2ZXJ8DQo6Y2FsY3VsYXRlIHJlc291cmNlczsNCi0+YmluIHBhY2tpbmcgYWxnb3JpdGhtOw0KfCNBbnRpcXVlV2hpdGV8SG9zdE9TfA0KOnJ1bmMob3BlbmNvbnRhaW5lcik7DQotPmNncm91cC9jaHJvb3Q7DQoNCjpydW5uaW5nIGFnZW50LmphcjsNCnxKZW5raW5zfA0KLT5KTkxQIGNvbm5lY3Rpb24gYmFjazsNCjpBZ2VudChidXN5KTsNCi0+QWxsIHBlbmRpbmcgam9icyBkb25lOw0KOkFnZW50KGlkbGUvcmVsZWFzZSk7DQpzdG9wDQpAZW5kdW1sDQoKUGxhbnRVTUwgdmVyc2lvbiAxLjIwMjEuNChTdW4gQXByIDA0IDA4OjQ5OjM5IEdNVCAyMDIxKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogT3BlbkpESyBSdW50aW1lIEVudmlyb25tZW50CkpWTTogT3BlbkpESyA2NC1CaXQgU2VydmVyIFZNCkRlZmF1bHQgRW5jb2Rpbmc6IFVURi04Ckxhbmd1YWdlOiBlbgpDb3VudHJ5OiBVUwotLT48L2c+PC9zdmc+"><p>when your resources(CPU/Memory) are exhausted, the nomad will refused to create agent, and shows</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Placement Failures</span><br><span class="line">  jenkins-slave-taskgroup 1 unplaced</span><br><span class="line">    Resources exhausted on 1 node</span><br><span class="line">    Dimension memory exhausted on 1 node</span><br></pre></td></tr></table></figure><p>Even the real usage of the CPU is not full.</p><h4>Networking</h4><p>Nomad uses the Serf protocal to communicate with the nodes.</p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iNDczcHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo3MTJweDtoZWlnaHQ6NDczcHg7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA3MTIgNDczIiB3aWR0aD0iNzEycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tTUQ1PVtjMDE4ODYzZmUyMzA0ZTBjYTk1MjYxNjYxMTMyNmI2ZV0KY2x1c3RlciBIb3N0LS0+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIyMzAiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjY5OSIgeD0iNyIgeT0iNyIvPjxwYXRoIGQ9Ik03NCw3IEw3NCwxNi43OTk5IEw2NCwyNi43OTk5IEw3LDI2Ljc5OTkgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTciIHg9IjEwIiB5PSIyMS45OTk5Ij5Ib3N0IE9TPC90ZXh0PjwhLS1NRDU9W2EyMTgzOWE2NzBkMDA0NThmNzg3YzQ2YjM1OTdhZGZkXQpjbHVzdGVyIHJ1bmMtLT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjE0NyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNTYwIiB4PSIxMTQiIHk9IjU4Ii8+PHBhdGggZD0iTTM3Miw1OCBMMzcyLDY3Ljc5OTkgTDM2Miw3Ny43OTk5IEwxMTQsNzcuNzk5OSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNDgiIHg9IjExNyIgeT0iNzIuOTk5OSI+Q29udGFpbmVycyhiYXNlZCBvbiBSdW5jKTJHSHovNEc8L3RleHQ+PCEtLU1ENT1bMGNjYmU2NmExMmZkOGEzYTMxMDM1ZWM2OTg0NGYwNWRdCmVudGl0eSBub21hZC0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iNTMuNTk5OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNjQiIHg9IjIzIiB5PSIxMTQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NCIgeD0iMzMiIHk9IjEzNy45OTk5Ij5Ob21hZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNiIgeD0iMzMiIHk9IjE1NC43OTk5Ij5BZ2VudDwvdGV4dD48IS0tTUQ1PVs4MzM0MDJlOTA4NzY0NDIxN2M5OWY1MTE4ZTBkMDk1Nl0KZW50aXR5IGFnZW50MS0tPjxwb2x5Z29uIGZpbGw9IiNGRUZFQ0UiIHBvaW50cz0iMTU3LjUsMTExLDE2Ny41LDEwMSwyNTQuNSwxMDEsMjU0LjUsMTcxLjM5OTgsMjQ0LjUsMTgxLjM5OTgsMTU3LjUsMTgxLjM5OTgsMTU3LjUsMTExIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIyNDQuNSIgeDI9IjI1NC41IiB5MT0iMTExIiB5Mj0iMTAxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTU3LjUiIHgyPSIyNDQuNSIgeTE9IjExMSIgeTI9IjExMSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjI0NC41IiB4Mj0iMjQ0LjUiIHkxPSIxMTEiIHkyPSIxODEuMzk5OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0IiB4PSIxNzIuNSIgeT0iMTM0Ljk5OTkiPkFnZW50MTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MyIgeD0iMTc2LjUiIHk9IjE1MS43OTk5Ij41MDBNSHo8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQiIHg9IjE3Mi41IiB5PSIxNjguNTk5OCI+MUcgUkFNPC90ZXh0PjwhLS1NRDU9W2ZmODk2OTkxZTExYzFjYWViNzAwNGYxNzE5YWJiNDE2XQplbnRpdHkgYWdlbnQyLS0+PHBvbHlnb24gZmlsbD0iI0ZFRkVDRSIgcG9pbnRzPSIyODkuNSwxMTEsMjk5LjUsMTAxLDM4Ni41LDEwMSwzODYuNSwxNzEuMzk5OCwzNzYuNSwxODEuMzk5OCwyODkuNSwxODEuMzk5OCwyODkuNSwxMTEiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjM3Ni41IiB4Mj0iMzg2LjUiIHkxPSIxMTEiIHkyPSIxMDEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIyODkuNSIgeDI9IjM3Ni41IiB5MT0iMTExIiB5Mj0iMTExIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMzc2LjUiIHgyPSIzNzYuNSIgeTE9IjExMSIgeTI9IjE4MS4zOTk4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDQiIHg9IjMwNC41IiB5PSIxMzQuOTk5OSI+QWdlbnQyPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzIiB4PSIzMDguNSIgeT0iMTUxLjc5OTkiPjUwME1IejwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NCIgeD0iMzA0LjUiIHk9IjE2OC41OTk4Ij4xRyBSQU08L3RleHQ+PCEtLU1ENT1bYzgwZGIzZTFjZjI0Mjg2NjQ0MzhlZjU5ZmQ1Y2JiNjJdCmVudGl0eSBhZ2VudDMtLT48cG9seWdvbiBmaWxsPSIjRkVGRUNFIiBwb2ludHM9IjQyMS41LDExMSw0MzEuNSwxMDEsNTE4LjUsMTAxLDUxOC41LDE3MS4zOTk4LDUwOC41LDE4MS4zOTk4LDQyMS41LDE4MS4zOTk4LDQyMS41LDExMSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTA4LjUiIHgyPSI1MTguNSIgeTE9IjExMSIgeTI9IjEwMSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjQyMS41IiB4Mj0iNTA4LjUiIHkxPSIxMTEiIHkyPSIxMTEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1MDguNSIgeDI9IjUwOC41IiB5MT0iMTExIiB5Mj0iMTgxLjM5OTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NCIgeD0iNDM2LjUiIHk9IjEzNC45OTk5Ij5BZ2VudDM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTMiIHg9IjQ0MC41IiB5PSIxNTEuNzk5OSI+NTAwTUh6PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU0IiB4PSI0MzYuNSIgeT0iMTY4LjU5OTgiPjFHIFJBTTwvdGV4dD48IS0tTUQ1PVs4OWZiYzQ3MTQ4ZTE4ZDg2ZTUzN2VjMzJiZTlmYmE2ZV0KZW50aXR5IGFnZW50NC0tPjxwb2x5Z29uIGZpbGw9IiNGRUZFQ0UiIHBvaW50cz0iNTUzLjUsMTExLDU2My41LDEwMSw2NTAuNSwxMDEsNjUwLjUsMTcxLjM5OTgsNjQwLjUsMTgxLjM5OTgsNTUzLjUsMTgxLjM5OTgsNTUzLjUsMTExIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI2NDAuNSIgeDI9IjY1MC41IiB5MT0iMTExIiB5Mj0iMTAxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTUzLjUiIHgyPSI2NDAuNSIgeTE9IjExMSIgeTI9IjExMSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjY0MC41IiB4Mj0iNjQwLjUiIHkxPSIxMTEiIHkyPSIxODEuMzk5OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0IiB4PSI1NjguNSIgeT0iMTM0Ljk5OTkiPkFnZW50NDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MyIgeD0iNTcyLjUiIHk9IjE1MS43OTk5Ij41MDBNSHo8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQiIHg9IjU2OC41IiB5PSIxNjguNTk5OCI+MUcgUkFNPC90ZXh0PjwhLS1NRDU9W2U2MDAxYWYxNmQ0Nzc0ZTBmZGFkMjcxNTU3MDExOWQ5XQplbnRpdHkgbWFzdGVyLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIzNi43OTk5IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI2NyIgeD0iMzA0LjUiIHk9IjMwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ3IiB4PSIzMTQuNSIgeT0iMzIzLjk5OTkiPkplbmtpbnM8L3RleHQ+PCEtLU1ENT1bZGQ4MjQ1MWUxZGQ5MmZlM2RhMDE4NTM3NTBmNDlmZjZdCmVudGl0eSBzZXJ2ZXItLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjUzLjU5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjY0IiB4PSIxMzUiIHk9IjQxNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0IiB4PSIxNDUiIHk9IjQzNy45OTk5Ij5Ob21hZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MCIgeD0iMTQ1IiB5PSI0NTQuNzk5OSI+U2VydmVyPC90ZXh0PjwhLS1NRDU9WzhiZWY1NjhjYjUyZTE4M2UyZDhkMjU1Njk5NTA4NTBjXQpsaW5rIG5vbWFkIHRvIHJ1bmMtLT48cGF0aCBkPSJNODcuMTksMTQxIEM5Mi45LDE0MSA5OC42MSwxNDEgMTA0LjMyMTIsMTQxIEMxMDcuMTc2OSwxNDEgMTEwLjAzMjgsMTQxIDExMi44ODkyLDE0MSBDMTEzLjI0NjMsMTQxIDExMy42MDMzLDE0MSAxMTMuOTYwNCwxNDEgIiBmaWxsPSJub25lIiBpZD0ibm9tYWQtcnVuYyIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PCEtLU1ENT1bZmM3NGYyMzYzYzdkMDdmZGQ1MGI1NmRhYTdhZDUzMzZdCmxpbmsgbWFzdGVyIHRvIHNlcnZlci0tPjxwYXRoIGQ9Ik0zMTMuMTQsMzM3LjAyIEMyODQuMzIsMzU3LjMyIDIzNi41OSwzOTAuOTYgMjAzLjU1LDQxNC4yNCAiIGZpbGw9Im5vbmUiIGlkPSJtYXN0ZXItdG8tc2VydmVyIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjE5OS4xOSw0MTcuMzEsMjA4Ljg0ODksNDE1LjM4NTEsMjAzLjI3NCw0MTQuNDI1NSwyMDQuMjMzNyw0MDguODUwNiwxOTkuMTksNDE3LjMxIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OSIgeD0iMjY4IiB5PSIzODEiPlJlc291cmNlIHJlcXVlc3Q8L3RleHQ+PCEtLU1ENT1bM2UyYTNlMzJkMGJjY2JjZDI4M2QwYWQ0ZGVjZWMyZGFdCmxpbmsgc2VydmVyIHRvIG5vbWFkLS0+PHBhdGggZD0iTTE1Ny4yMiw0MTMuOTggQzEzNi4wMywzNTcuNiA4Ni4wOSwyMjQuNzEgNjQuODQsMTY4LjE4ICIgZmlsbD0ibm9uZSIgaWQ9InNlcnZlci1ub21hZCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTMiIHg9IjEyOSIgeT0iMzI0Ij5TY2hlZHVsaW5nKHNlcmYpPC90ZXh0PjwhLS1NRDU9W2NlZjAwMjUwNzE5MDllNjA2MWM1ODg5M2MzNTkyMDA0XQpsaW5rIGFnZW50MSB0byBtYXN0ZXItLT48cGF0aCBkPSJNMjI4Ljk2LDE4MS4yIEMyNDEuMDIsMjAwLjg4IDI1Ni40OSwyMjQuNzggMjcyLDI0NSBDMjg3LjEyLDI2NC43MiAzMDYuNDYsMjg1LjUzIDMyMC4yOSwyOTkuNzcgIiBmaWxsPSJub25lIiBpZD0iYWdlbnQxLW1hc3RlciIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToxLjAsMy4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMyIiB4PSIyOTMiIHk9IjI2NyI+Sk5MUDwvdGV4dD48IS0tTUQ1PVtiMzM0ZDYzMGY1MTgwNTBmMzQ3ZDMyNzJlMmUxOGM3ZF0KbGluayBhZ2VudDIgdG8gbWFzdGVyLS0+PHBhdGggZD0iTTMzOCwxODEuMzkgQzMzOCwyMTguMzcgMzM4LDI3Mi4wNCAzMzgsMjk5LjYzICIgZmlsbD0ibm9uZSIgaWQ9ImFnZW50Mi1tYXN0ZXIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6MS4wLDMuMDsiLz48IS0tTUQ1PVtmMDNlOTdhYWY1NjI0ZDEwYTc2ODBiNDVhOTgxZGFiMl0KbGluayBhZ2VudDMgdG8gbWFzdGVyLS0+PHBhdGggZD0iTTQ0Ny4wNCwxODEuMiBDNDM0Ljk4LDIwMC44OCA0MTkuNTEsMjI0Ljc4IDQwNCwyNDUgQzM4OC44OCwyNjQuNzIgMzY5LjU0LDI4NS41MyAzNTUuNzEsMjk5Ljc3ICIgZmlsbD0ibm9uZSIgaWQ9ImFnZW50My1tYXN0ZXIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6MS4wLDMuMDsiLz48IS0tTUQ1PVtlZmRjNGI4OGZkZDkxZjM5OTNkMDc0OGJkYzgxZWM3Zl0KbGluayBhZ2VudDQgdG8gbWFzdGVyLS0+PHBhdGggZD0iTTU4NC42NCwxODEuMjUgQzU3My40NSwyMDIuNjQgNTU3LjA0LDIyOC4xMiA1MzYsMjQ1IEM0ODYuNzQsMjg0LjUxIDQxMy45NiwzMDMuNjkgMzcxLjczLDMxMiAiIGZpbGw9Im5vbmUiIGlkPSJhZ2VudDQtbWFzdGVyIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjEuMCwzLjA7Ii8+PCEtLU1ENT1bZDY0MTJkNzVkOWVjMTA3MzlmYTI3NGRkMjAzZjIwZmNdCkBzdGFydHVtbA0Kc2tpbnBhcmFtIHNoYWRvd2luZyBmYWxzZQ0KDQphZ2VudCBtYXN0ZXIgYXMgIkplbmtpbnMiDQphZ2VudCBzZXJ2ZXIgYXMgIk5vbWFkXG5TZXJ2ZXIiDQpmcmFtZSBIb3N0IGFzICJIb3N0IE9TInsNCiAgICBhZ2VudCBub21hZCBhcyAiTm9tYWRcbkFnZW50Ig0KICAgIGZyYW1lIHJ1bmMgYXMgIkNvbnRhaW5lcnMoYmFzZWQgb24gUnVuYykyR0h6LzRHIiB7DQogICAgICBub2RlIGFnZW50MSBhcyAiQWdlbnQxIFxuIDUwME1IelxuMUcgUkFNIg0KICAgICAgbm9kZSBhZ2VudDIgYXMgIkFnZW50MiBcbiA1MDBNSHpcbjFHIFJBTSINCiAgICAgIG5vZGUgYWdlbnQzIGFzICJBZ2VudDMgXG4gNTAwTUh6XG4xRyBSQU0iDQogICAgICBub2RlIGFnZW50NCBhcyAiQWdlbnQ0IFxuIDUwME1IelxuMUcgUkFNIg0KICAgIH0NCiAgICBub21hZCAtIHJ1bmMNCn0NCm1hc3RlciAtIC0+IHNlcnZlcjogUmVzb3VyY2UgcmVxdWVzdA0Kc2VydmVyIC0gLSBub21hZDogU2NoZWR1bGluZyhzZXJmKQ0KYWdlbnQxIH5+IG1hc3RlcjogSk5MUA0KYWdlbnQyIH5+IG1hc3Rlcg0KYWdlbnQzIH5+IG1hc3Rlcg0KYWdlbnQ0IH5+IG1hc3Rlcg0KQGVuZHVtbA0KClBsYW50VU1MIHZlcnNpb24gMS4yMDIxLjQoU3VuIEFwciAwNCAwODo0OTozOSBHTVQgMjAyMSkKKEdQTCBzb3VyY2UgZGlzdHJpYnV0aW9uKQpKYXZhIFJ1bnRpbWU6IE9wZW5KREsgUnVudGltZSBFbnZpcm9ubWVudApKVk06IE9wZW5KREsgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogVVMKLS0+PC9nPjwvc3ZnPg=="><p>Jenkins to Nomad</p><ul><li>Requests for provision containers who are running agent.jar</li><li>Health: Nomad will check the JVM process and recreate if required.</li></ul><p>Jenkins to Agent</p><ul><li>Two sides of the channel via TCP/WebSocket.</li><li>Persistence: for <code>DurableTask</code>, there is a file-cookie based solution.</li></ul><h2>Troubleshoot</h2><h4>Cold startup performance</h4><ul><li>Using Java 11 with AOT and CDS</li><li>Using shared/cached directory</li></ul><h4>Agent health check</h4><ul><li>Process: Nomad will checking the JVM process. recreate if required. For more your can register a Consul <code>Service</code> in hcl.</li><li>More: Jenkins master will check heartbeat, free disk/RAM.</li></ul><h4>Self-Healing</h4><ul><li>Q: What will happen when the agent.jar or container is failover?</li><li>A: The error shows “hudson.remoting.RequestAbortedException: java.nio.channels.AsynchronousCloseException”. The job will always terminate event the agent restarts.</li></ul><ul><li>Q: When the master is forced to restarts?</li><li>A: for <code>DurableTask</code>, there is a file-cookie based solution, jobs will be recoveryed.</li></ul><h4>You may need to do with the agent</h4><ul><li>Add some idle timeout just in case of the jenkins master is failover.</li></ul><h4>Parking thread leaks problem</h4><p>Firstly, we submit a stress test pipeline job for creating a lot of threads.</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pipeline&#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        label <span class="string">&quot;test&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    stages&#123;</span><br><span class="line">        stage(<span class="string">&#x27;init&#x27;</span>)&#123;</span><br><span class="line">            steps&#123;</span><br><span class="line">                script &#123;</span><br><span class="line">                    <span class="keyword">def</span> jobs = [:]</span><br><span class="line">                    <span class="number">100.</span>times&#123;</span><br><span class="line">                        jobs[<span class="string">&quot;task&quot;</span> + it] =&#123; echo <span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    parallel(jobs);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You will see the threads increased during the workload, but when all jobs are done, parking threads are <strong>not released</strong>. By using <code>top</code>, you may find <strong>your native threads are also not released</strong> which means</p><ul><li>You will leak native stack size(or Xss).</li><li>You will leak <code>/proc/sys/kernel/threads-max</code> .</li><li>You will face <code>Unable to create new native thread</code> when you deploy too many agents.</li></ul><p>What you need to do</p><ul><li>Add more heap memory in the case of OOM.</li><li>Add more ulimt or decrease Xss(eg: <code>-Xss256K</code>) or restart the agent periodically in case of the parking thread are not released.</li><li>Modify code of the threadpool. (Only if you really have too many agents.)</li></ul><h2>Reference</h2><ul><li><a target="_blank" rel="noopener" href="https://blog.codecentric.de/en/2017/11/microservices-nomad-consul/">https://blog.codecentric.de/en/2017/11/microservices-nomad-consul/</a></li></ul></div><div class="tags"><a class="tag-link" href="/tags/DevOps/" rel="tag">DevOps</a><a class="tag-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><a class="tag-link" href="/tags/Nomad/" rel="tag">Nomad</a><a class="tag-link" href="/tags/System-Design/" rel="tag">System Design</a></div></section><ul class="nav"><li>Prev:<a href="/jenkins-multiple-masters-using-consul/">Jenkins multiple masters using Consul</a></li><li>Next:<a href="/plantuml-for-hexo-plugin-released/">PlantUML for Hexo plugin released</a></li></ul><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the<a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus</a></noscript></div></div></div></div><footer><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry</a><span>.</span></div></footer><script>window.onload=function(){var a,e,n,t;a=window,e=document,t="script",n="ga",a.GoogleAnalyticsObject=n,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=+new Date,n=e.createElement(t),t=e.getElementsByTagName(t)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",t.parentNode.insertBefore(n,t),ga("create","UA-102296742-1","auto"),ga("send","pageview")}</script></body></html>