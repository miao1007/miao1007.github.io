<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="本文总结一下常见的分布式与高可用方案"><meta name="keyword" content="PaaS"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>常见分布式系统介绍</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-102296742-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-102296742-1")</script><meta name="generator" content="Hexo 5.4.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">常见分布式系统介绍</div><div class="date">2021-08-04 / modified at 2023-01-29</div><div class="content"><p>本文总结一下常见的分布式与高可用方案</p><span id="more"></span><h2>什么是分布式系统</h2><p>定义一：A distributed system is a collection of autonomous computing elements that appears to its users as a single coherent/koˈhɪrǝnt/ system.</p><p>翻译过来，就是对用户看起来是单体，但是实际上是由独立自治的计算组件聚合而成的系统。</p><ul><li>autonomous: having the freedom to act independently.</li><li>computing elements: node, can be HPC, VM, Thread and more.</li><li>collection: is often organized as an overlay network. Eg: p2p, TCP/IP</li><li>coherent: a distributed system is coherent if it behaves according to the expectations of its users. 注意这里是用户对<strong>主观</strong>现象的观测，而非客观的定义，如果换个较真的人观察出破绽，那么它就是不是&quot;单体&quot;了。</li></ul><p>定义二：A distributed system consists of a collection of distinct processes which are spatially separated, and which com- municate with one another by exchanging messages</p><p>一个分布式系统是多个空间上分离，使用内部通信的独立<strong>流程</strong>组合的集合。</p><p>从这里的定义可以看出，分布式系统是一个经验归纳大于理论演绎的定义。它涉及到了同一（identity）关系的哲学问题（忒修斯之船），与时间颗粒度息息相关。</p><blockquote><p>HPC集群的CPU换了2次，内存换了3次，它还是这套集群吗？虚拟机通过热迁移技术切换到另一个机柜的设备中，它还是你的VM吗？</p></blockquote><h2>可靠和可用</h2><p><strong>High availability</strong> (<strong>HA</strong>) is a characteristic of a system which aims to ensure an agreed level of operational performance, usually <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Uptime">uptime</a>, for a higher than normal period.</p> <?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="303px" preserveAspectRatio="none" style="width:856px;height:303px;background:#fff" version="1.1" viewBox="0 0 856 303" width="856px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="86" x="10" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="20" y="155.5889">resilience</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="306" x="146" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="286" x="156" y="99.292">&#21487;&#38752;&#24615;&#65306;&#65288;&#26080;&#25925;&#38556;&#26102;&#38388;&#65289;/&#65288;&#26080;&#25925;&#38556;&#26102;&#38388; + 1&#65289;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="342" x="502" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="322" x="512" y="42.9951">&#36890;&#36807;&#23458;&#35266;&#30340;&#22120;&#20214;&#22833;&#25928;&#24471;&#21040;&#30340;&#32479;&#35745;&#25968;&#25454;&#65292;&#19981;&#28041;&#21450;&#20462;&#22797;&#12290;</text><path d="M452,94.4453 L462,94.4453 C477,94.4453 477,38.1484 492,38.1484 L502,38.1484 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="333" x="502" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="313" x="512" y="99.292">&#21407;&#23376;&#31995;&#32479;&#65306;&#27604;&#22914;&#20803;&#20214;&#32769;&#21270;/&#28201;&#24230;&#31561;&#23458;&#35266;&#30340;&#32479;&#35745;&#25968;&#25454;&#12290;</text><path d="M452,94.4453 L462,94.4453 C477,94.4453 477,94.4453 492,94.4453 L502,94.4453 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="291" x="502" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="271" x="512" y="155.5889">&#32452;&#21512;&#31995;&#32479;&#65306;&#28041;&#21450;&#21040;&#21407;&#23376;&#31995;&#32479;&#30340;&#20018;&#32852;/&#24182;&#32852;&#32452;&#21512;</text><path d="M452,94.4453 L462,94.4453 C477,94.4453 477,150.7422 492,150.7422 L502,150.7422 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M96,150.7422 L106,150.7422 C121,150.7422 121,94.4453 136,94.4453 L146,94.4453 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="345" x="146" y="217.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="325" x="156" y="240.0342">&#21487;&#29992;&#24615;&#65306;&#65288;&#26080;&#25925;&#38556;&#26102;&#38388;&#65289;/&#65288;&#26080;&#25925;&#38556;&#26102;&#38388;+&#20462;&#22797;&#26102;&#38388;&#65289;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="188" x="541" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="551" y="211.8857">&#25552;&#39640;&#26080;&#25925;&#38556;&#26102;&#38388;&#65288;&#21487;&#38752;&#24615;&#65289;</text><path d="M491,235.1875 L501,235.1875 C516,235.1875 516,207.0391 531,207.0391 L541,207.0391 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="104" x="541" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="551" y="268.1826">&#25552;&#39640;&#20462;&#22797;&#36895;&#24230;</text><path d="M491,235.1875 L501,235.1875 C516,235.1875 516,263.3359 531,263.3359 L541,263.3359 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M96,150.7422 L106,150.7422 C121,150.7422 121,235.1875 136,235.1875 L146,235.1875 " fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><p>分布式系统一般讨论的是高可用中的可靠性的组合场景，比如冗余或者切片。</p><blockquote><p>分布式不等于高可用(availability)，不等于高可靠(durability)，不等于弹性伸缩，不等于冗余，不等于克服了单点故障，也不提供掉电保护。</p></blockquote><h2>硬件分布式系统分类</h2><p>硬件上主要体现在冗余性，虚拟直通，存算分离上</p> <?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="500px" preserveAspectRatio="none" style="width:819px;height:500px;background:#fff" version="1.1" viewBox="0 0 819 500" width="819px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="76" x="10" y="231.1133"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="20" y="254.1084">&#30828;&#20214;&#20132;&#20184;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="90" x="136" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="146" y="99.292">&#26426;&#26588;&#21487;&#29992;&#24615;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="99" x="276" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="286" y="42.9951">&#21452;Bond&#32593;&#21345;</text><path d="M226,94.4453 L236,94.4453 C251,94.4453 251,38.1484 266,38.1484 L276,38.1484 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="109" x="276" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="286" y="99.292">&#20887;&#20313;&#30005;&#28304;/UPS</text><path d="M226,94.4453 L236,94.4453 C251,94.4453 251,94.4453 266,94.4453 L276,94.4453 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="90" x="276" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="286" y="155.5889">&#36328;&#26426;&#26588;&#37096;&#32626;</text><path d="M226,94.4453 L236,94.4453 C251,94.4453 251,150.7422 266,150.7422 L276,150.7422 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M86,249.2617 L96,249.2617 C111,249.2617 111,94.4453 126,94.4453 L136,94.4453 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="209" x="136" y="315.5586"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="189" x="146" y="338.5537">OpenStack/&#31169;&#26377;&#20113;(eg: HCS)</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="48" x="395" y="231.1133"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="405" y="254.1084">&#35745;&#31639;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="62" x="493" y="217.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="503" y="240.0342">&#34394;&#25311;&#21270;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="151" x="605" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="615" y="211.8857">&#23436;&#20840;&#34394;&#25311;&#21270;/emulate</text><path d="M555,235.1875 L565,235.1875 C580,235.1875 580,207.0391 595,207.0391 L605,207.0391 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="80" x="605" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="615" y="268.1826">DMA&#30452;&#36890;</text><path d="M555,235.1875 L565,235.1875 C580,235.1875 580,263.3359 595,263.3359 L605,263.3359 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M443,249.2617 L453,249.2617 C468,249.2617 468,235.1875 483,235.1875 L493,235.1875 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="62" x="493" y="273.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="503" y="296.3311">&#35064;&#37329;&#23646;</text><path d="M443,249.2617 L453,249.2617 C468,249.2617 468,291.4844 483,291.4844 L493,291.4844 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M345,333.707 L355,333.707 C370,333.707 370,249.2617 385,249.2617 L395,249.2617 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="48" x="395" y="385.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="405" y="408.9248">&#23384;&#20648;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="76" x="493" y="329.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="503" y="352.6279">&#23545;&#35937;&#23384;&#20648;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="188" x="619" y="329.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="629" y="352.6279">&#22522;&#20110;&#23545;&#35937;&#23384;&#20648;&#30340;&#20998;&#24067;&#24335;&#23384;&#20648;</text><path d="M569,347.7813 L579,347.7813 C594,347.7813 594,347.7813 609,347.7813 L619,347.7813 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M443,404.0781 L453,404.0781 C468,404.0781 468,347.7813 483,347.7813 L493,347.7813 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="109" x="493" y="385.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="503" y="408.9248">&#22359;&#23384;&#20648;/&#20113;&#30828;&#30424;</text><path d="M443,404.0781 L453,404.0781 C468,404.0781 468,404.0781 483,404.0781 L493,404.0781 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="180" x="493" y="442.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="503" y="465.2217">RoCE(&#26412;&#36136;&#19978;&#20173;&#28982;&#26159;&#22797;&#21046;)</text><path d="M443,404.0781 L453,404.0781 C468,404.0781 468,460.375 483,460.375 L493,460.375 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M345,333.707 L355,333.707 C370,333.707 370,404.0781 385,404.0781 L395,404.0781 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="50" x="395" y="442.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="405" y="465.2217">SDN</text><path d="M345,333.707 L355,333.707 C370,333.707 370,460.375 385,460.375 L395,460.375 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M86,249.2617 L96,249.2617 C111,249.2617 111,333.707 126,333.707 L136,333.707 " fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><p>上述可以确保VM与内存数据几乎不会丢失，但是VM中运行的软件本身仍然可能挂掉。</p><h2>软件分布式系统分类</h2><h3>理论的维度</h3><p>假如需要进行专业的体系化CS课程，至少半年，可以参考如下</p><ul><li><p>Distributed Computing Systems(<a target="_blank" rel="noopener" href="https://www.ics.uci.edu/~cs230/lectures20/distrsyslectureset1-win21.pdf">cs230</a>)</p><ul><li><p>时间：物理时间（比如ntp同步）与逻辑时间（比如term）</p></li><li><p>状态：全局状态与快照</p></li><li><p>Distributed Coordination and Resource Management</p></li><li><p>Messaging and Communication in Distributed Systems</p></li><li><p>Fault Tolerance in Distributed Systems</p></li></ul></li><li><p>Security in Distributed Systems</p></li><li><p>Distributed Database Management and Transaction Processin(<a target="_blank" rel="noopener" href="https://www.ics.uci.edu/~cs223/">cs223</a>)</p></li><li><p>Distributed Objects and Middleware Platforms(<a target="_blank" rel="noopener" href="https://www.ics.uci.edu/~cs237/">cs237</a>)</p></li></ul><p>这里理论比工程更重要，而且是存粹的理论。</p><h3>工程上的规格</h3><p>假如只是进行概念的理解，如下即可</p><ul><li><p>一致性：强一致性、最终一致性</p></li><li><p>需要分布管理的内容：比如元数据（比如k-v、状态、健康）、二进制（比如S3/Git/SVN/Lustre/边缘SDN）</p></li><li><p>协商方向：</p><ul><li>Push：下游需要全量数据时才使用，比如Database streaming/mirroring，RAFT</li><li>Pull：下游需要部分数据即可，如二进制增量缓存/看门狗等场景</li></ul></li><li><p>Proxy：比如<a target="_blank" rel="noopener" href="https://about.gitlab.com/solutions/geo/">Gitlab geo</a>的写入方案，cloudflare的Worker读写方案</p></li><li><p>节点角色：广义上也可以看作政治权利，比如说“不”的权利。</p></li><li><p>故障转移时间RTO：一般商用需要为10s</p></li></ul><h3>按照组网架构分类</h3><p>下面即使部署了很多台，但是实际干活的就一台master，非活跃的Master只有转发/读写分离的功能</p> <?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="241px" preserveAspectRatio="none" style="width:535px;height:241px;background:#fff" version="1.1" viewBox="0 0 535 241" width="535px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="85.1875" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="34" x="10" y="77.0371"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="100.0322">&#37096;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="116.3291">&#32626;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="132.626">&#26550;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="148.9229">&#26500;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="117" x="94" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="104" y="42.9951">&#21333;&#26426;/Stateless</text><path d="M44,119.6309 L54,119.6309 C69,119.6309 69,38.1484 84,38.1484 L94,38.1484 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="157" x="94" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="104" y="99.292">&#20027;&#20174;&#20004;&#26426;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="104" y="115.5889">(primary/secondary)</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="48" x="301" y="70.3711"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="311" y="93.3662">&#28909;&#22791;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="104" x="399" y="42.2227"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="409" y="65.2178">&#25346;&#20102;&#31435;&#21051;&#21482;&#35835;</text><path d="M349,88.5195 L359,88.5195 C374,88.5195 374,60.3711 389,60.3711 L399,60.3711 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="124" x="399" y="98.5195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="409" y="121.5146">&#33258;&#21160;failover&#20999;&#25442;</text><path d="M349,88.5195 L359,88.5195 C374,88.5195 374,116.668 389,116.668 L399,116.668 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M251,102.5938 L261,102.5938 C276,102.5938 276,88.5195 291,88.5195 L301,88.5195 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="48" x="301" y="126.668"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="311" y="149.6631">&#20919;&#22791;</text><path d="M251,102.5938 L261,102.5938 C276,102.5938 276,144.8164 291,144.8164 L301,144.8164 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M44,119.6309 L54,119.6309 C69,119.6309 69,102.5938 84,102.5938 L94,102.5938 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="76" x="94" y="182.9648"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="104" y="205.96">&#19977;&#21488;&#20197;&#19978;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="147" x="220" y="182.9648"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="230" y="205.96">&#36873;&#20030;/&#22797;&#21046;/&#36716;&#21457;/&#36335;&#30001;</text><path d="M170,201.1133 L180,201.1133 C195,201.1133 195,201.1133 210,201.1133 L220,201.1133 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M44,119.6309 L54,119.6309 C69,119.6309 69,201.1133 84,201.1133 L94,201.1133 " fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><blockquote><p>上述方案假设在高速LAN中横向通信，不含容灾。上述成本基本上都比托管的服务更高，也不包含硬件存储架构方案。<br>事实上云服务厂商的硬件实现的分布式存储才是最简方案。</p></blockquote><h4>工程经验类方法</h4><p>工程实践的核心思路是将本侧的分布式难题交给下游供应商，进而提高收益，比如</p><ul><li><p>将业务分解为meta/worker/proxy等无状态的服务，比如sonarqube的ComputeEngine</p></li><li><p>用硬件的RDMA/NFS转换问题，比如Oracle RAC就强制要求超高性能内网，否则直接停机。</p></li><li><p>用软件的数据库/Raft，基于元数据实现分片，比如在三个数据中心搭建<code>2+2+1</code>的高可用的quorum</p></li><li><p>用云服务，比如FSFO(by Oracle)，或者GaussDB<a target="_blank" rel="noopener" href="https://bbs.huaweicloud.com/blogs/256888">参考</a>，用Aurora把难题扔给AWS</p></li></ul><h2>主备方案介绍</h2><p>大部分有状态的主备份方案为冗余方案（hot standby），难点在同步复制协议（Primary/Replica）。它要求的性能与可用性（断电前写入存储介质）中取得平衡</p><ul><li>协议：主要为基于Journaling的checkpoint和reply的方案</li><li>强一致类型：写入IO性能变弱，可以实现读写分离，任意一台挂掉需要人工介入</li><li>最终一致类型：基本上就是靠事件+定时同步，可以容灾</li></ul><p>常见如下</p><table><thead><tr><th>类型</th><th>复制协议</th><th>Monitoring node</th><th>自动恢复</th><th>读写分离</th></tr></thead><tbody><tr><td>Jenkins</td><td>NFS/rsync innotify</td><td>0</td><td>需要手动</td><td>NA</td></tr><tr><td>GitLab(unofficial)</td><td>NFS/rsync innotify</td><td>keepalived</td><td>Y</td><td>勉强够用</td></tr><tr><td>MySQL</td><td>Async Binlog</td><td>0</td><td>需要手动</td><td>N</td></tr><tr><td>pg-pool</td><td>WAL</td><td>1</td><td>需要手动</td><td>Y</td></tr><tr><td>Redis</td><td>Async AOF/RDB</td><td>0</td><td>需要手动</td><td>N</td></tr><tr><td>Redis(Sentinel)</td><td>Async AOF/RDB</td><td>1~3(Sentinel)</td><td>Y，比如5s</td><td>N</td></tr><tr><td>Artifactory-Remote</td><td>Pull</td><td>NA</td><td>NA</td><td>NA</td></tr></tbody></table><p>从我个人实践的角度，热主备方案投资收益极为鸡肋</p><ul><li>大部分都无法扩容，中间的代理层导致应用定位复杂（需要 Client/Agent 来判活，比如pg-pool的连接池，我在项目中出现2次大故障，定位起来资料困乏）</li><li>冗余框架出了问题仍然要手动维修，万一真挂了，重启也修不好</li><li>自动切换需要客户端适配协商，引入繁琐的非业务用例</li></ul><p>上述方案其实意义有限，甚至整体恢复时间不如单机版+定期备份</p><h2>三台以上高可用方案</h2><h4>一致性与过期(consistance and stale)的定义</h4><p>谈到一致性，很多人就想到了被阿里带歪的CAP八股文，我们要先明确</p><ul><li>一致需要<strong>同时</strong>考虑客户端与服务端的配置，你搭建三台ZK，并不代表你的业务就有了强一致性</li><li>CAP并不是要求三选二，而是大部分情况“我全都要”，而且主要是客户端自己决定</li></ul><p>举一些例子</p><ul><li>当etcd挂了，K8S里的应用服务仍然能跑，Calico也勉强能用，客户端缓存还在，只是部分控制域的功能丢失</li><li>Consul既支持客户端绕一圈获取协商结果（network roundtrips，耗时长），也支持直接读取单节点数据，甚至客户端/Sidecar节点本身就有一定缓存</li><li>Oracle RAC是集群数据库，它需要处理转账等强一致业务，一旦RDMA集群间断网就直接停机。</li><li>你在两个数据中心部署了2+3个zk，然后突然停电，其中三台挂了，另外两台也照样完蛋。</li></ul><h4>基于元数据管理的方案</h4><p>元数据既可以通过集中管理，也可以通过分散管理</p><ul><li>分散：区块链、GlusterFS与DHT BT下载等场景，以及跨DC的<a target="_blank" rel="noopener" href="https://github.blog/2016-09-07-building-resilience-in-spokes/">Github Spokes</a> 服务</li><li>集中：常见的BT的tracker协议，以及RAFT/Paxo/Gossip（这里讨论）</li></ul><p>我们首先要明确，在中心化的一致性元数据管理中，并没有实现扩容</p><ul><li>用于数据面（比如分片）与控制面（比如路由）的元数据存储仍然需要<strong>中心化的权威存储介质</strong>(have a single primary copy at any moment.)，并基于强一致性实现多机冗余。就算是DHT表，也不会同步到所有客户端机器。</li><li>剩余节点是无状态运算机，可以扩容</li></ul><p>跨WAN的Region场景，默认是不可靠的，一般要最终一致性，这种流程可以简化容灾，跨Site同步等流程。</p> <?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="810px" preserveAspectRatio="none" style="width:588px;height:810px;background:#fff" version="1.1" viewBox="0 0 588 810" width="588px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="85.1875" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="34" x="10" y="361.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="384.4795">&#20998;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="400.7764">&#21306;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="417.0732">&#26041;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="433.3701">&#26696;</text><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="83" x="94" y="265.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="104" y="288.1826">&#36328;DC&#22797;&#21046;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="104" y="304.4795">&#24378;&#19968;&#33268;</text><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="131" x="227" y="96.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="237" y="119.292">&#20803;&#25968;&#25454;&#26381;&#21153;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="237" y="135.5889">Metadata server</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="145" x="408" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="418" y="42.9951">Zookeeper(PAXO)</text><path d="M358,122.5938 L368,122.5938 C383,122.5938 383,38.1484 398,38.1484 L408,38.1484 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="97" x="408" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="418" y="99.292">Etcd(RAFT)</text><path d="M358,122.5938 L368,122.5938 C383,122.5938 383,94.4453 398,94.4453 L408,94.4453 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="168" x="408" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="418" y="155.5889">Nomad/Consul(RAFT)</text><path d="M358,122.5938 L368,122.5938 C383,122.5938 383,150.7422 398,150.7422 L408,150.7422 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="132" x="408" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="418" y="211.8857">RedisRaft(RAFT)</text><path d="M358,122.5938 L368,122.5938 C383,122.5938 383,207.0391 398,207.0391 L408,207.0391 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M177,291.4844 L187,291.4844 C202,291.4844 202,122.5938 217,122.5938 L227,122.5938 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="84" x="227" y="377.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="237" y="400.7764">Metadata</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="237" y="417.0732">Router</text><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="76" x="361" y="265.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="18" x="371" y="288.1826">KV</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="371" y="304.4795">Partition</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="61" x="487" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="497" y="268.1826">Calico</text><path d="M437,291.4844 L447,291.4844 C462,291.4844 462,263.3359 477,263.3359 L487,263.3359 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="61" x="487" y="301.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="497" y="324.4795">envoy</text><path d="M437,291.4844 L447,291.4844 C462,291.4844 462,319.6328 477,319.6328 L487,319.6328 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M311,404.0781 L321,404.0781 C336,404.0781 336,291.4844 351,291.4844 L361,291.4844 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="50" x="361" y="414.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="371" y="437.0732">DHT</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="87" x="461" y="357.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="471" y="380.7764">GlusterFS</text><path d="M411,432.2266 L421,432.2266 C436,432.2266 436,375.9297 451,375.9297 L461,375.9297 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="74" x="461" y="414.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="471" y="437.0732">CephFS</text><path d="M411,432.2266 L421,432.2266 C436,432.2266 436,432.2266 451,432.2266 L461,432.2266 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="63" x="461" y="470.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="471" y="493.3701">Lustre</text><path d="M411,432.2266 L421,432.2266 C436,432.2266 436,488.5234 451,488.5234 L461,488.5234 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M311,404.0781 L321,404.0781 C336,404.0781 336,432.2266 351,432.2266 L361,432.2266 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="113" x="361" y="526.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="371" y="549.667">Sidecar-proxy</text><path d="M311,404.0781 L321,404.0781 C336,404.0781 336,544.8203 351,544.8203 L361,544.8203 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M177,291.4844 L187,291.4844 C202,291.4844 202,404.0781 217,404.0781 L227,404.0781 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M44,404.0781 L54,404.0781 C69,404.0781 69,291.4844 84,291.4844 L94,291.4844 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="111" x="94" y="659.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="104" y="682.2607">&#36328;Region&#22797;&#21046;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="104" y="698.5576">&#26368;&#32456;&#19968;&#33268;&#24615;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="143" x="255" y="582.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="265" y="605.9639">Rsync/Binlog/AOF</text><path d="M205,685.5625 L215,685.5625 C230,685.5625 230,601.1172 245,601.1172 L255,601.1172 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="68" x="255" y="639.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="265" y="662.2607">Eureka</text><path d="M205,685.5625 L215,685.5625 C230,685.5625 230,657.4141 245,657.4141 L255,657.4141 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="68" x="255" y="695.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="265" y="718.5576">Gossip</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="80" x="373" y="695.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="383" y="718.5576">Portworx</text><path d="M323,713.7109 L333,713.7109 C348,713.7109 348,713.7109 363,713.7109 L373,713.7109 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M205,685.5625 L215,685.5625 C230,685.5625 230,713.7109 245,713.7109 L255,713.7109 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="62" x="255" y="751.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="265" y="774.8545">&#21152;&#23494;&#31867;</text><path d="M205,685.5625 L215,685.5625 C230,685.5625 230,770.0078 245,770.0078 L255,770.0078 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M44,404.0781 L54,404.0781 C69,404.0781 69,685.5625 84,685.5625 L94,685.5625 " fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><h2>路由与失败检查(Failure Models)</h2><p>这里主要需要纠结pull和push，超时和失败的定义。</p> <?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="331px" preserveAspectRatio="none" style="width:540px;height:331px;background:#fff" version="1.1" viewBox="0 0 540 331" width="540px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="69" x="10" y="146.668"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="20" y="169.6631">routing</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="95" x="129" y="62.2227"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="139" y="85.2178">heartbeats</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="48" x="274" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="284" y="42.9951">TCP</text><path d="M224,80.3711 L234,80.3711 C249,80.3711 249,38.1484 264,38.1484 L274,38.1484 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="108" x="274" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="284" y="99.292">health probe</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="71" x="432" y="48.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="442" y="71.1436">metrics</text><path d="M382,94.4453 L392,94.4453 C407,94.4453 407,66.2969 422,66.2969 L432,66.2969 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="96" x="432" y="104.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="442" y="127.4404">load status</text><path d="M382,94.4453 L392,94.4453 C407,94.4453 407,122.5938 422,122.5938 L432,122.5938 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M224,80.3711 L234,80.3711 C249,80.3711 249,94.4453 264,94.4453 L274,94.4453 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M79,164.8164 L89,164.8164 C104,164.8164 104,80.3711 119,80.3711 L129,80.3711 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="50" x="129" y="160.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="139" y="183.7373">APM</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="164" x="229" y="160.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="239" y="183.7373">real application traffic</text><path d="M179,178.8906 L189,178.8906 C204,178.8906 204,178.8906 219,178.8906 L229,178.8906 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M79,164.8164 L89,164.8164 C104,164.8164 104,178.8906 119,178.8906 L129,178.8906 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="131" x="129" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="139" y="268.1826">Update Strategy</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="73" x="310" y="217.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="320" y="240.0342">Rolling?</text><path d="M260,263.3359 L270,263.3359 C285,263.3359 285,235.1875 300,235.1875 L310,235.1875 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103" x="310" y="273.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="320" y="296.3311">Drain node?</text><path d="M260,263.3359 L270,263.3359 C285,263.3359 285,291.4844 300,291.4844 L310,291.4844 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M79,164.8164 L89,164.8164 C104,164.8164 104,263.3359 119,263.3359 L129,263.3359 " fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><h2>总结</h2><p>只要是异步系统（无法区分超时），共识在有限时间内不能完美地完成</p><p>作为技术人员，不要因为面试八股文就陷入100%分布式高可用、弹性伸缩、容灾且完美调度等理想模型中，而是意识到理论的不完美、技术的局限性，现实的不确定性，才能更好地理解分布式系统。</p><p>扩容是系统工程，物理机房的密度，交换机的插孔，功耗等都会限制最大值，上述方案最终实现的也不过是“昂贵的数据孤岛”。甚至你在专心搞高可用时，你的友商投入人力做Demo已经把项目拿下了。</p></div><div class="tags"><a class="tag-link" href="/tags/PaaS/" rel="tag">PaaS</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry</a><span>.</span></div></footer></div></body></html>