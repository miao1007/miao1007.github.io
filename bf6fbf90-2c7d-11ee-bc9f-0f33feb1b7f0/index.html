<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="Implementing flexible, fine-grained permission management is an essential component of robust software design. This article will walk through various authorization system designs that aim to achieve that goal."><meta name="keyword" content="Authz,Security,System Design"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Design a Fine-grained Authorization System with RBAC and ACL</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://eu.umami.is/script.js" data-website-id="449a84b6-be9e-49de-a4cc-e0fa6fea1df9"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">Design a Fine-grained Authorization System with RBAC and ACL</div><div class="date no-print">2023-07-30 / modified at 2026-01-20 / 2.3k words / 14 mins</div><div class="content"><p>Implementing flexible, fine-grained permission management is an essential component of robust software design. This article will walk through various authorization system designs that aim to achieve that goal.</p><span id="more"></span><blockquote><p>The design may be <strong>too complicated</strong> for start-up teams, as the article is mainly for enterprise applications that have lots of compliance policies.</p></blockquote><h2>What is authorization management</h2><h3>Terminologies</h3><p>An authorization management(Authz) constitutes subjects, namespaces, resources and capabilities.</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="MINDMAP" height="617px" preserveAspectRatio="none" style="width:757px;height:617px;background:#fff" version="1.1" viewBox="0 0 757 617" width="757px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="60.1611" x="10" y="289.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.1611" x="20" y="312.6279">Authz</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="79.6299" x="120.1611" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.6299" x="130.1611" y="42.9951">Subjects</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="129.2451" x="249.791" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.2451" x="259.791" y="42.9951">Users &amp; Groups</text><path d="M199.791,38.1484 L209.791,38.1484 C224.791,38.1484 224.791,38.1484 239.791,38.1484 L249.791,38.1484" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M70.1611,307.7813 L80.1611,307.7813 C95.1611,307.7813 95.1611,38.1484 110.1611,38.1484 L120.1611,38.1484" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="109.667" x="120.1611" y="289.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.667" x="130.1611" y="312.6279">Namespaces</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="340.5166" x="279.8281" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="320.5166" x="289.8281" y="99.292">Metadata: Namespaces's name, description...</text><path d="M229.8281,307.7813 L239.8281,307.7813 C254.8281,307.7813 254.8281,94.4453 269.8281,94.4453 L279.8281,94.4453" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="92.4336" x="279.8281" y="225.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.4336" x="289.8281" y="248.1826">Resources</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="323.2832" x="422.2617" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="303.2832" x="432.2617" y="155.5889">Metadata: Resources's name, description...</text><path d="M372.2617,243.3359 L382.2617,243.3359 C397.2617,243.3359 397.2617,150.7422 412.2617,150.7422 L422.2617,150.7422" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="159.3027" x="422.2617" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.3027" x="432.2617" y="211.8857">Asserts: Granularity</text><path d="M372.2617,243.3359 L382.2617,243.3359 C397.2617,243.3359 397.2617,207.0391 412.2617,207.0391 L422.2617,207.0391" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="216.5947" x="422.2617" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196.5947" x="432.2617" y="268.1826">Capabilities on the resource</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131.2979" x="432.2617" y="284.4795">(Immutable string)</text><path d="M372.2617,243.3359 L382.2617,243.3359 C397.2617,243.3359 397.2617,271.4844 412.2617,271.4844 L422.2617,271.4844" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="109.7217" x="422.2617" y="317.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.7217" x="432.2617" y="340.7764">Assignments</text><path d="M372.2617,243.3359 L382.2617,243.3359 C397.2617,243.3359 397.2617,335.9297 412.2617,335.9297 L422.2617,335.9297" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M229.8281,307.7813 L239.8281,307.7813 C254.8281,307.7813 254.8281,243.3359 269.8281,243.3359 L279.8281,243.3359" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="236.2002" x="279.8281" y="374.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="216.2002" x="289.8281" y="397.0732">Capabilities on the namespace</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131.2979" x="289.8281" y="413.3701">(Immutable string)</text><path d="M229.8281,307.7813 L239.8281,307.7813 C254.8281,307.7813 254.8281,400.375 269.8281,400.375 L279.8281,400.375" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="102.4277" x="279.8281" y="446.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.4277" x="289.8281" y="469.667">Assignment</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="264.583" x="432.2559" y="446.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="244.583" x="442.2559" y="469.667">Subjects with capabilities assigned</text><path d="M382.2559,464.8203 L392.2559,464.8203 C407.2559,464.8203 407.2559,464.8203 422.2559,464.8203 L432.2559,464.8203" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M229.8281,307.7813 L239.8281,307.7813 C254.8281,307.7813 254.8281,464.8203 269.8281,464.8203 L279.8281,464.8203" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="94.6553" x="279.8281" y="502.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.6553" x="289.8281" y="525.9639">Ownership</text><path d="M229.8281,307.7813 L239.8281,307.7813 C254.8281,307.7813 254.8281,521.1172 269.8281,521.1172 L279.8281,521.1172" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M70.1611,307.7813 L80.1611,307.7813 C95.1611,307.7813 95.1611,307.7813 110.1611,307.7813 L120.1611,307.7813" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.5352" x="120.1611" y="559.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.5352" x="130.1611" y="582.2607">Rule Engine</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="133.8047" x="273.6963" y="559.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113.8047" x="283.6963" y="582.2607">ABAC/RBAC/ACL</text><path d="M223.6963,577.4141 L233.6963,577.4141 C248.6963,577.4141 248.6963,577.4141 263.6963,577.4141 L273.6963,577.4141" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M70.1611,307.7813 L80.1611,307.7813 C95.1611,307.7813 95.1611,577.4141 110.1611,577.4141 L120.1611,577.4141" fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><ul><li>Subjects: Standalone users or groups. In the enterprise environment, users and groups are getting sychronized from managed IAM platforms, HR services or LDAP servers.<ul><li>User: The individual user, such as <code>sAMAccountName</code> in LDAP servers.</li><li>Group: A group is just a set of individuals users, such as <code>memeberOf</code> in LDAP servers. Nested group may be complex at the first glance, but actually they can be flatten via SQL recursive query(CTE).</li></ul></li><li>Namespaces: An organizational structures, such as nested departments.<ul><li>Metadata: Name, description and other descriptive K-V pairs of the namespace.</li><li>Resources: The digital asserts inside the namespace.<ul><li>Metadata: Name, description and other descriptive K-V pairs of that resource.</li><li>Asserts: Such as API entrypoints, Row &amp; Column level filter or virtual datalakes. You have to design the granularity at the row level, object level or field level, they are specialized domains</li><li>Capabilities: Defines the capabilities that someone is granted to access asserts. It’s mostly described with an two immutable string combinations, like AWS use <code>read:secretsmanager</code> to describle the read capability.<ul><li>verb: read/write/list/full</li><li>noun: The field in the assert.</li></ul></li><li>Assignments: Who is grant to access the resources, there are four types of strategies (priorities)<ul><li>Share with all members inside the namespace regardless of the assigned namespace capabilities.</li><li>Share with members who is grant with some capabilities inside the namespace.</li><li>Share with individual users or groups directly inside the namespace.</li><li>Share with whoever out of the namespace. (Not recommand)</li></ul></li><li>Ownership: Who is responsible for maintaining metadata and asserts, managing approvals of the resource.</li></ul></li><li>Capabilities: Defines the member capabilities in the organizational structure.</li><li>Assignments: Define the membership inside the namespace, such as inviting user A with three capabilities granted as a namespace member.</li><li>Ownership: Who is responsible for managing the namespace.</li></ul></li><li>Rule Engine: The dynamic process of assessing if someone is allowed to access the resource. That’s what so called ABAC, RBAC or ACL.</li></ul><h3>Preparation</h3><p>I’d recommand to <strong>enumerate</strong> all capabilities and checkpoints before any development, as the capabilities may be embedded in the code and difficult to be modified over time.</p><p>Following checklist must be accomplished before your permission design:</p><ul><li><p>Capability and granularity: The granularity design can’t be reused among projects, as mostly for specialized domains. Ensure the design being stateless so that developers can write unit tests independently.</p></li><li><p>Membership: Who can manage the membership? Is your system design vulnerable to <a target="_blank" rel="noopener" href="https://owasp.org/Top10/2025/A01_2025-Broken_Access_Control/">privilege escalation</a>?</p></li><li><p>Ownership can be complex in GDPR compliance, especially personal data that is held, processed, and redistribed by companies, which requires massive checklists. To manage data produced by a person, It’s better to ensure each object can be managed at the lowest granularity. Before all else, it’s critical to assign each object to only <strong>one person</strong> who has the legal right, as the owner might not process the data directly. Even the matter being discussed here is the design of authorization, the design should also be considered for big data or AI trainings in the future. Moreover, the design of the grant should be managed appropriately. Never assign an object without the owner’s explicit consent regardless of the supervisory role such as super admins.</p></li><li><p>Audit and compliance</p><ul><li>Implement selective dialog for grant access instead of default settings.</li><li>Define audit log checkpoints when operations are invoked, they should be managed and traced transparently, but you should also be aware redacting some sensitive logs for users privacy.</li></ul></li><li><p>Rules engine</p><ul><li>Scope: Check if require multi-scope organizational structures in your service, as the priority evaluations can’t be directly merged within multi-scope organizations.</li><li>Contrary: Which has higher priority while both “allow policy” and “denial policy” are evaluated together.</li></ul></li></ul><h2>Role definitions</h2><h4>How roles are defined</h4><p>Prior to the discussing, it’s imperative we first address three types of role definitions. In the real-world development, I’ve seen the real-world users who couldn’t distinguish following opeartions.</p><ul><li>Invite User A into a project as a <code>ProjectAccountant</code> role, mimicking real-world job functions; then appropriate data permissions would be programmatically assigned to that role, granting User A access automatically.</li><li>Invite A into a group called <code>project_accountant_data</code>, then assign the data permission to the group directly.</li><li>Invite User A into a project with a role <code>AccountingReader</code>, while the role is just a set of capabilities of namespaces and resources, which is unrelative to the real-world project accountant.</li></ul><p>Role definitions can take either an intensional and extensional form. An intensional definition specifies a read-world role while extensional definitions just enumerate the explicit members or a set of abstract capabilities.</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="MINDMAP" height="215px" preserveAspectRatio="none" style="width:549px;height:215px;background:#fff" version="1.1" viewBox="0 0 549 215" width="549px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="50.7959" x="10" y="88.5195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.7959" x="20" y="111.5146">Role</text><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="97.0684" x="110.7959" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.0684" x="120.7959" y="42.9951">Intensional</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.792" x="120.7959" y="59.292">Definition</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="222.5967" x="257.8643" y="28.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202.5967" x="267.8643" y="51.1436">Assign attributes to a person</text><path d="M207.8643,46.2969 L217.8643,46.2969 C232.8643,46.2969 232.8643,46.2969 247.8643,46.2969 L257.8643,46.2969" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M60.7959,106.668 L70.7959,106.668 C85.7959,106.668 85.7959,46.2969 100.7959,46.2969 L110.7959,46.2969" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="101.1973" x="110.7959" y="112.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.1973" x="120.7959" y="135.5889">Extensional</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.792" x="120.7959" y="151.8857">Definition</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="275.1514" x="261.9932" y="84.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="255.1514" x="271.9932" y="107.4404">Enumerate a set of users as a group</text><path d="M211.9932,138.8906 L221.9932,138.8906 C236.9932,138.8906 236.9932,102.5938 251.9932,102.5938 L261.9932,102.5938" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="238.1348" x="261.9932" y="140.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="218.1348" x="271.9932" y="163.7373">Enumerate a set of capabilities</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.1279" x="271.9932" y="180.0342">(Build-in Role)</text><path d="M211.9932,138.8906 L221.9932,138.8906 C236.9932,138.8906 236.9932,167.0391 251.9932,167.0391 L261.9932,167.0391" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M60.7959,106.668 L70.7959,106.668 C85.7959,106.668 85.7959,138.8906 100.7959,138.8906 L110.7959,138.8906" fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><h4>The Intensional role definition - Conceptualization problems (RBAC)</h4><p>The first definition uses the declarative notations for roles, that is to say, the conceptualization of the roles. In a nature language statement, the role utilizes with a restrictive relative clause that function as a pronoun, which provides an indirect mechanism that assigns an attribute(such as a job title called “Accounting Manager”) to a person and then binds the attribute to the capabilities in the managed scopes.</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- [Kyon                    ] can view sales data.</span></span><br><span class="line"><span class="addition">+ [People who are sales    ] can view sales data.</span></span><br></pre></td></tr></table></figure><p>The intensional definition of a role can be an attribule.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">MarketingDept</span> = [</span><br><span class="line">  <span class="string">&#x27;John&#x27;</span>: &#123;<span class="attr">role</span>: [<span class="string">&#x27;Manager&#x27;</span>,<span class="string">&#x27;Sales&#x27;</span>]&#125;, </span><br><span class="line">  <span class="string">&#x27;Lisa&#x27;</span>: &#123;<span class="attr">role</span>: [<span class="string">&#x27;Sales&#x27;</span>, <span class="string">&#x27;FAE&#x27;</span>]&#125;, </span><br><span class="line">  <span class="string">&#x27;Tom&#x27;</span> : &#123;<span class="attr">role</span>: [<span class="string">&#x27;Sales&#x27;</span>]&#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>It is called Role-based access control, which is abbreviated to RBAC, is widely taught in computer courses.</p><p>Unfortunately, as a computer never understand what “Manage” means, building a real-world title comes with the developer overhead. There are a few considerations to keep in mind:</p><ul><li>Conceptualization is a highly developed skill that relies on the industrial experience and ontological thinking. A leetcode proven programmer may not be capable of abstraction in a short time.</li><li>The real-world role may change frequently while software engineers need iterations for simulating the real world through Excels or databases over time.</li><li>While some users argue their roles should get more privileges, others oppose expanding access, resulting in contentious and protracted meetings that ultimately delay development timeline.</li></ul><h4>The extensional role definition 1 - Membership enumeration (Group)</h4><p>To reduce the complexity, the fundamental action is to remove attributes – <strong>a role can be merely considered a named subgroup</strong>. We can enumerate all roles without any conceptualization!</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">MarketingManager</span> = [<span class="string">&#x27;John&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MarketingSales</span> = [<span class="string">&#x27;Lisa&#x27;</span>, <span class="string">&#x27;Tom&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MarketFAE</span> = [<span class="string">&#x27;Lisa&#x27;</span>]</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MarketingDept</span> = [<span class="title class_">MarketingManager</span>, <span class="title class_">MarketingSales</span>, <span class="title class_">MarketFAE</span>]</span><br></pre></td></tr></table></figure><p>In my view, the enumerative way is a better alternative because it can be learned by users instinctively.</p><p>It’s more flexible to externalize the real-world roles as enumerative groups (nested groups are acceptable) into third party systems (such as OpenLDAP, HR Service), while our applications connecting to these services are abstracted from the underlying definition of departments.</p><p>Membership validation or synchronization can also be implemented via centralized authorization framework such as traefik’s forward-auth or other aspect oriented middlewares.</p><h4>The extensional role definition 2 - Capabilities enumeration (ACL)</h4><p>Another alternative is to create build-in roles via capabilities</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> S3Reader = [<span class="string">&#x27;read:s3&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">EC2Reader</span> = [<span class="string">&#x27;read:ec2instance&#x27;</span>, <span class="string">&#x27;read:ec2image&#x27;</span>, <span class="string">&#x27;read:ec2ebs&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ClouldReader</span> = [S3Reader, <span class="title class_">EC2Reader</span>]</span><br></pre></td></tr></table></figure><p>It’s the most widely used in cloud services, classified as ACL (Access controll list). However, an ambiguous role name can also leading to a steep learning curve, as examplified by using “Owner”, “Manager”, and “Admin” together.</p><p>For example, Gitlab, a well-known code management software that represents the design of nested RBAC authorization. When we want to assign a read-only permission to someone, we found that the role <code>Reporter</code> and <code>Guest</code> are both semantic symbols of observation, which meaned they were not mutually exclusive in the real world, making it impossible to configure the roles correctly without an official cheat sheet. Additionally, when we tried to modify the source code, we found that the capability <code>:admin_project</code> was in a mess (both frontend and backend).</p><p>In contrast to the prior case, Sonarqube, a code scanner platform, chooses to manage roles concisely. Sonarqube defines two roles: the project administrator and the project member. Everyone can infer the administrator has a higher permission scope.</p><p>Build-in roles must be concise enough, in most cases, three definitions are enough: admin, read-write and read-only. If you insist on designing additional roles, the names of role must be derived from the capabilities inside the system rather than from the real world.</p><p>The design of an ACL can be challenging as it requires linear growth in database storage as the amount of data and owners being managed increases over time.</p><h2>How to use them together?</h2><p>RBAC provides coarse-grained access control by attributes while ACL uses fine-grained policies at an individual resource level. Complications arise when permission overlaps, here are some hints.</p><p>To implement the requirements, here is the pesudo code</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Check if a user can access a resource</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">can</span><span class="params">(User current, Resource res, String verb, String action)</span>&#123;</span><br><span class="line">  <span class="comment">// deflate all capable subjects, as exemplified in Membership enumeration</span></span><br><span class="line">  List&lt;Subject&gt; subjects = getJointLDAPGroups(current);</span><br><span class="line">  <span class="comment">// find all capabilities, as exemplified in Capabilities enumeration</span></span><br><span class="line">  Map&lt;Namespace, Map&lt;String, String&gt;&gt; nsCaps = getCapsOfJointNamespaces(subjects);</span><br><span class="line">  Map&lt;String, String&gt; resCaps = getCapsOfTheResource(subjects, res);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Your have to implement your own priorities</span></span><br><span class="line">  <span class="comment">// we implement with AntPathMatcher for prefix matching</span></span><br><span class="line">  <span class="keyword">return</span> evaluationEngine(subjects, nsCaps, resCaps, verb, action)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// test</span></span><br><span class="line">can(userA, dataA, <span class="string">&quot;read&quot;</span>, <span class="string">&quot;/accounting/margins&quot;</span>);</span><br><span class="line">can(userA, dataB, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;/accounting/netprofiles&quot;</span>);</span><br></pre></td></tr></table></figure><h4>Inheritance &amp; Segregation of duty (SoD)</h4><p>In the enterprise environment, there are two considerations on permissions</p><ul><li>Internal control and procedural justice =&gt; y<strong>ou can fail or be slow but you can’t do nothing wrong.</strong></li><li>Privacy compliance</li></ul><p>The solution is to keep your system SOD, which requires matrixes to evaluate risks.</p><ul><li>Role-Role Matrix: Evaluate the risk of a person having multiple roles.</li><li>Task-Task Matrix: Evaluate the risk of the tasks being accomplished by one person.<ul><li>Purchasing and accounting.</li><li>Constructing and verification.</li></ul></li><li>Role-Task Matrix: Draw a unified diagram permissions, especially for nested permissions.</li></ul><p>The cost of developing SoD is relatively <strong>expensive and time-consuming</strong>, we insert <strong>hundreds of checkpoints</strong> and audit logs inside the source code. Don’t take first priority over it.</p><h4>Super Administration management</h4><p>It’s deemed high-risk to allow an admin to access tanant or subordinate data as it violates isolation boundaries.</p><p>Intersection and union caculations can be applied to constrain privileges for the admin role, enabling admins to read item lists while denying access to details.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemScopeCheck  = () -&gt; can(userA, <span class="literal">null</span>, <span class="string">&quot;manage&quot;</span>, <span class="string">&quot;/accounting/margins&quot;</span>);</span><br><span class="line">objectScopeCheck  = () -&gt; can(userA, dataA, <span class="string">&quot;read&quot;</span>, <span class="string">&quot;/accounting/margins&quot;</span>);</span><br><span class="line"><span class="comment">// enabling admins to read item lists while denying access to details.</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">canList</span>       <span class="operator">=</span> systemScopeCheck() || objectScopeCheck()</span><br><span class="line"><span class="type">boolean</span> <span class="variable">canReadDetail</span> <span class="operator">=</span> systemScopeCheck() &amp;&amp; objectScopeCheck()</span><br></pre></td></tr></table></figure><h2>Appendex</h2><h4>Alternatives to notation based role definitions</h4><p>Recenlty some frameworks focus on low-code role definitions, claiming to be pluggable, declarative, and unified. Meanwhile, these methods don’t always guarantee the flexibility.</p><p>The following table compares the notations across diversified authorization frameworks.</p><table><thead><tr><th>Notation</th><th>Paradigm</th><th>Logic</th></tr></thead><tbody><tr><td>Tries traversal: Open Policy Agent</td><td>Declarative</td><td>Combinational</td></tr><tr><td>Relation tuple: Ory Permissions</td><td>Declarative</td><td>Combinational</td></tr><tr><td>Relation tuple: <a target="_blank" rel="noopener" href="https://research.google/pubs/pub48190/">Google Zanzibar</a></td><td>Declarative</td><td>Combinational</td></tr><tr><td>Spring Security Annotations</td><td>Declarative</td><td>Combinational</td></tr><tr><td>Casbin Go like DSL</td><td>Declarative</td><td>Sequential</td></tr><tr><td>Rete algrorithm: Drools</td><td>Mostly declarative</td><td>Combinational</td></tr><tr><td>JSON Schema</td><td>Mostly declarative</td><td>Sequential</td></tr><tr><td>Hard-coded programming</td><td>Imperative</td><td>Sequential</td></tr></tbody></table><p>The key to classify the frameworks is to check if it supports <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Sequential_logic">sequential logic</a> during the policy evaluation. For instance, the if-else statements implicate the priorities during the calculation, while bitwise operations are timeless and do not require the state storage during the evaluation.</p><p>If you need if-else statements during the policy evaluation, I’d recommand <strong>not to use any</strong> low-code solutions to torture yourself.</p><p>In recent work, I tried to use “Open Policy Agent(OPA)” so that I could modify the policies on the fly. Unexpectedly, the requirements from customers were not as declarative as low-code, including following rules.</p><ul><li>Nested and complicated if-then statements with hard-coded situations</li><li>Hard-coded role assignments to a specialized leader</li><li>Row-level filters that were strongly bonded with SQL queries</li></ul><p>After I tried OPA, I found that</p><ul><li>The rego language was not Golang, I’d rather call it as Verilog for its timelessness. OPA is more like an EDA synthesizer.</li><li>Required addtional work hours on the maintenance of high availability of OPA instances</li></ul><p>After times of reworks, I gave up using OPA because our works were merely a translation between “customer’s prompt” and “handcrafted code”, which was an AI capable of.</p><p>From my perspective, the most common mistake in system design I’ve made is <strong>over engineering</strong>. There is no unified way to notate the constrains. Conversely, the only approach to reduce the expenditure is to minify the code at an engineering level.</p><h2>Summary</h2><p>In this article, we walked through RBAC, ACL, and low-code.</p><ul><li>Make roles mutually exclusive while using RBAC, using extensional definition is preferred.</li><li>Ensure ownership and membership be defined before using ACL.</li><li>It’s ideal to provide rights-respecting policies and SOD when using RBAC and ACL together.</li><li>Low-code frameworks is not a unified solution, a hard-coded solution could be acceptable for small teams.</li></ul><p>Ultimately, choosing the best solution depends on compliance requirements.</p></div><div class="tags"><a class="tag-link" href="/tags/Authz/" rel="tag">Authz</a><a class="tag-link" href="/tags/Security/" rel="tag">Security</a><a class="tag-link" href="/tags/System-Design/" rel="tag">System Design</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry.</a><span> All contents are not allowed to be redistributed or synthesised without an explicit permission.</span></div></footer></div></body></html>