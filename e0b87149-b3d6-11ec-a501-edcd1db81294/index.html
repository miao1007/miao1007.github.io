<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="Wine可以看作ELF解释器(Interceptor)，并实现了WindowsAPI(自己手写一套)与Direct的Runtime，因此可以复用native的性能，而不用虚拟机去执行虚拟指令集."><meta name="keyword" content="Mac,Wine"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Mac下安装与使用Wine最全指导</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://eu.umami.is/script.js" data-website-id="449a84b6-be9e-49de-a4cc-e0fa6fea1df9"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">Mac下安装与使用Wine最全指导</div><div class="date no-print">2019-01-29 / modified at 2024-09-13 / 2.1k words / 8 mins</div><div class="content"><blockquote><span>️This article has been <strong>over 1 years</strong> since the last update.</span></blockquote><p>Wine可以看作ELF解释器(Interceptor)，并实现了WindowsAPI(自己手写一套)与Direct的Runtime，因此可以复用native的性能，而不用虚拟机去执行虚拟指令集.</p><span id="more"></span><h2>对比</h2><p>Wine缺点也明显，上手有一定难度（类似于黑苹果的黑箱调试），需要找DLL与改各种配置，并对日志进行定位分析。</p><table><thead><tr><th>产品</th><th>分支</th><th>费用</th><th>版本特性</th><th>备注</th></tr></thead><tbody><tr><td>WineHQ</td><td>最新</td><td>Free</td><td>跨平台开源，主干分支</td><td>最新版不支持osx</td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/Gcenx/homebrew-wine">gcenx-wine-stable</a></td><td>最新</td><td>Free</td><td>最新，能跑起来</td><td>大部分应用还是跑不起来</td></tr><tr><td>CrossOver</td><td>商用</td><td>Commercial</td><td>Codeweavers <a target="_blank" rel="noopener" href="https://media.codeweavers.com/pub/crossover/source/">modified</a> wine version.</td><td>稳定，支持部分DX11</td></tr><tr><td><a target="_blank" rel="noopener" href="https://www.codeweavers.com/bettertester">CrossOver bettertester</a></td><td>商用</td><td>15-days-free</td><td>Codeweavers <a target="_blank" rel="noopener" href="https://media.codeweavers.com/pub/crossover/source/">modified</a> wine version.</td><td>免费nightly测试小白鼠</td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/Gcenx/homebrew-wine">gcenx’s wine-crossover</a></td><td>商用</td><td>Free</td><td>基于CrossOver开源部分编译</td><td>类似CentOS与RedHat的关系</td></tr><tr><td>Game Porting Toolkit</td><td>SDK</td><td>Free</td><td>苹果移植套件</td><td>只支持ARM，非DXVK</td></tr></tbody></table><p>此外还有PlayOnMac/wineskin等wrapper方案。它们配置更新维护没有CrossOver快，因此这些均不再介绍。</p><p>上述最佳方案莫过于商业版CrossOver，而且也不贵，不用折腾。</p><p>上述均不能保证程序全部正常运行，运行不来的还是要靠虚拟机。</p><h2>安装</h2><h4>开源版CrossOver安装</h4><p>假如你已经在macOS11以上，推荐安装<a target="_blank" rel="noopener" href="https://github.com/Gcenx/homebrew-wine">GcenxWine</a>的版本，安装后会自动创建<code>Wine Crossover.app</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew tap gcenx/wine</span><br><span class="line">brew install --cask --no-quarantine wine-crossover</span><br><span class="line">brew install winetricks</span><br></pre></td></tr></table></figure><blockquote><p>这种安装很类似RedHat与CentOS的关系，虽然白嫖开源代码流程合法，但是追求稳定与Support的话还是使用收费版更好</p></blockquote><h4>收费版CrossOver的安装</h4><p>购买后直接点击安装即可。</p><blockquote><p>合法地免费申请测试使用最新版：<a target="_blank" rel="noopener" href="https://www.codeweavers.com/bettertester">https://www.codeweavers.com/bettertester</a></p></blockquote><h4>开源版gcenx-wine-stable</h4><p>此版本经过测试，比较尴尬，无法运行32位程序，而且大部分64位程序会stack溢出。</p><h4>随时切换配置（可选）</h4><p>此部分主要是做对照实验时使用，并防止重装后丢失数据。</p><p>首先CrossOver安装完成后，新建一个<code>/win7-64</code>的容器</p><p>接着将如下代码复制到<code>~/.bashrc</code>中（或者zshrc，取决于你的Shell）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">wine_common</span></span>()&#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="function"><span class="title">lk_folder</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="built_in">link</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> to <span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="variable">$1</span></span><br><span class="line">    <span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$2</span>/`basename <span class="variable">$1</span>`&quot;</span></span><br><span class="line">    <span class="built_in">ln</span> -sfn <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">export</span> WINEPREFIX=<span class="variable">$1</span></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$WINEPREFIX</span></span><br><span class="line">  <span class="comment"># 防止程序信息丢失，直接放在Mac下</span></span><br><span class="line">  v_user=<span class="string">&quot;<span class="variable">$&#123;WINEPREFIX&#125;</span>/drive_c/users/<span class="variable">$3</span>&quot;</span></span><br><span class="line">  lk_folder <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/Documents/wine/Application Data/&quot;</span> <span class="string">&quot;<span class="variable">$v_user</span>&quot;</span></span><br><span class="line">  lk_folder <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/Documents/wine/AppData/&quot;</span> <span class="string">&quot;<span class="variable">$v_user</span>&quot;</span></span><br><span class="line">  lk_folder <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/Documents/wine/Local Settings/&quot;</span> <span class="string">&quot;<span class="variable">$v_user</span>&quot;</span></span><br><span class="line"></span><br><span class="line">  lk_folder <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/Documents/wine/My Documents/&quot;</span> <span class="variable">$v_user</span></span><br><span class="line">  lk_folder <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/Documents/wine/My Music/&quot;</span> <span class="variable">$v_user</span></span><br><span class="line">  lk_folder <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/Documents/wine/My Pictures/&quot;</span> <span class="variable">$v_user</span></span><br><span class="line">  lk_folder <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/Documents/wine/My Videos/&quot;</span> <span class="variable">$v_user</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># configurate path</span></span><br><span class="line">  <span class="built_in">export</span> PATH=$(<span class="built_in">echo</span> <span class="variable">$PATH</span>|<span class="built_in">tr</span> <span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;\n&#x27;</span>|grep -v wine|grep -v CrossOver|<span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">  <span class="built_in">export</span> PATH=<span class="variable">$2</span>:<span class="variable">$PATH</span></span><br><span class="line">  <span class="comment"># configurate language</span></span><br><span class="line">  <span class="built_in">export</span> LC_ALL=<span class="string">&quot;en_US.UTF-8&quot;</span>;</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$v_user</span></span><br><span class="line">  <span class="built_in">readlink</span> wine</span><br><span class="line">  <span class="comment"># 可以看出收费版的Wine信息输出是不一样的</span></span><br><span class="line">  <span class="built_in">where</span> wine</span><br><span class="line">  wine --version</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">switch_wine</span></span>()&#123;</span><br><span class="line">  WINE_BIN=<span class="string">&quot;/Applications/Wine CrossOver.app/Contents/Resources/start/bin:/Applications/Wine Crossover.app/Contents/Resources/wine/&quot;</span></span><br><span class="line">  WINEPREFIX=<span class="variable">$HOME</span>/.wine</span><br><span class="line">  <span class="built_in">export</span> WINEARCH=win64</span><br><span class="line">  wine_common <span class="variable">$&#123;WINEPREFIX&#125;</span> <span class="variable">$&#123;WINE_BIN&#125;</span> <span class="variable">$USER</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">switch_co</span></span>()&#123;</span><br><span class="line">  BOTTLE_NAME=win7-64</span><br><span class="line">  WINE_BIN=<span class="string">&#x27;/Applications/CrossOver.app/Contents/SharedSupport/CrossOver/CrossOver-Hosted Application&#x27;</span></span><br><span class="line">  WINEPREFIX=<span class="string">&quot;<span class="variable">$HOME</span>/Library/Application Support/CrossOver/Bottles/<span class="variable">$BOTTLE_NAME</span>&quot;</span></span><br><span class="line">  Bottles=$(<span class="built_in">dirname</span> <span class="variable">$&#123;WINEPREFIX&#125;</span>)</span><br><span class="line">  <span class="built_in">ln</span> -sfn <span class="string">&quot;<span class="variable">$Bottles</span>/<span class="variable">$BOTTLE_NAME</span>&quot;</span> <span class="string">&quot;<span class="variable">$Bottles</span>/default&quot;</span></span><br><span class="line">  v_users=<span class="variable">$&#123;WINEPREFIX&#125;</span>/drive_c/users</span><br><span class="line">  <span class="built_in">export</span> WINEARCH=win64</span><br><span class="line">  <span class="built_in">export</span> DXVK_HUD=1</span><br><span class="line">  wine_common <span class="variable">$&#123;WINEPREFIX&#125;</span> <span class="variable">$&#123;WINE_BIN&#125;</span> crossover</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样同时安装免费版与商业版的优点是可以随意切换env(商业版与免费版)，而且数据可以共享（大部分配置全部都可以软链接到Document下）</p><h2>使用</h2><p>大部分简单的APP可以通过如下使用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到社区版 switch_wine</span></span><br><span class="line"><span class="comment"># 切换到商业版 switch_co</span></span><br><span class="line">wine xxx.exe</span><br></pre></td></tr></table></figure><h2>For DirectX Game</h2><p>到此为止，大部分非3D游戏应该都可以运行了。但是要强调一下，Mac性能差强人意，因此性能与虚拟机也好不到哪去，不要有过高期望。</p><p>我个人不推荐安装这里的任何dll，如果有问题，只能试试看而已。</p><h4>DirectX9</h4><p>虽然Wine已经完整实现并Build in了DirectX9，但是如果有兼容问题，可以考虑如下方案</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DX9, 10+不相互兼容，需要各自下载各自的，以9为例</span></span><br><span class="line"><span class="comment"># 这里有安装完全包(directx9)与DLL的方案，官方更推荐DLL(d3dx9_36)方案</span></span><br><span class="line"><span class="comment"># 我个人更喜欢安装这个</span></span><br><span class="line">winetricks directx9</span><br></pre></td></tr></table></figure><p>如果还是不能运行，那么就只能换DX的版本或者换Wine的版本了</p><p>另外注册表参数<code>CSMT</code>虽然在网上说有用（CrossOver中叫做Performance Enhanced Graphics），但是实际没有较大的提升</p><h4>DirectX10+</h4><p>在Wine中Mac下暂时<a target="_blank" rel="noopener" href="https://www.codeweavers.com/compatibility/crossover/directx-10">没有</a>找到实现，只有部分Hack的博文。原因是在Mac下，DX通过如下实现</p><ul><li>DX10+: DXVK(Vulkan，推荐)</li><li>DX9: wined3d(OpenGL)</li></ul><p>同时由于Mac本身性能就一般，所以这里就不折腾了。</p><p>而在CrossOver下，商业版支持了部分DX10+的API，但是总体上只可以看成一个Stub，并非完全支持。</p><h4>关于.NetFrameWork</h4><p>net框架是向前兼容的，理论上安装最新的就可以的，然而实际上当然是一堆坑，不一定要强求最新的版本</p><p>一般用Wine自己编译的Net框架<a target="_blank" rel="noopener" href="https://wiki.winehq.org/Mono">Mono</a>是最方便的，它底层源码是微软开源的，此外Unity也进行过定制。此外，CrossOver下会自动帮你安装好wine-mono。</p><p>如果你非要用MS的Net框架，首先需要卸载wine-mono框架</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开源版手动卸载 wine-mono 框架</span></span><br><span class="line">wine uninstaller</span><br><span class="line">winetricks dotnet35</span><br></pre></td></tr></table></figure><p>而在CrossOver下用鼠标搜索“Net Framework 4.7.2”即可处理全部2.0到4.7的多版本安装。</p><blockquote><p>Windows 10 下默认安装的版本为：4.6.x 和 3.5SP1，当前兼容性最强的为4.7.2与4.8.1。详见<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/.NET_Framework_version_history#Overview">矩阵图</a></p></blockquote><h4>CJK字体乱码问题</h4><p>网上有直接替换user.reg或者system.reg的方案，我个人不推荐，因为这两个可以看作序列化缓存，<a target="_blank" rel="noopener" href="https://wiki.winehq.org/Regedit">不应该</a>手动修改，缺点是没有复用Mac下的字体</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装一堆CJK字体，能用就行</span></span><br><span class="line">winetricks cjkfonts</span><br></pre></td></tr></table></figure><p>接着配置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HOME</span>/.wine</span><br><span class="line"><span class="built_in">cat</span> &gt; font_settings.reg &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">REGEDIT4</span></span><br><span class="line"><span class="string">[HKEY_CURRENT_USER\Software\Wine\X11 Driver]</span></span><br><span class="line"><span class="string">&quot;ClientSideWithRender&quot;=&quot;N&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment"># 导入此文件</span></span><br><span class="line">wine regedit font_settings.reg</span><br></pre></td></tr></table></figure><p>如果有乱码问题，可以配置宿主语言或者传递如下变量，不需要LocaleEmulator等工具</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://wiki.winehq.org/Testing_Languages</span></span><br><span class="line"><span class="comment"># ja_JP, en_US</span></span><br><span class="line"><span class="built_in">export</span> LC_ALL=<span class="string">&quot;zh_CN.UTF-8&quot;</span>;</span><br></pre></td></tr></table></figure><h2>结论</h2><h4>与虚拟机的对比</h4><p>Wine方案（包括CrossOver）总体来说，在Mac下使用范围还是有限，适合喜欢折腾的用户。因为Mac下非游戏类的软件均有替代方案，甚至比Windows下功能更强；而游戏由于先天性能不行导致只是比虚拟机性能略高，但是散热更低（风扇不会太响），可能有渲染错位，FS性能比虚拟机弱（可能是运行时转换DLL导致，需要PreLoader）的问题。当然这些是与付费软件Parallels对比的，有失公平。</p><p>此外还有一点，为了提高易用性，Wine方案安全隔离完全不够，权限与普通用户一致，没有做到UI等Namespace隔离，因此建议<strong>只运行可信来源的软件</strong>。</p><p>因此在目前场景下，Wine比较适合中小型软件/游戏的使用，以及白名单中的应用。最佳方案还是大硬盘+安全虚拟机综合效果更好</p><p>如果真的想玩游戏，参考</p><ul><li>用Switch模拟器玩原生ARM游戏</li><li>用PlayCover玩iOS游戏</li></ul><h4>与移动硬盘OS的对比</h4><p>如果使用移动硬盘安装软件，那么除了需要重启外体验基本上很好，当前SSD硬盘也白菜价了，可以考虑。</p><h2>其它配置</h2><h5>卸载Wine</h5><p>详见<a target="_blank" rel="noopener" href="https://wiki.winehq.org/MacOS">此Wiki</a></p><p>如果需要删除缓存</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf ~/.cache/winetricks</span><br></pre></td></tr></table></figure><h4>常见报错处理</h4><ul><li>Q: Unhandled exception: page fault on read access</li><li>A: 这种一般是找不到库导致的，有的程序自嵌所有的库，有的必须找Windows</li></ul><ul><li>Q: fixme xxx</li><li>A: 根据调试经验，除了CG渲染，Fixme相关报错一般与主报错关系不大。建议使用二分法定位。</li></ul><ul><li>Q: PresentationFramework, Version=3.0.0.0, Culture</li><li>A: 安装相应的net库</li></ul><ul><li>Q: 如何彻底重装容器?</li><li>A: 直接<code>rm -rf ~/.wine*</code>(慎重执行)即可，winetricks下载的缓存在<code>~/.cache/winetricks</code>中，不会重复下载</li></ul><ul><li>Q: 还是无法运行某程序</li><li>A: 尝试下载使用<a target="_blank" rel="noopener" href="https://dl.winehq.org/wine-builds/macosx/pool/">旧版</a>，通过二分法定位</li></ul><h4>其它资源</h4><ul><li>注册表: <a target="_blank" rel="noopener" href="https://wiki.winehq.org/UsefulRegistryKeys">https://wiki.winehq.org/UsefulRegistryKeys</a></li><li>大佬论坛: <a target="_blank" rel="noopener" href="https://www.reddit.com/r/wine_gaming">https://www.reddit.com/r/wine_gaming</a></li></ul></div><div class="tags"><a class="tag-link" href="/tags/Mac/" rel="tag">Mac</a><a class="tag-link" href="/tags/Wine/" rel="tag">Wine</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry.</a><span> All contents are not allowed to be redistributed or synthesised without an explicit permission.</span></div></footer></div></body></html>