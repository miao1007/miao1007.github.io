<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content=""><meta name="keyword" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Android-HTTP的几种抓包方法</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"></head><body class="container"><header id="header"><div class="header"><div class="header-left"><div class="author"><div class="author-name"><a href="/">諺</a></div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">Archives</a></li><li style="font-size:.9rem"><a href="/archives" rel="nofollow">zh</a></li><li style="font-size:.9rem"><a href="#" rel="nofollow">|</a></li><li style="font-size:.9rem"><a href="/en" rel="nofollow">en</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">Epistemology</a></li><li><a href="/books" rel="nofollow">読書</a></li></ul></div></div></header><div class="content-wrapper"><div class="post"><section class="article"><div class="title">Android-HTTP的几种抓包方法</div><div class="date">2015-02-20に投稿</div><div class="content"><span id="more"></span><p>如果你想干如下的事情</p><ul><li>学习到成熟的API设计</li><li>学习WebView中优雅的CSS，比如夜间模式，屏幕适配</li><li>看看BAT系列软件在后台流氓了什么</li><li><s>看看蹭网的人都在干什么</s></li></ul><p>那么这篇文章就适合你哦，本文目录如下</p><ul><li>抓包环境</li><li>基于mitmproxy的调试</li><li>基于Chrome的调试(WebView Only)</li><li>基于OpenWRT的调试</li></ul><h2>抓包环境</h2><p>本文对Unix操作基础有一定的要求，但是用熟悉了操作也不错哦</p><ul><li>手机 CM Kitkat</li><li>电脑 OSX Yosemite</li><li>它们都在一个路由内网环境下</li></ul><h1>基于mitmproxy的调试</h1><p>mitmproxy是一款运行在电脑上的proxy软件，它只抓HTTP(S)协议的包，用起来比tcpdump好用多了。</p><h4>配置mitmproxy</h4><p>以MacOS为例，安装mitmproxy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install python</span><br><span class="line">pip install mitmproxy</span><br></pre></td></tr></table></figure><p>如果被墙了，就到官网自行下载二进制</p><h4>配置Android</h4><p>这一步相当于加入私签的中间人证书</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push ~&#x2F;.mitmproxy&#x2F;mitmproxy-ca-cert.cer &#x2F;sdcard&#x2F;</span><br></pre></td></tr></table></figure><p>打开手机 - settings - Lock screen - Screen security - Screen lock - 配置你自己的password</p><p>选中 settings - security - install from sdcard - 选中刚刚的证书 - 按照如下设置</p><table><thead><tr><th style="text-align:left">Cretificate name</th><th style="text-align:left">mitmproxy</th></tr></thead><tbody><tr><td style="text-align:left">Credential use</td><td style="text-align:left">VPN and apps</td></tr></tbody></table><p>选中 Settings - Wi-Fi - Modify network - 按照如下设置</p><table><thead><tr><th style="text-align:left">Show advanced options</th><th style="text-align:left">√</th></tr></thead><tbody><tr><td style="text-align:left">Proxy hostname</td><td style="text-align:left">你的电脑ip，可以在WiFi设置里面看到</td></tr><tr><td style="text-align:left">Proxy port</td><td style="text-align:left">8080</td></tr></tbody></table><p>然后关闭手机WiFi再打开，电脑终端运行 <code>mitmproxy</code> 即可。</p><p>如图，<code>↑</code> <code>↓</code>移动，<code>Enter</code>可以看详细内容，<code>Q</code>是返回，<code>?</code>是帮助</p><p><img src="http://upload-images.jianshu.io/upload_images/98641-cf5e380769b1483e.png" alt="mitmproxy"></p><p>退出的时候是<code>Ctrl</code> + <code>C</code> ,不是<code>Ctrl</code> + <code>D</code></p><p>#基于Chrome的调试(WebView Only)<br>此方法挑手机，挑chrome，挑操作系统，而且与代码是否开启调试有关，成功率不是很高。</p><p>手机(Kitkat以上)连接电脑(需要fq环境)，打开chrome</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome:&#x2F;&#x2F;inspect&#x2F;#devices</span><br></pre></td></tr></table></figure><p>手机打开任意一个APP，比如简书，就可以调试<s>偷点CSS</s>了，我们可以发现简书的WebView里面既有JQuery又有大片的CSS，怪不得打开慢，流量坑。</p><p><img src="http://upload-images.jianshu.io/upload_images/98641-e83299de1cfbc15a.png" alt="jianshu"></p><h1>基于OpenWRT的调试</h1><p>基于OpenWRT路由器的调试需要有一定的Linux的基础，这个电脑手机电视什么的都可以抓，甚至可以开一个钓鱼热点抓包分析，这个相比于第一个抓包，难度更大，但是抓的东西更多，不限于HTTP协议。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install tcpdump</span><br></pre></td></tr></table></figure><p>tcpdump比较复杂，一般保持为pcap的格式，可以用Wireshark打开，我们就一笔带过吧，有兴趣去专门的路由器论坛讨论。</p></div><div class="tags"></div></section><ul class="nav"><li>Prev:<a href="/%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8android%E5%8F%8D%E7%BC%96%E8%AF%91%E8%BD%AF%E4%BB%B6%E7%9A%84%EF%BC%9F/">我是如何使用Android反编译软件的？</a></li><li>Next:<a href="/mac%E4%B8%8B%E6%9C%80%E5%A5%BD%E7%9A%84gif%E8%BD%AC%E6%8D%A2%E8%BD%AF%E4%BB%B6/">Mac下最好的Gif转换软件</a></li></ul><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the<a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus</a></noscript></div></div></div></div><footer><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry</a><span>.</span></div></footer><script>window.onload=function(){var a,e,n,t;a=window,e=document,t="script",n="ga",a.GoogleAnalyticsObject=n,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=+new Date,n=e.createElement(t),t=e.getElementsByTagName(t)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",t.parentNode.insertBefore(n,t),ga("create","UA-102296742-1","auto"),ga("send","pageview")}</script></body></html>