<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="本文是对常见存储方案的简要汇总介绍。"><meta name="keyword" content="IaaS,Storage"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>常见存储方案分类整理</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-102296742-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-102296742-1")</script><meta name="generator" content="Hexo 5.4.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">常见存储方案分类整理</div><div class="date">2021-07-28 / modified at 2022-07-09</div><div class="content"><p>本文是对常见存储方案的简要汇总介绍。</p><span id="more"></span><p>在PaaS设计中，存储是对密度要求最大的部分。在应用服务中，有K8s/nomad等框架可以很容易处理计算调度编排问题，有抽象网络处理流控与ACL问题。而存储却门槛却极高，开源软件很难开箱即用，而且一般是要求高密度，高承诺，紧耦合的，它需要网络数通、路由与压缩算法、前端ASIC、专用OS(FS)、RIAD ASIC、SSD平衡算法等复合知识，也是加班最很的。</p><p>本文介绍内容在app之下，infra之上，方便软件类SE更好设计app系统。</p><h2>Infra层</h2><p>下文是大致范围</p> <?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="810px" preserveAspectRatio="none" style="width:807px;height:810px;background:#fff" version="1.1" viewBox="0 0 807 810" width="807px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="34" x="10" y="377.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="400.7764">&#23384;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="20" y="417.0732">&#20648;</text><rect fill="#F1F1F1" height="85.1875" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="34" x="94" y="248.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="104" y="271.8857">&#23384;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="104" y="288.1826">&#20648;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="104" y="304.4795">&#26426;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="104" y="320.7764">&#26694;</text><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="158" x="178" y="40"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="188" y="62.9951">&#30828;&#20214;&#23384;&#20648;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="188" y="79.292">&#65288;&#19987;&#29992;&#30828;&#20214;+&#30828;&#30424;&#26694;&#65289;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="69" x="386" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="396" y="42.9951">netapp</text><path d="M336,66.2969 L346,66.2969 C361,66.2969 361,38.1484 376,38.1484 L386,38.1484 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="93" x="386" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="396" y="99.292">OceanStor</text><path d="M336,66.2969 L346,66.2969 C361,66.2969 361,94.4453 376,94.4453 L386,94.4453 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M128,291.4844 L138,291.4844 C153,291.4844 153,66.2969 168,66.2969 L178,66.2969 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="89" x="178" y="273.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="188" y="296.3311">X86&#36719;&#23384;&#20648;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="100" x="317" y="160.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="327" y="183.7373">&#22359;&#23384;&#20648;(EBS)</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="112" x="467" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="477" y="155.5889">Cinder(Ceph)</text><path d="M417,178.8906 L427,178.8906 C442,178.8906 442,150.7422 457,150.7422 L467,150.7422 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="135" x="467" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="477" y="211.8857">GlusterFS/Lustre</text><path d="M417,178.8906 L427,178.8906 C442,178.8906 442,207.0391 457,207.0391 L467,207.0391 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M267,291.4844 L277,291.4844 C292,291.4844 292,178.8906 307,178.8906 L317,178.8906 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="104" x="317" y="329.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="327" y="352.6279">&#23545;&#35937;&#23384;&#20648;(S3)</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="58" x="471" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="481" y="268.1826">MinIO</text><path d="M421,347.7813 L431,347.7813 C446,347.7813 446,263.3359 461,263.3359 L471,263.3359 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="126" x="471" y="301.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="481" y="324.4795">OBS/swift(DHT)</text><path d="M421,347.7813 L431,347.7813 C446,347.7813 446,319.6328 461,319.6328 L471,319.6328 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="126" x="471" y="357.7813"/><a href="https://github.com/chrislusf/seaweedfs#compared-to-glusterfs-ceph" target="_top" title="https://github.com/chrislusf/seaweedfs#compared-to-glusterfs-ceph" xlink:actuate="onRequest" xlink:href="https://github.com/chrislusf/seaweedfs#compared-to-glusterfs-ceph" xlink:show="new" xlink:title="https://github.com/chrislusf/seaweedfs#compared-to-glusterfs-ceph" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="106" x="481" y="380.7764">POSIX-backend</text></a><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="46" x="647" y="301.4844"/><a href="https://support.huaweicloud.com/productdesc-obs/obs_03_0150.html" target="_top" title="https://support.huaweicloud.com/productdesc-obs/obs_03_0150.html" xlink:actuate="onRequest" xlink:href="https://support.huaweicloud.com/productdesc-obs/obs_03_0150.html" xlink:show="new" xlink:title="https://support.huaweicloud.com/productdesc-obs/obs_03_0150.html" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="26" x="657" y="324.4795">PFS</text></a><path d="M597,375.9297 L607,375.9297 C622,375.9297 622,319.6328 637,319.6328 L647,319.6328 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="148" x="647" y="357.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="657" y="380.7764">JuiceFS(S3+Redis)</text><path d="M597,375.9297 L607,375.9297 C622,375.9297 622,375.9297 637,375.9297 L647,375.9297 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="95" x="647" y="414.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="657" y="437.0732">seaweedfs</text><path d="M597,375.9297 L607,375.9297 C622,375.9297 622,432.2266 637,432.2266 L647,432.2266 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M421,347.7813 L431,347.7813 C446,347.7813 446,375.9297 461,375.9297 L471,375.9297 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M267,291.4844 L277,291.4844 C292,291.4844 292,347.7813 307,347.7813 L317,347.7813 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M128,291.4844 L138,291.4844 C153,291.4844 153,291.4844 168,291.4844 L178,291.4844 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="86" x="178" y="490.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="188" y="513.3701">&#23384;&#20648;&#32593;&#20851;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="188" y="529.667">(&#28151;&#21512;&#23384;&#20648;)</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="181" x="314" y="470.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="324" y="493.3701">Azure Storage Gateway</text><path d="M264,516.6719 L274,516.6719 C289,516.6719 289,488.5234 304,488.5234 L314,488.5234 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="139" x="314" y="526.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="324" y="549.667">Azure HPC cache</text><path d="M264,516.6719 L274,516.6719 C289,516.6719 289,544.8203 304,544.8203 L314,544.8203 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M128,291.4844 L138,291.4844 C153,291.4844 153,516.6719 168,516.6719 L178,516.6719 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M44,404.0781 L54,404.0781 C69,404.0781 69,291.4844 84,291.4844 L94,291.4844 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="113" x="94" y="611.1172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="104" y="634.1123">&#25353;&#29031;cable&#20171;&#36136;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="72" x="257" y="582.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="267" y="605.9639">GE/IB&#32447;</text><path d="M207,629.2656 L217,629.2656 C232,629.2656 232,601.1172 247,601.1172 L257,601.1172 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="132" x="257" y="639.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="267" y="662.2607">Eth/RoCE/IB&#21327;&#35758;</text><path d="M207,629.2656 L217,629.2656 C232,629.2656 232,657.4141 247,657.4141 L257,657.4141 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M44,404.0781 L54,404.0781 C69,404.0781 69,629.2656 84,629.2656 L94,629.2656 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="85.1875" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="34" x="94" y="699.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="104" y="722.2607">&#21608;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="104" y="738.5576">&#36793;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="104" y="754.8545">&#37197;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="104" y="771.1514">&#22871;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="76" x="178" y="695.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="188" y="718.5576">&#26426;&#25151;&#26426;&#26588;</text><path d="M128,741.8594 L138,741.8594 C153,741.8594 153,713.7109 168,713.7109 L178,713.7109 " fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="76" x="178" y="751.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="188" y="774.8545">&#20132;&#25442;&#26426;&#26694;</text><path d="M128,741.8594 L138,741.8594 C153,741.8594 153,770.0078 168,770.0078 L178,770.0078 " fill="none" style="stroke:#454645;stroke-width:1"/><path d="M44,404.0781 L54,404.0781 C69,404.0781 69,741.8594 84,741.8594 L94,741.8594 " fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><p>存储设计通常是放在基础设施上实现的，需要专门的Infra工程师，而应用工程师一般接触不到。</p><p>真正的设计存储方案至少包含如下</p><ul><li>机房机柜：能源、散热、消防、安全、密度等</li><li>交换框：汇聚、接入、控制、管理；GE线</li><li>控制框：SDS、存储网关与专用硬件，SDN</li><li>机器：RAID、盘位、BMC、Health</li><li>协议：Shard、主从选举、Heard-beat等</li></ul><p>如果想更深入了解，可以优先看下Top厂商的产品介绍/Support资料，大致就能明白了</p><p>比如<a target="_blank" rel="noopener" href="https://support-it.huawei.com/storage/docs/zh-cn/oceanstor-100d-8.0.3/network-planning-guide/net_plan_000027.html">这里</a>是来自Huawei的40GE的物理方案</p><p>这个领域非常复杂而且需要经验，尤其是主备切换的单点故障细节真的多，往往定位需要一天。比如有次实施人员将数据盘和系统盘挂到一起，等存储负载上来后发现vi都卡，最终用lsblk才发现硬盘速度都影响OS了，导致告警组件超时而频繁切选举。</p><h2>存算分离</h2><p>所谓的超融合方案</p><h4>VM/云方案</h4><p>VM可以利用远端存储实现直接RDMA对接VM软件，VM再分配给具体的OS，一般采用Cinder+SDN的方案</p><p>可以参考<a target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/zh/doc/EDOC1100115164">这篇</a>文章</p><h4>裸金属物理部署方案</h4><p>OS需要安装在本地，计算数据通过GE/IB线进行直连，实现存算分离，这个的确是紧耦合方案。</p><h2>CSI</h2><p>在应用侧，可以直接挂载磁盘或者使用<a target="_blank" rel="noopener" href="https://kubernetes-csi.github.io/docs/introduction.html">Container Storage Interface (CSI)</a> 来进行wrapper</p><h4>对硬件/云的wrapper</h4><p>比如FusionStorage/CCE提供了K8S的CSI服务，这个没啥毛病</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FusionStorage/CCE -&gt; CSI -&gt; Kubenetes</span><br></pre></td></tr></table></figure><h4>用户态分布式存储</h4><p>这种用户态wrapper的设计其实对应用开发者来说挺鸡肋的，需要跳过FS抽象，并掌握三种技术栈（硬件、CSI、SDS），比如IOMesh要求在每台机器上都要安装磁盘、应用并依赖k8s。</p><ul><li>没有运维能力的开发者，还不如用虚拟化的云硬盘/NFS，或者直接集成S3的SDK</li><li>有运维能力的开发者，必定不敢接这种锅，因为硬盘不归你管，权责不清晰；分散硬件过于繁琐。</li><li>有非常强运维能力的开发者，用高速网线连接集中式硬件存储多香</li></ul><h2>应用层与Local存储</h2><p>业务应用层一般不会实现过于复杂，而是简单的本地切片，比如</p><ul><li>Gitlab代码仓库有两层分片：<ul><li>第一层通过Map结构<code>[key: mountPoint]</code>作为物理挂载点的切片（并存储key到projects表），这种方案不涉及算法，需要人工经验进行分配。</li><li>第二次切片通过sha256(projectId)进行分发。</li></ul></li><li>SVN代码仓库同上，需要在Apache的httpd.conf进行人工经验配置，基于文本存储切片数据</li><li>高级供应商MultiSite为Git/SVN的文件系统进行了二次定制，基于PAXO实现了跨广域网的共识</li></ul></div><div class="tags"><a class="tag-link" href="/tags/IaaS/" rel="tag">IaaS</a><a class="tag-link" href="/tags/Storage/" rel="tag">Storage</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry</a><span>.</span></div></footer></div></body></html>