<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="在每个项目中，可能由于种种历史原因导致项目渐渐腐化陈旧，后续接手时很难维护，处理债务时除了进行代码整改，还要主动推动质量与流程的建设。"><meta name="keyword" content="ITGC,Management,Outsourcing,Refactor"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>如何解决IT系统历史债务与保持后续质量</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://eu.umami.is/script.js" data-website-id="449a84b6-be9e-49de-a4cc-e0fa6fea1df9"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">如何解决IT系统历史债务与保持后续质量</div><div class="date no-print">2018-08-24 / modified at 2025-12-28 / 3.8k words / 12 mins</div><div class="content"><p>在每个项目中，可能由于种种历史原因导致项目渐渐腐化陈旧，后续接手时很难维护，处理债务时除了进行代码整改，还要主动推动质量与流程的建设。</p><span id="more"></span><h2>有哪些历史债务</h2><p>当你满怀期待地（空降/交接）参与到一款项目的开发中，可能发现并没那么简单</p><ul><li>项目架构陈旧，存在技术债。比如：1. 代码文档老旧，频繁换人，导致难以传承；2. 线上故障较多，经常耗时间去定位问题；3. 缺乏安全设计，可能出现泄露等事故</li><li>整个项目运作混乱不堪，比如缺少必要的验收，上线流程，甚至招聘都是拍脑袋做。</li><li>整体开发人员士气差或者能力较弱。</li></ul><p>上述场景最常见于</p><ul><li>接手祖传代码发生</li><li>项目起初赶工，拿奖升级后，最后招一个新员工去接盘</li></ul><p>对于上述问题，抱怨是没有用的，债务永远不会消失，只会转移。处理流程大致为<code>IT审计</code>-<code>修改</code>-<code>维护</code>大致如下</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="MINDMAP" height="472px" preserveAspectRatio="none" style="width:545px;height:472px;background:#fff" version="1.1" viewBox="0 0 545 472" width="545px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="75.9998" x="10" y="217.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.9998" x="20" y="240.0342">&#21382;&#21490;&#20538;&#21153;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="60.6805" x="135.9998" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.6805" x="145.9998" y="99.292">IT&#23457;&#35745;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="75.9998" x="246.6803" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.9998" x="256.6803" y="42.9951">&#38656;&#27714;&#23457;&#35745;</text><path d="M196.6803,94.4453 L206.6803,94.4453 C221.6803,94.4453 221.6803,38.1484 236.6803,38.1484 L246.6803,38.1484" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.9996" x="246.6803" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.9996" x="256.6803" y="99.292">&#24320;&#21457;&#27979;&#35797;&#23457;&#35745;</text><path d="M196.6803,94.4453 L206.6803,94.4453 C221.6803,94.4453 221.6803,94.4453 236.6803,94.4453 L246.6803,94.4453" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="117.9996" x="246.6803" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.9996" x="256.6803" y="155.5889">&#19978;&#32447;&#19982;&#21464;&#26356;&#23457;&#35745;</text><path d="M196.6803,94.4453 L206.6803,94.4453 C221.6803,94.4453 221.6803,150.7422 236.6803,150.7422 L246.6803,150.7422" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M85.9998,235.1875 L95.9998,235.1875 C110.9998,235.1875 110.9998,94.4453 125.9998,94.4453 L135.9998,94.4453" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="75.9998" x="135.9998" y="301.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.9998" x="145.9998" y="324.4795">&#20538;&#21153;&#25913;&#21892;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="89.9997" x="261.9995" y="217.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.9997" x="271.9995" y="240.0342">&#19968;&#27425;&#24615;&#20462;&#22797;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="61.9998" x="401.9992" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.9998" x="411.9992" y="211.8857">&#25216;&#26415;&#20538;</text><path d="M351.9992,235.1875 L361.9992,235.1875 C376.9992,235.1875 376.9992,207.0391 391.9992,207.0391 L401.9992,207.0391" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="89.9997" x="401.9992" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.9997" x="411.9992" y="268.1826">&#23433;&#20840;&#19982;&#21512;&#35268;</text><path d="M351.9992,235.1875 L361.9992,235.1875 C376.9992,235.1875 376.9992,263.3359 391.9992,263.3359 L401.9992,263.3359" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M211.9995,319.6328 L221.9995,319.6328 C236.9995,319.6328 236.9995,235.1875 251.9995,235.1875 L261.9995,235.1875" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="117.9996" x="261.9995" y="357.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.9996" x="271.9995" y="380.7764">&#36136;&#37327;&#19982;&#27969;&#31243;&#24314;&#35774;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.9996" x="429.9991" y="301.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.9996" x="439.9991" y="324.4795">&#30740;&#21457;&#36816;&#32500;&#27969;&#31243;</text><path d="M379.9991,375.9297 L389.9991,375.9297 C404.9991,375.9297 404.9991,319.6328 419.9991,319.6328 L429.9991,319.6328" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.9996" x="429.9991" y="357.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.9996" x="439.9991" y="380.7764">&#39033;&#30446;&#31649;&#29702;&#27969;&#31243;</text><path d="M379.9991,375.9297 L389.9991,375.9297 C404.9991,375.9297 404.9991,375.9297 419.9991,375.9297 L429.9991,375.9297" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="75.9998" x="429.9991" y="414.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.9998" x="439.9991" y="437.0732">&#25307;&#32856;&#27969;&#31243;</text><path d="M379.9991,375.9297 L389.9991,375.9297 C404.9991,375.9297 404.9991,432.2266 419.9991,432.2266 L429.9991,432.2266" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M211.9995,319.6328 L221.9995,319.6328 C236.9995,319.6328 236.9995,375.9297 251.9995,375.9297 L261.9995,375.9297" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M85.9998,235.1875 L95.9998,235.1875 C110.9998,235.1875 110.9998,319.6328 125.9998,319.6328 L135.9998,319.6328" fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><h2>准备工作</h2><p>技术架构腐化一般是上层没有重视（比如压缩工期，频繁换人，需求敷衍等），下游码农趋利避害的产物，难点在于能拿到多少人力资源。</p><p>针对这些挑战，制定如下步骤</p><ul><li>定义目标：即外部合规，内控尚可，人员稳定。</li><li>债务分析：基于IT审计（IT Audit ）流程，将整个IT系统的从源码到发布全流程都进行分析。将过程中发现的问题整理为中立的技术报告，并初步估算时间。</li><li>汇报与授权：针对审计产生的问题，汇报并获取人力投入授权。这一步可能会将领导架在火上烤，因此要按照优先级确保新需求的平衡性。</li><li>债务改善：按照估算的时间进行修复，比如新特性开发与老代码修复分配为3:1的时间。</li><li>质量与流程建设：其实就是通过行政手段引入更多检查点。</li></ul><p>此外，作为夹在上级与基层的中间层，为了自己的健康考虑，我们必须是放下执念，做好权责定界，仅对自己能决策的工作负责，比如改造质量，新人招聘等，不对业务承担无限的精神责任。</p><h2>定义目标</h2><p>我们进行债务处理时，最优先的并不是修复代码或者升级组件，而是确保存量系统的稳定性，如下</p><ul><li>外部合规：确保存量系统不要出现安全事故，在不大改的前提下进行安全加固。</li><li>内部控制：对新代码合并与生产运维等变更流程，进行集权审批，确保不出现低级事故，后续质量跟上来后再放权。</li><li>人员稳定：不要对存量人员进行施压或逼着加班改，而是给一个长期的时间表，这样好歹有个盼头。</li></ul><p>没有彻底摸清楚全部流程，不要急着进行修改，有时很多看似明显的问题都是改不动导致的。</p><h2>债务分析</h2><p>正如开一家餐厅需要掌握制作过程，接手项目第一步最重要的就是审计代码如何流向生产环境。通过洞察生产过程，可以发现与业界的Gap，进而进行重构。</p><ul><li>存量的需求，设计与测试资料</li><li>代码的分支管理与合并流程<ul><li>代码静态/人工检查</li><li>JUnit单元测试，冒烟测试，人工测试</li><li>数据库设计</li><li>业务本身的安全性分析</li><li>开源软件清单</li></ul></li><li>相关CICD/DevOps部署流程<ul><li>组网图，上下游对接系统</li><li>运维告警，特权账号，备份，版本等运维信息</li><li>可回溯性</li><li>安全评估</li></ul></li></ul><p>通过分析上述问题，一般有如下常见风险</p><ul><li>需求或设计文档不完善</li><li>代码可读性差，也没有测试</li><li>数据库设计混乱</li><li>线上部署没有加固，第三方软件版本老旧</li></ul><h2>汇报与授权</h2><p>将上述问题整理为表格对领导进行汇报，然后找领导要人或者项目延期。这个时候作为决策层，在已经有明确的风险下，要有被架在火上烤的觉悟。</p><ul><li>如果决策层认可大部分问题<ul><li>并愿意投入部分时间。那么可喜可贺，按照时间表排期修复即可。</li><li>但是不想投入太多时间。那么只能处理一些简单的债务，比如在不碰源码的情况下更多的监控告警和流程，委婉地延长修复时间。</li></ul></li><li>如果决策层不认可相关问题，这里可能会出现割裂点，比如不做决策当鸵鸟或者想白嫖的“既要又要”，那么必然是制度问题，或者是决策层渎职。此时你在尽责告知后，只有两个选择<ul><li>闭上嘴，从今往后仅对工时与流程负责，证明自己努力过了，保留好相关记录，不对项目负责。</li><li>早点跑路止损</li></ul></li></ul><h2>债务改善</h2><h3>需求测试债务</h3><p>持续补充更新存量的文档。</p><h3>开发债务</h3><p>常见的问题比如缩进，命名以及各种无法通过静态检测工具的场景，还有滥用抽象，滥用设计模式，滥用Map等检测不出来的坏习惯</p><h4>使用服务化隔离烂代码</h4><p>有些业务模块的确写的非常烂，而且重构成本的确比较高，修改任何一块砖都会崩塌，这时我们可以通过服务化将其封装为有状态的业务组件，新开发的组件通过RPC去调用它。这种操作并没有本质上解决遗留问题，但是新组件可以用标准的质量规范去管理开发流程，总体上<strong>分母变大</strong>了，相当于进行“隔离”操作。</p><h4>原子性重构</h4><p>对于技术架构，静态检查等问题，是可以慢慢改的，难点主要是在测试侧的压力比较大。原子性提交流程如下</p><ul><li>TOKEN: 首先对代码进行缩进，imports优化等Token级别的整改，这里不会改变代码编译结果。</li><li>AST: 接着通过inspect等静态检测工具对代码进行修复，比如空判断，无用代码删除整改，这一部分不会影响业务逻辑。</li><li>SEMANTIC: 业务中有互斥，依赖，Switch等代码，就算看不懂业务逻辑，人肉分析语义还是做的到。</li><li>BUSINESS: 针对业务进行具体整改，先排查无用代码，接着补充存量用例，最后再开展重构。</li></ul><p>上面步骤本质上就是实现了人工的编译器优化，每一次都是原子提交，而不要合并到一起。当运行测试用例报错时，很容易通过二分法迅速定位。</p><p>虽然上面只写了短短几行，具体代码改造需要依赖自己读过多少好代码了，可以用Intellij自带的anaylyse，Sonarqube，Openrewrite等工具进行修复。</p><h4>降低代码污染量</h4><p>在很多项目中，我看到有许多人喜欢把文件按照后缀进行划分，比如service专门一个文件夹，controller一个文件夹，js一个文件夹…这样虽然看起来整洁，但是交接后再进行阅读时定位非常累，需要反复地进行JUMP。同时很多能力水平较低的开发，一不小心用了全局变量（比如给你整几个common.js），后期交接就炸了。对此我的建议如下</p><ul><li>一定要明确什么是公共，避免过早进行公共下沉。一般来说公共可以是技术上的（比如后端的JSON工具类，前端的Directive组件），还有可能是业务上的，对此我建议将无状态的工具类统称为Utils，而业务上的，无论前后台都叫做Service（比如数据字典，姓名联想）</li><li>文件按照业务逻辑进行划分，比如js/css/html统一放到一个login业务的文件夹中，而不是分开放，这样就算代码写的烂，也能将污染降低到最低。</li></ul><h4>使用DSL&amp;解释器代替生成器</h4><p>在真实项目中，常见的生成器有Mybatis，SOAP等业务。很多人图方便喜欢用工具一键生成上百行的代码，但是也留下了上百行的维护代价，具体如下</p><ul><li>Genretor生成的代码，后期不管是否用到，开发都不敢动，就算FindUsage搜索全局成本也很高。如果再经过多次VCS迁移，历史记录丢了就更难受了。</li><li>由于生成器生成的代码质量较为一般，容易形成破窗效应，后期开发随意涂改。</li><li>生成后的代码很多业务只是在进行繁琐的样板操作，比如HTTP请求中生成了一堆HttpClient连接Socket的代码。</li><li>如果涉及到对接第三方系统，那么第三方变更可能导致这边代码需要重新生成，而那些开发对生成代码曾经进行过的小patch就丢了。</li></ul><p>针对这些质量问题，我建议如下</p><ul><li>使用更高级的DSL或者“纯函数”来描述业务，比如通过Retrofit/Feign的注解描述请求（比如Swagger生成Feign代码），这类生成后的代码就是一个注解描述的接口，开发者直接<code>@Autowired</code>即可注入，内部请求细节由Feign解释器进行处理。</li><li>使用Inteceptor插件分离副作用，比如Mabatis的通用分页/通用Mapper可以解决所有单表查询问题，而与业务没有关系；还有Feign中可以定制拦截器来进行实现BasicAuth鉴权等业务无关的功能。</li><li>自己写生成DSL的高级生成器，比如通过模版引擎，入参是一个数据库的table，能够生成所有的Controller/js/html，模版是自己手写的，当然定制性比开源更强。</li></ul><p>上面的缺点就是很多新人不会使用，这里就要完善文档，降低学习与沟通成本</p><h4>使用函数式编程降低副作用</h4><p>纵观很多烂代码，偌大的for循环中无非就是为了实现一个GroupBy，或者为了去重而写了一堆HashSet，或者一堆continue，这类问题本质上是“做什么”与“如何迭代”强耦合导致。通过培训Stream技术可以降低代码中的for/continue等冗余代码，而且通过Clousure可以强制降低代码副作用，建议</p><ul><li>开展Java/JS(ES6)中Stream与Lambda表达式培训</li><li>对部分重点代码进行Stream重构，简化逻辑</li></ul><p>针对超级复杂的逻辑业务，我个人一般使用GroupBy与模式匹配(Pattern Match) 提高代码可读性。</p><h3>安全加固</h3><p>对存量系统来说，即使比较烂，大家可能都能忍，但是千万不能在你的手上出现低级的安全问题。</p><p>这里需要引入安全建模流程(Threat Modeling Process) 进行分析，比如 STRIDE 模型，常见的容易修改的问题如下</p><ul><li>明文的敏感信息存放于代码/数据库/配置中心/日志等</li><li>上传下载的入口判断，比如XSS/CSRF</li><li>业务权限的SOD，比如不能让人同时管预算审批与拨款</li><li>开源软件的定期升级</li></ul><h2>质量与流程建设</h2><p>质量与流程本质是<strong>通过集权的行政手段干预开发</strong>，这类管理工具的加入，必然会降低现有的开发速度，但是初期也一定需要投入建设，先固化后改进。</p><h4>研发代码检视与静态检查</h4><ul><li>引入自动化检测工具，比如Sonarqube，以及IDE自带的工具。</li><li>代码合并尽可能还是走人工二次审批，但是可以通过AI检测降低相关成本。</li></ul><h4>文档管理</h4><p>项目中虽然有各种各样的文档，但是大部分公司可能还是用SVN，邮件甚至Word来管理文档，而不是使用Wiki/markdown等工具，导致搜索时比较心累，作为开发者应该如何解决呢？</p><p>此刻需搭建集中式的先进Wiki工具，比如Azure DevOps</p><h3>运维流程</h3><p>同样进行先集权固化后再放权。</p><ul><li>集权阶段，确保接手的任何变化，都需要至少邮件的审批，不要直接进行无授权变更。</li><li>放权阶段，等项目质量稳定后，允许相关人员先斩后奏，以提高效率。</li></ul><h4>项目管理</h4><p>很多项目组中通常是一人兼任需求分析与人员管理，这种场景下将导致需求长期排满，导致没有挤出时间进行基础功能的优化，进而导致人员，代码的进一步恶化。针对这种情况，说白了还是人手不够，那么就更加需要自动化工具的帮助，但是加班代价是不可避免的。</p><ul><li>引入科学管理模型，先达到富士康的模式，尽可能提高搬砖的熟练度</li><li>熟练度提高后，再进行多迭代/下层需求等”敏捷“流程，删掉无用的管控流程</li></ul><h2>人员管理</h2><p>当前承担开发工作的项目人员，针对项目的无底洞想必也心知肚明，因此可能士气低下。</p><ul><li>针对无穷无尽的深坑，需要给出可量化可决策的排期改进点，确保开发人员拿到可度量的工作，能够认为“对得起自己”</li><li>对于无法达到公司标准的开发人员，不要用“主人翁意识”或“比较压力”的维度让他改变看法去加班补效率，而是要及时替换，放过彼此。</li></ul><h2>总结</h2><p>项目债务处理并非单独的代码债务处理，而是一个复杂的IT审计流程。作为项目管理者，最重要是如下的决策</p><ul><li>存量系统维护的投入占比</li><li>集权与放权的平衡</li></ul><h2>参考书籍</h2><ul><li><p>《遗留系统重构实战》</p></li><li><p>《大型网站技术架构: 核心原理与案例分析》</p></li><li><p>《函数相应式领域建模》</p></li><li><p><a target="_blank" rel="noopener" href="https://program-think.blogspot.com/2016/04/Andy-Grove-Quotes-on-Leadership.html">硅谷 CEO 们的教父——分享安迪·格鲁夫的管理经验</a></p></li></ul></div><div class="tags"><a class="tag-link" href="/tags/ITGC/" rel="tag">ITGC</a><a class="tag-link" href="/tags/Management/" rel="tag">Management</a><a class="tag-link" href="/tags/Outsourcing/" rel="tag">Outsourcing</a><a class="tag-link" href="/tags/Refactor/" rel="tag">Refactor</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry.</a><span> All contents are not allowed to be redistributed or synthesised without an explicit permission.</span></div></footer></div></body></html>