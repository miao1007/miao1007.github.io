<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="代码规范是一个老生常谈的问题，涉及到一个码农的软技能。网上有很多类似的文章，但是有些文章比较落后了，因此需要补充新鲜的文章"><meta name="keyword" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>代码规范最佳实践</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-102296742-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-102296742-1")</script><meta name="generator" content="Hexo 5.4.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">代码规范最佳实践</div><div class="date">2016-10-03 / modified at 2022-05-01</div><div class="content"><blockquote><span>️This article has been <strong>over 1 years</strong> since the last update.</span></blockquote><p>代码规范是一个老生常谈的问题，涉及到一个码农的软技能。网上有很多类似的文章，但是有些文章比较落后了，因此需要补充新鲜的文章</p><span id="more"></span><p>主要参考如下</p><ol><li>《编写可读代码的艺术》</li><li>《编程的智慧》</li><li>个人平时积累</li><li>菊花厂(网上自己搜)与<a target="_blank" rel="noopener" href="http://deadlion.cn/2017/02/05/Alibaba-Java-Code-Style.html">月饼厂</a>的编程规范</li></ol><p>我个人对代码规范的要求，主要就是一点：避免自己几个月后看着代码愤而打开提交记录看谁写的渣代码</p><p>下面的内容还是比较新的，从逻辑判断、注释规范等方面进行了思考。</p><h2>1. 代码编写</h2><h3>1.1. 关于if的使用场景</h3><h5>1.1.1. 不要省略if中的其它条件</h5><p>if是很容易犯错的地方，因此不要省略if中的其它条件，就算它什么也不做也要写出来，否则以后将是一个定时炸弹，编译器会把你的括号给自动消除的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(a &lt; <span class="number">2</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(b &gt; <span class="number">3</span>)&#123;</span><br><span class="line">    <span class="comment">//do sth.</span></span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//do nothing</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="comment">//do nothing</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5>1.1.2. 不要使用反义词</h5><p>在使用boolean时，不要使用反义词，减少大脑Parser时间</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bad</span></span><br><span class="line"><span class="type">boolean</span> isNotExistInTable;</span><br><span class="line"><span class="keyword">if</span>(!isNotExistInTable)&#123;</span><br><span class="line">  <span class="comment">//到底判断条件是啥？负负得正？</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//good</span></span><br><span class="line"><span class="type">boolean</span> isEmptyInTable;</span><br><span class="line"><span class="keyword">if</span>(!isEmptyInTable)&#123;</span><br><span class="line">  <span class="comment">//明白了，这里是Table中元素不为空的场景</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5>1.1.3. 尤达表示法</h5><p>尤达表示法曾经在C中非常流行，不过它的时代已经过去了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bad, 多此一举</span></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">null</span> == str)&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//good, 因为编译器或者IDE均会进行校验，写成`str=null`会被检查出来了</span></span><br><span class="line"><span class="keyword">if</span>(str == <span class="literal">null</span>)&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在某些C硬件开发中，编译器无法监测此问题，这样写情有可原。但是在Java中没有必要照搬过来。</p></blockquote><h5>1.1.4. 按照“电路”逻辑进行编写</h5><p>不要把判断全部写到if括号里</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bad</span></span><br><span class="line"><span class="keyword">if</span>(!(age &gt; <span class="number">18</span>)&amp;&amp;!(today - startday &gt; <span class="number">30</span>))&#123;</span><br><span class="line">  <span class="comment">//wtf，大脑分析到一半忘记前面的变量了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面就是按照“电路”逻辑进行编写的，每行一个比较，就算使用了<code>b1</code>,<code>b2</code>这样的命名，也能够看得懂，同时打断点也很舒服</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//good</span></span><br><span class="line"><span class="comment">//必须18以上才能购买</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">b1</span> <span class="operator">=</span> age &gt; <span class="number">18</span>;</span><br><span class="line"><span class="comment">//如果小于等于30天，那么将没有优惠</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">b2</span> <span class="operator">=</span> today - startday &gt; <span class="number">30</span>;</span><br><span class="line"><span class="keyword">if</span>(!(b1&amp;&amp;b2))&#123;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4>1.1.5. 复杂业务不要使用Lambda表达式</h4><p>虽然Java8提供了此方法，但是它与JS、Ruby、Groovy的风格完全不同。在Java中通过接口模拟实现，而在动态语言中通过block或者高阶函数实现，信息量也完全不同，除非全部成员都是极其熟悉被lambda隐藏的操作符。</p><p>不信的话，你写完代码后一个星期后看看是否还看得懂吧。</p><h3>1.2. 关于流程处理</h3><p>流程在业务代码中广泛出现，建议除了面试，<strong>不要在业务</strong>中使用goto、doWhile、continue、break，甚至for/while/iterator代码，它们可以被如下替换</p><ul><li>try/finally</li><li>函数式编程: Java8stream, RxJava, Guava, CommonCollection4, 特别推荐stream，它内部与Haskell一样支持<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/30246634/how-are-lazy-streams-implemented-in-java-8">惰性求值</a>，效率肯定比自己写的轮子更优秀。</li></ul><p>我个人推荐使用函数式表达式，也就是类似于脚本语言的写法来写Java，看黑板：</p><p><img src="http://upload-images.jianshu.io/upload_images/98641-63a51eb7550caf27.gif?imageMogr2/auto-orient/strip" alt="idea_2016_3_streams_intentions_7.gif"></p><h3>1.3. 注释中加入自己的判断与想法</h3><h5>1.3.1. 使用大家都认可的行话</h5><p>比如FIXME，TODO等，这个在Intellij中有快捷键</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//<span class="doctag">FIXME:</span> 在某场景下调用时出现一个异常没有复现，详见xxx工单</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">doWork</span><span class="params">()</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5>1.3.2. 警告他人调用的陷阱</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//警告，内部使用了for循环查表，可能导致阻塞而变慢</span></span><br><span class="line"><span class="keyword">public</span> list&lt;String&gt; <span class="title function_">querybyId</span><span class="params">(List&lt;Node&gt; nodes,<span class="type">long</span> id)</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5>1.3.3. 注释中描述修改的原因</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">doWork</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//根据工单xxx进行修改，处理了某场景问题</span></span><br><span class="line">  sth.doAnother();</span><br><span class="line">  <span class="comment">//虽然看似没用，这样写的原因是....</span></span><br><span class="line">  sth2.doAnother();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>无论何时，只要是你心里所想，只要不是用来粉饰烂代码，就可以写出来，以后代码更新时，可以快速进入状态，避免再次读码而浪费时间</p></blockquote><h5>1.3.4. 对重要的对象提供一个例子</h5><p>在构造变量时，可以通过注释例子帮助理解。不要吝啬代码在VCS中所占用的空间，以免后期查阅文档浪费更多的时间</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* the id of employee, [a-zA-Z0-9/s]&#123;0,12&#125;</span></span><br><span class="line"><span class="comment">* eg: xyz223344</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">String id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* the blur redis, must be power of 2</span></span><br><span class="line"><span class="comment">* eg: 2, 4, 8</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="type">int</span> <span class="variable">BLUR_RADIS</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* return the person whoes age &gt; $&#123;age&#125;</span></span><br><span class="line"><span class="comment">* eg: (18,[14,46,18,50]) -&gt; [46,50]</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Person&gt; <span class="title function_">filterByAge</span><span class="params">(<span class="type">int</span> age, List&lt;Person&gt; person)</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* valid by regex defined in file: xxx.ccc.bbb.xml</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">doVaild</span><span class="params">(String s)</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4>1.4. 使用注解</h4><p>添加注解，让你的IDE更加智能地进行静态检测</p><ol><li>Android: <a target="_blank" rel="noopener" href="https://developer.android.com/studio/write/annotations.html">Improve Code Inspection with Annotations</a>，注意可以将注解设置为provided模式</li><li>Java: 使用JavaX自带包，注意这个包里面老是在变，我个人日常也是只用Null判断</li></ol><h4>1.5. 建立自己的Util</h4><p>除了Apache等出名的工具类外，也可以将自己的通用代码放入Utils中，好处如下</p><ol><li>降低代码量</li><li>对Apache等工具类不完善的地方进行再包装</li><li>写完了可以骗Star（当然我个人不赞同，也不敢用）</li><li>熟悉常用的库，减少自己造轮子</li></ol><h2>2. 编码完成后，使用CodeFormatter</h2><p>代码格式化(CodeFormatter)工具涉及到审美、对齐、缩进、左括号之争。统一的格式能减少代码阅读时的误判。</p><p>我个人推荐用Square/默认的格式，倒入格式后<code>cmd</code> +<code>alt</code> + <code>L</code>即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/square/java-code-styles</span><br></pre></td></tr></table></figure><blockquote><p>如果你所在公司有自己的格式要求，就算你认为“不合理”，也要按照公司大流来</p></blockquote><h2>3. 使用静态分析工具检查源码</h2><p>静态分析工具通过对Java文件的AST进行分析，找出潜在的问题，通过自动化工具节约时间。</p><h4>1. Intellij</h4><p>使用Intellij的代码检查功能，平时尽量清零掉IDE右边的黄色警告（比如未使用的变量、错误的拼写），写完代码后，尽量用<a target="_blank" rel="noopener" href="https://www.jetbrains.com/help/idea/2016.2/running-inspections.html">Inspect</a>去跑一遍整个代码</p><h4>2. FindBugs/PMD/SonarQube</h4><p>这个同上，许多公司都用它作为VCS门禁，没跑通不能上库。在本地环境它可以作为Intellij的插件引入，它是根据class文件进行静态分析的，功能如其名。建议将设置中的报警级别调为最敏感。</p><h2>4. SUM</h2><p>总的来说，代码还是需要积累，建议多看源码，不管是我的文章，还是教你写代码的书籍，还是厚厚的编码规范，都不如直接看现成的代码，各位可以mark下面几个项目，纯函数，没有复杂逻辑</p><ul><li><a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-collections/">https://commons.apache.org/proper/commons-collections/</a></li><li><a target="_blank" rel="noopener" href="https://github.com/google/guava">https://github.com/google/guava</a></li></ul></div><div class="tags"></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry</a><span>.</span></div></footer></div></body></html>