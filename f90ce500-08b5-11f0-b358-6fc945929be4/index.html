<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="In this article, we describe how we successfully packaged our 10+ Spring Boot JARs into an all-in-one Docker image with minimal size, which were originally deployed on cloud Kubernetes instances."><meta name="keyword" content="DevOps,Docker,Kubernetes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Pack Spring Boot JARs into a monolithic Docker image</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://eu.umami.is/script.js" data-website-id="449a84b6-be9e-49de-a4cc-e0fa6fea1df9"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">Pack Spring Boot JARs into a monolithic Docker image</div><div class="date no-print">2025-06-15 / modified at 2025-10-08 / 1k words / 6 mins</div><div class="content"><p>In this article, we describe how we successfully packaged our 10+ Spring Boot JARs into an all-in-one Docker image with minimal size, which were originally deployed on cloud Kubernetes instances.</p><span id="more"></span><h2>Why monolithic deployment?</h2><p>There are plenty of software delivery methods: tarball archives, Linux installer packages, containers, or the Kubernetes Helm ecosystem. All deployments can be automated for Site Reliability Engineering (SRE) teams with reasonable effort. The key consideration is determining who should manage the operating systems and platforms, including Linux passwords, security patches, and Kubernetes clusters.</p><p>Despite deploying containers on cloud-managed Kubernetes being more advantageous—as each container is easy to scale horizontally (CGroup utilization, VM specs) and vertically (by increasing the ReplicaSet)—Kubernetes can be an overhead when deploying in private data centers. This includes purchasing commercial Kubernetes support or hiring Kubernetes administrators. As a result, our application is deployed in two ways:</p><ul><li><p><strong>Cloud</strong>: We manage all cloud virtual machines on Kubernetes clusters, delivering Software as a Service (SaaS) directly to users. Application updates and bug fixes are deployed quickly using blue-green deployments.</p></li><li><p><strong>Private Data Centers (IDCs)</strong>: Each month, we select our stable cloud version, package the application into a single Docker image, and deploy it to the customer’s isolated server rooms. We are responsible for the application; the customer handles the rest.</p></li></ul><p>The diagram below illustrates our product delivery to cloud and on-premise environments:</p><p><img src="/images/monoliths.svg" alt="monoliths"></p><p>Beyond simplified deployment, we also avoid premature optimization:</p><ul><li>Instead of using distributed cache or configuration storage (such as Redis or etcd clusters), we optimize the PostgreSQL instance with more memory buffer. Global locks and key-value storage are managed through database transactions and the application’s memory cache.</li><li>Instead of using overlay networking (such as Consul or Istio), all networking routers and middleware are handled by a local Traefik instance.</li></ul><p>With this monolithic deployment design, our product can be deployed on any machine with acceptable performance.</p><h2>How to create a monolithic image?</h2><h4>The backend</h4><p>For <a target="_blank" rel="noopener" href="http://spring.io/guides/gs/spring-boot-docker">Spring Boot-based</a> Docker images, even a “Hello World” application JAR with JDK can exceed 300 MB. With dozens of JARs, the uncompressed image becomes too large to download efficiently.</p><p>However, Spring Boot images contain significant duplicate content. For example:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Same base image for all</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">17</span></span><br><span class="line"><span class="comment"># Third-party JARs are often identical</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/app.jar app.jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>To reuse third-party JARs inside <code>app.jar</code>, we first extract reusable libraries from the fat JAR using <a target="_blank" rel="noopener" href="https://github.com/GoogleContainerTools/jib">Jib</a>, a container build tool developed by Google. The build process requires a custom <code>jib.yaml</code> script.</p><p>After separating the fat JAR into subdirectories, we merge third-party JARs into a unified location using hash-based symbolic links. The final layout:</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SALT" height="336px" preserveAspectRatio="none" style="width:454px;height:336px;background:#fff" version="1.1" viewBox="0 0 454 336" width="454px" zoomAndPan="magnify" class="kroki">$2<title>Hash-based Layout</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="0" font-weight="bold" lengthAdjust="spacing" textLength="0" x="227.4248" y="15">Hash-based Layout</text></g><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50.3379" x="16" y="48.1387">/opt/app</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="55.166" x="26" y="62.1074">/backend</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="35.6953" x="36" y="76.0762">/AppA</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127.4531" x="46" y="90.0449">your_class_resources</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="76.5293" x="46" y="104.0137">BOOT-INF/lib</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169.4707" x="269.1855" y="104.0137">Libraries with symbolic links</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="203.1855" x="56" y="117.9824">guava-33.1.jar &#8594; b59c67...eba.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198.8555" x="56" y="131.9512">jackson-xx.jar &#8594; c6e523...3ae.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="35.7188" x="36" y="145.9199">/AppB</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127.4531" x="46" y="159.8887">your_class_resources</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="76.5293" x="46" y="173.8574">BOOT-INF/lib</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169.4707" x="269.1855" y="173.8574">Libraries with symbolic links</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="203.1855" x="56" y="187.8262">guava-33.1.jar &#8594; b59c67...eba.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198.8555" x="56" y="201.7949">jackson-xx.jar &#8594; c6e523...3ae.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="35.8652" x="36" y="215.7637">/AppC</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127.4531" x="46" y="229.7324">your_class_resources</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="76.5293" x="46" y="243.7012">BOOT-INF/lib</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169.4707" x="269.1855" y="243.7012">Libraries with symbolic links</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="203.1855" x="56" y="257.6699">guava-33.1.jar &#8594; b59c67...eba.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198.8555" x="56" y="271.6387">jackson-xx.jar &#8594; c6e523...3ae.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="107.6836" x="36" y="285.6074">/backend/libraries</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="178.6641" x="269.1855" y="285.6074">Shared JARs with hash names</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97.9863" x="46" y="299.5762">b59c67...eba.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81.1348" x="269.1855" y="299.5762">Guava library</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97.7695" x="46" y="313.5449">c6e523...3ae.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88.0605" x="269.1855" y="313.5449">Jackson library</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="11.4434" x="46" y="327.5137">...</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="40.3242" x="269.1855" y="327.5137">Others</text><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="9" y="42.9844"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="56.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="57.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="57.9531" y2="57.9531"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="29" y="70.9219"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="71.9219"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="71.9219" y2="71.9219"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="73.9219" y2="85.8906"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="85.8906" y2="85.8906"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="39" y="98.8594"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="73.9219" y2="99.8594"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="99.8594" y2="99.8594"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="101.8594" y2="113.8281"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="113.8281" y2="113.8281"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="101.8594" y2="127.7969"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="127.7969" y2="127.7969"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="29" y="140.7656"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="141.7656"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="141.7656" y2="141.7656"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="143.7656" y2="155.7344"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="155.7344" y2="155.7344"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="39" y="168.7031"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="143.7656" y2="169.7031"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="169.7031" y2="169.7031"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="171.7031" y2="183.6719"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="183.6719" y2="183.6719"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="171.7031" y2="197.6406"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="197.6406" y2="197.6406"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="29" y="210.6094"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="211.6094"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="211.6094" y2="211.6094"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="213.6094" y2="225.5781"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="225.5781" y2="225.5781"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="39" y="238.5469"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="213.6094" y2="239.5469"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="239.5469" y2="239.5469"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="241.5469" y2="253.5156"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="253.5156" y2="253.5156"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="241.5469" y2="267.4844"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="267.4844" y2="267.4844"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="29" y="280.4531"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="281.4531"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="281.4531" y2="281.4531"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="283.4531" y2="295.4219"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="295.4219" y2="295.4219"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="283.4531" y2="309.3906"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="309.3906" y2="309.3906"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="283.4531" y2="323.3594"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="323.3594" y2="323.3594"/></g></svg><p>After hashing dependencies into a shared directory, the monolithic application compresses to 1/8 the original size:</p><ul><li><strong>Original JAR size</strong>: JRE (140 MB) + libraries (130 MB) + application classes (2 MB) = 272 MiB</li><li><strong>10 JARs before compression</strong>: 272 × 10 = 2,720 MB</li><li><strong>10 JARs after compression</strong>: JRE (140 MB) + application classes (2 × 10 = 20 MB) + shared libraries (130 MB) = 290 MB</li></ul><blockquote><p>Some shared libraries may be used by only one application, so the 130 MB might increase.</p></blockquote><p>To maximize compression, manage third-party dependencies with a centralized SBOM (Software Bill of Materials) to unify versions and prevent conflicts (e.g., Guava 33.1 vs. 33.2 across applications).</p><h4>The frontend</h4><p>Frontend static files are served using Caddy or Nginx. Extract assets from your frontend Docker image:</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SALT" height="168px" preserveAspectRatio="none" style="width:238px;height:168px;background:#fff" version="1.1" viewBox="0 0 238 168" width="238px" zoomAndPan="magnify" class="kroki">$2<title>Frontend Layout</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="0" font-weight="bold" lengthAdjust="spacing" textLength="0" x="119.3359" y="15">Frontend Layout</text></g><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50.3379" x="16" y="48.1387">/opt/app</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="55.459" x="26" y="62.1074">/frontend</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62.6543" x="110.1895" y="62.1074">Static files</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="64.1895" x="36" y="76.0762">index.html</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="9.5859" x="36" y="90.0449">js</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="19.1016" x="36" y="104.0137">css</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="22.5996" x="26" y="117.9824">/bin</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="36.2871" x="36" y="131.9512">caddy</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="79.8281" x="110.1895" y="131.9512">Caddy binary</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="22.7285" x="26" y="145.9199">/etc</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54.5625" x="36" y="159.8887">caddyfile</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121.4824" x="110.1895" y="159.8887">Caddy configuration</text><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="9" y="42.9844"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="56.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="57.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="57.9531" y2="57.9531"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="71.9219"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="71.9219" y2="71.9219"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="85.8906"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="85.8906" y2="85.8906"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="99.8594"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="99.8594" y2="99.8594"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="112.8281"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="113.8281"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="113.8281" y2="113.8281"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="115.8281" y2="127.7969"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="127.7969" y2="127.7969"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="140.7656"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="141.7656"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="141.7656" y2="141.7656"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="143.7656" y2="155.7344"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="155.7344" y2="155.7344"/></g></svg><h4>Networking and routing</h4><p>We use Traefik for networking, relying on its auth middleware for header-based authentication. While chosen for our cloud Kubernetes solution, Nginx is a valid alternative if preferred.</p><p>Include these components:</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SALT" height="112px" preserveAspectRatio="none" style="width:297px;height:112px;background:#fff" version="1.1" viewBox="0 0 297 112" width="297px" zoomAndPan="magnify" class="kroki">$2<title>Traefik Layout</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="0" font-weight="bold" lengthAdjust="spacing" textLength="0" x="148.5273" y="15">Traefik Layout</text></g><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50.3379" x="16" y="48.1387">/opt/app</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="22.5996" x="26" y="62.1074">/bin</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="38.8828" x="36" y="76.0762">traefik</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="83.2676" x="118.1758" y="76.0762">Traefik binary</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="22.7285" x="26" y="90.0449">/etc</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="72.1758" x="36" y="104.0137">traefik.yaml</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="171.8789" x="118.1758" y="104.0137">Traefik routing configuration</text><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="9" y="42.9844"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="56.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="57.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="57.9531" y2="57.9531"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="71.9219"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="71.9219" y2="71.9219"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="84.8906"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="85.8906"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="85.8906" y2="85.8906"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="87.8906" y2="99.8594"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="99.8594" y2="99.8594"/></g></svg><h4>Process management</h4><p>Standard Spring Boot images have a single entrypoint to start the JAR. For multiple processes, use <a target="_blank" rel="noopener" href="https://supervisord.org/">Supervisor</a> for process management (provisioning, restarting, shutdown):</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SALT" height="84px" preserveAspectRatio="none" style="width:269px;height:84px;background:#fff" version="1.1" viewBox="0 0 269 84" width="269px" zoomAndPan="magnify" class="kroki">$2<title>Supervisor Layout</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="0" font-weight="bold" lengthAdjust="spacing" textLength="0" x="134.5527" y="15">Supervisor Layout</text></g><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50.3379" x="16" y="48.1387">/opt/app</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="22.7285" x="26" y="62.1074">/etc</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88.1543" x="36" y="76.0762">provision.yaml</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127.9512" x="134.1543" y="76.0762">Startup configuration</text><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="9" y="42.9844"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="56.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="57.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="57.9531" y2="57.9531"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="71.9219"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="71.9219" y2="71.9219"/></g></svg><p>Supervisor manages all processes at startup:</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="MINDMAP" height="301px" preserveAspectRatio="none" style="width:623px;height:301px;background:#fff" version="1.1" viewBox="0 0 623 301" width="623px" zoomAndPan="magnify" class="kroki">$2<title>Supervisor-provisioned processes</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="267.4697" x="176.6621" y="32.9951">Supervisor-provisioned processes</text></g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="94.8057" x="10" y="150.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.8057" x="20" y="173.1826">Supervisor</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="225.3584" x="154.8057" y="57.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.3584" x="164.8057" y="80.292">Traefik (application gateway)</text><path d="M104.8057,168.3359 L114.8057,168.3359 C129.8057,168.3359 129.8057,75.4453 144.8057,75.4453 L154.8057,75.4453" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="139.7725" x="154.8057" y="113.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.7725" x="164.8057" y="136.5889">Caddy (frontend)</text><path d="M104.8057,168.3359 L114.8057,168.3359 C129.8057,168.3359 129.8057,131.7422 144.8057,131.7422 L154.8057,131.7422" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="52.5938" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="126.292" x="154.8057" y="170.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.8535" x="164.8057" y="193.1826">Spring Boot</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106.292" x="164.8057" y="209.4795">(Built using Jib)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="277.6963" x="334.0977" y="173.8857">java -XX:MaxRAMPercentage=10 -jar ...</text><path d="M281.0977,196.4844 L291.0977,196.4844 C306.0977,196.4844 306.0977,169.0391 321.0977,169.0391 L331.0977,169.0391" fill="none" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="277.6963" x="334.0977" y="192.1826">java -XX:MaxRAMPercentage=10 -jar ...</text><path d="M281.0977,196.4844 L291.0977,196.4844 C306.0977,196.4844 306.0977,187.3359 321.0977,187.3359 L331.0977,187.3359" fill="none" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="13.3506" x="334.0977" y="210.4795">...</text><path d="M281.0977,196.4844 L291.0977,196.4844 C306.0977,196.4844 306.0977,205.6328 321.0977,205.6328 L331.0977,205.6328" fill="none" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="277.6963" x="334.0977" y="228.7764">java -XX:MaxRAMPercentage=10 -jar ...</text><path d="M281.0977,196.4844 L291.0977,196.4844 C306.0977,196.4844 306.0977,223.9297 321.0977,223.9297 L331.0977,223.9297" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M104.8057,168.3359 L114.8057,168.3359 C129.8057,168.3359 129.8057,196.4844 144.8057,196.4844 L154.8057,196.4844" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="131.8906" x="154.8057" y="243.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.8906" x="164.8057" y="266.0732">crond (optional)</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="83.834" x="336.6963" y="243.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.834" x="346.6963" y="266.0732">logrotate</text><path d="M286.6963,261.2266 L296.6963,261.2266 C311.6963,261.2266 311.6963,261.2266 326.6963,261.2266 L336.6963,261.2266" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M104.8057,168.3359 L114.8057,168.3359 C129.8057,168.3359 129.8057,261.2266 144.8057,261.2266 L154.8057,261.2266" fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><p>There could be <a target="_blank" rel="noopener" href="https://github.com/Supervisor/supervisor/issues/122">overloading</a> during the startup, you might add flock or sleep as a workaround.</p><h2>The final build</h2><p>After completing all steps, we achieve this layout:</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SALT" height="489px" preserveAspectRatio="none" style="width:454px;height:489px;background:#fff" version="1.1" viewBox="0 0 454 489" width="454px" zoomAndPan="magnify" class="kroki">$2<title>Final Layout</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="0" font-weight="bold" lengthAdjust="spacing" textLength="0" x="227.4248" y="15">Final Layout</text></g><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50.3379" x="16" y="48.1387">/opt/app</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="55.166" x="26" y="62.1074">/backend</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="35.6953" x="36" y="76.0762">/AppA</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127.4531" x="46" y="90.0449">your_class_resources</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="76.5293" x="46" y="104.0137">BOOT-INF/lib</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169.4707" x="269.1855" y="104.0137">Libraries with symbolic links</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="203.1855" x="56" y="117.9824">guava-33.1.jar &#8594; b59c67...eba.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198.8555" x="56" y="131.9512">jackson-xx.jar &#8594; c6e523...3ae.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="35.7188" x="36" y="145.9199">/AppB</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127.4531" x="46" y="159.8887">your_class_resources</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="76.5293" x="46" y="173.8574">BOOT-INF/lib</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169.4707" x="269.1855" y="173.8574">Libraries with symbolic links</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="203.1855" x="56" y="187.8262">guava-33.1.jar &#8594; b59c67...eba.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198.8555" x="56" y="201.7949">jackson-xx.jar &#8594; c6e523...3ae.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="35.8652" x="36" y="215.7637">/AppC</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127.4531" x="46" y="229.7324">your_class_resources</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="76.5293" x="46" y="243.7012">BOOT-INF/lib</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169.4707" x="269.1855" y="243.7012">Libraries with symbolic links</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="203.1855" x="56" y="257.6699">guava-33.1.jar &#8594; b59c67...eba.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198.8555" x="56" y="271.6387">jackson-xx.jar &#8594; c6e523...3ae.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="52.5176" x="36" y="285.6074">/libraries</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="178.6641" x="269.1855" y="285.6074">Shared JARs with hash names</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97.9863" x="46" y="299.5762">b59c67...eba.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81.1348" x="269.1855" y="299.5762">Guava library</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97.7695" x="46" y="313.5449">c6e523...3ae.jar</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88.0605" x="269.1855" y="313.5449">Jackson library</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="11.4434" x="46" y="327.5137">...</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="55.459" x="26" y="341.4824">/frontend</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62.6543" x="269.1855" y="341.4824">Static files</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="64.1895" x="36" y="355.4512">index.html</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="9.5859" x="36" y="369.4199">js</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="19.1016" x="36" y="383.3887">css</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="22.5996" x="26" y="397.3574">/bin</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="36.2871" x="36" y="411.3262">caddy</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="79.8281" x="269.1855" y="411.3262">Caddy binary</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="38.8828" x="36" y="425.2949">traefik</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="83.2676" x="269.1855" y="425.2949">Traefik binary</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="22.7285" x="26" y="439.2637">/etc</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54.5625" x="36" y="453.2324">caddyfile</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121.4824" x="269.1855" y="453.2324">Caddy configuration</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="72.1758" x="36" y="467.2012">traefik.yaml</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88.4648" x="269.1855" y="467.2012">Traefik routing</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88.1543" x="36" y="481.1699">provision.yaml</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127.9512" x="269.1855" y="481.1699">Startup configuration</text><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="9" y="42.9844"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="56.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="57.9531"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="57.9531" y2="57.9531"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="29" y="70.9219"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="71.9219"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="71.9219" y2="71.9219"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="73.9219" y2="85.8906"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="85.8906" y2="85.8906"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="39" y="98.8594"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="73.9219" y2="99.8594"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="99.8594" y2="99.8594"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="101.8594" y2="113.8281"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="113.8281" y2="113.8281"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="101.8594" y2="127.7969"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="127.7969" y2="127.7969"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="29" y="140.7656"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="141.7656"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="141.7656" y2="141.7656"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="143.7656" y2="155.7344"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="155.7344" y2="155.7344"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="39" y="168.7031"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="143.7656" y2="169.7031"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="169.7031" y2="169.7031"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="171.7031" y2="183.6719"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="183.6719" y2="183.6719"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="171.7031" y2="197.6406"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="197.6406" y2="197.6406"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="29" y="210.6094"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="211.6094"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="211.6094" y2="211.6094"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="213.6094" y2="225.5781"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="225.5781" y2="225.5781"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="39" y="238.5469"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="213.6094" y2="239.5469"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="239.5469" y2="239.5469"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="241.5469" y2="253.5156"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="253.5156" y2="253.5156"/><line style="stroke:#888;stroke-width:1" x1="40" x2="40" y1="241.5469" y2="267.4844"/><line style="stroke:#888;stroke-width:1" x1="40" x2="48" y1="267.4844" y2="267.4844"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="29" y="280.4531"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="59.9531" y2="281.4531"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="281.4531" y2="281.4531"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="283.4531" y2="295.4219"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="295.4219" y2="295.4219"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="283.4531" y2="309.3906"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="309.3906" y2="309.3906"/><line style="stroke:#888;stroke-width:1" x1="30" x2="30" y1="283.4531" y2="323.3594"/><line style="stroke:#888;stroke-width:1" x1="30" x2="38" y1="323.3594" y2="323.3594"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="336.3281"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="337.3281"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="337.3281" y2="337.3281"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="339.3281" y2="351.2969"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="351.2969" y2="351.2969"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="339.3281" y2="365.2656"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="365.2656" y2="365.2656"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="339.3281" y2="379.2344"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="379.2344" y2="379.2344"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="392.2031"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="393.2031"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="393.2031" y2="393.2031"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="395.2031" y2="407.1719"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="407.1719" y2="407.1719"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="395.2031" y2="421.1406"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="421.1406" y2="421.1406"/><rect fill="none" height="2" style="stroke:#888;stroke-width:1" width="2" x="19" y="434.1094"/><line style="stroke:#888;stroke-width:1" x1="10" x2="10" y1="45.9844" y2="435.1094"/><line style="stroke:#888;stroke-width:1" x1="10" x2="18" y1="435.1094" y2="435.1094"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="437.1094" y2="449.0781"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="449.0781" y2="449.0781"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="437.1094" y2="463.0469"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="463.0469" y2="463.0469"/><line style="stroke:#888;stroke-width:1" x1="20" x2="20" y1="437.1094" y2="477.0156"/><line style="stroke:#888;stroke-width:1" x1="20" x2="28" y1="477.0156" y2="477.0156"/></g></svg><p>The final Dockerfile pseudocode:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 130 MB</span></span><br><span class="line"><span class="keyword">FROM</span> jre:<span class="number">17</span></span><br><span class="line"><span class="comment"># 70 MB</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install supervisor ...</span></span><br><span class="line"><span class="comment"># 60 MB after UPX compression</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> &lt;binaries: caddy/traefik&gt;</span></span><br><span class="line"><span class="comment"># ~150 MB</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> &lt;JAR dependencies (symbolic links created during build)&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> &lt;etc configuration&gt;</span></span><br><span class="line"><span class="comment"># ~20 MB</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> &lt;business classes&gt;</span></span><br><span class="line"><span class="comment"># ~20 MB</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> &lt;frontend assets&gt;</span></span><br><span class="line"><span class="comment"># Rootless operation</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> &lt;useradd&gt;</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span> <span class="number">8443</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> &lt;launch supervisor&gt;</span></span><br></pre></td></tr></table></figure><p>This produces a Docker image of approximately 500 MB.</p><h2>Appendix</h2><h4>Open source tools used</h4><ul><li><a target="_blank" rel="noopener" href="https://supervisord.org/">Supervisor</a>: Process management</li><li><a target="_blank" rel="noopener" href="https://traefik.io/">Traefik</a>: Application gateway</li><li><a target="_blank" rel="noopener" href="https://caddyserver.com/">Caddy</a>: Serves static frontend assets</li><li><a target="_blank" rel="noopener" href="https://upx.github.io/">UPX</a>: Compresses executable binaries (especially effective for Go applications like Traefik)</li><li><a target="_blank" rel="noopener" href="https://github.com/wagoodman/dive">Dive</a>: Docker image layer inspection</li><li><strong>Java ecosystem</strong>:<ul><li><a target="_blank" rel="noopener" href="https://maven.apache.org/">Maven</a>: Manages Spring Boot applications and dependencies via centralized SBOM</li><li><a target="_blank" rel="noopener" href="https://github.com/GoogleContainerTools/jib">Jib</a>: Separates application code from third-party libraries</li><li><a target="_blank" rel="noopener" href="https://flywaydb.org/">Flyway</a>: Database schema management</li></ul></li></ul></div><div class="tags"><a class="tag-link" href="/tags/DevOps/" rel="tag">DevOps</a><a class="tag-link" href="/tags/Docker/" rel="tag">Docker</a><a class="tag-link" href="/tags/Kubernetes/" rel="tag">Kubernetes</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry.</a><span> All contents are not allowed to be redistributed or synthesised without an explicit permission.</span></div></footer></div></body></html>