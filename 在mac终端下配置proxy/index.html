<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="Gradle下载jar包慢到飞起？Github同步一半断了？Docker下载频繁报错？是时候为你的终端统一设置一个代理了。本文以Mac(Unix平台)与HTTP_PROXY为例，讲解如何在终端下进行配置代理。"><meta name="keyword" content="Mac"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>在Mac终端下配置Proxy</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"></head><body class="container"><header id="header"><div class="header"><div class="header-left"><div class="author"><div class="author-name"><a href="/">諺</a></div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">Archives</a></li><li style="font-size:.9rem"><a href="/archives" rel="nofollow">zh</a></li><li style="font-size:.9rem"><a href="#" rel="nofollow">|</a></li><li style="font-size:.9rem"><a href="/en" rel="nofollow">en</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">Epistemology</a></li><li><a href="/books" rel="nofollow">読書</a></li></ul></div></div></header><div class="content-wrapper"><div class="post"><section class="article"><div class="title">在Mac终端下配置Proxy</div><div class="date">2015-11-21に投稿</div><div class="content"><p>Gradle下载jar包慢到飞起？Github同步一半断了？Docker下载频繁报错？是时候为你的终端统一设置一个代理了。本文以Mac(Unix平台)与HTTP_PROXY为例，讲解如何在终端下进行配置代理。</p><span id="more"></span><blockquote><p>本文章属于笔记类型，质量远不如技术类文章，但是网上关于此内容的靠谱信息实在不多，故记录下来。</p></blockquote><h2>1. 选择Proxy</h2><p>首先，要购买挑选一个Proxy，购买前需要注意服务商需要能够提供<code>Http Proxy</code>，或者使用<a target="_blank" rel="noopener" href="https://github.com/cyfdecyf/cow">Cow</a>配合SS</p><h2>2. 配置终端</h2><h4>2.1. 打开终端Terminal</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用bash的终端使用这个文件</span></span><br><span class="line">open -t  ~/.bash_profile</span><br><span class="line"><span class="comment"># 如果用zsh的话，用下面的文件，没有就新建一个文件</span></span><br><span class="line">open -t ~/.zshenv</span><br></pre></td></tr></table></figure><blockquote><p>.bash_profile 可以理解为Term打开后能够自动执行的脚本文件</p></blockquote><h4>2.2. 在文本中添加如下内容</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#proxy </span></span><br><span class="line">LANTERN=<span class="string">&#x27;127.0.0.1:8787&#x27;</span></span><br><span class="line"><span class="comment"># 需要手动开启</span></span><br><span class="line">SS=<span class="string">&#x27;127.0.0.1:1087&#x27;</span></span><br><span class="line">COW=<span class="string">&#x27;127.0.0.1:7777&#x27;</span></span><br><span class="line">POLIPO=<span class="string">&#x27;127.0.0.1:8123&#x27;</span></span><br><span class="line">defp=<span class="variable">$POLIPO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># No Proxy</span></span><br><span class="line"><span class="keyword">function</span> noproxy</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">unset</span> http_proxy HTTP_PROXY https_proxy HTTPS_PROXY all_proxy ALL_PROXY ftp_proxy FTP_PROXY dns_proxy DNS_PROXY JAVA_OPTS GRADLE_OPTS MAVEN_OPTS</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;clear proxy done&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> setproxy</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ]</span><br><span class="line">	<span class="keyword">then</span></span><br><span class="line">		inArg=<span class="variable">$defp</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		inArg=<span class="variable">$1</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	HOST=$(<span class="built_in">echo</span> <span class="variable">$inArg</span> |cut -d: -f1)</span><br><span class="line">	PORT=$(<span class="built_in">echo</span> <span class="variable">$inArg</span> |cut -d: -f2)</span><br><span class="line">	http_proxy=http://<span class="variable">$HOST</span>:<span class="variable">$PORT</span></span><br><span class="line">	HTTP_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">	all_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">	ALL_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">	ftp_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">	FTP_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">	dns_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">	DNS_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">	https_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">	HTTPS_PROXY=<span class="variable">$https_proxy</span></span><br><span class="line">	JAVA_OPTS=<span class="string">&quot;-Dhttp.proxyHost=<span class="variable">$HOST</span> -Dhttp.proxyPort=<span class="variable">$PORT</span> -Dhttps.proxyHost=<span class="variable">$HOST</span> -Dhttps.proxyPort=<span class="variable">$PORT</span>&quot;</span></span><br><span class="line">	GRADLE_OPTS=<span class="string">&quot;-Dgradle.user.home=<span class="variable">$HOME</span>/.gradle&quot;</span></span><br><span class="line">	MAVEN_OPTS=<span class="variable">$JAVA_OPTS</span></span><br><span class="line"> no_proxy=<span class="string">&quot;.cn,.aliyun.com,localhost,127.0.0.1,localaddress,.huaweicloud.com,.localdomain.com,.coding.net,192.168.99.100,.ruby-china.org&quot;</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;current proxy is <span class="variable">$&#123;http_proxy&#125;</span>&quot;</span></span><br><span class="line">	<span class="built_in">export</span> no_proxy http_proxy HTTP_PROXY https_proxy HTTPS_PROXY all_proxy ALL_PROXY ftp_proxy FTP_PROXY dns_proxy DNS_PROXY JAVA_OPTS GRADLE_OPTS MAVEN_OPTS</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setproxy</span><br></pre></td></tr></table></figure><h4>2.3. 保存配置</h4><p>重启shell即可</p><blockquote><p>该方法配置好后，在IDEA等工具的<code>终端</code>下同样有用，但是IDEA本身的maven, gradle需要再次配置</p></blockquote><h2>3. 使用</h2><p>打开终端后，默认会提示正在使用默认的<code>$defp</code>地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">current proxy is http://127.0.0.1:8123</span><br></pre></td></tr></table></figure><p>当不需要时，可以执行<code>noproxy</code>以取消</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> noproxy</span> </span><br><span class="line">clear proxy done</span><br></pre></td></tr></table></figure><p>当然可以在某些情况下手动修改地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> setproxy <span class="variable">$depf</span></span></span><br><span class="line">current proxy is http://127.0.0.1:8123</span><br><span class="line"><span class="meta">$</span><span class="bash"> setproxy <span class="variable">$LANTERN</span></span></span><br><span class="line">current proxy is http://127.0.0.1:8787</span><br><span class="line"><span class="meta">$</span><span class="bash"> setproxy 127.0.0.1:443</span></span><br><span class="line">current proxy is http://127.0.0.1:443</span><br></pre></td></tr></table></figure><h2>4. 查看效果</h2><p>我们可以执行curl的命令，此网站会自动告诉了你当前的位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://ifconfig.co/country</span><br><span class="line">Hong Kong</span><br></pre></td></tr></table></figure><p>我们也可以使用wget/curl进行SpeedTest</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试下载(run speed <span class="built_in">test</span>)</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget -O /dev/null http://speedtest-sfo1.digitalocean.com/10mb.test</span></span><br></pre></td></tr></table></figure><p>最难折腾的Gradle现在也飞速了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 折腾Gradle项目</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> gradle package -d</span></span><br></pre></td></tr></table></figure><p>最后，体验Git，Brew，Gradle等工具的飞速下载吧！</p><blockquote><p>注意：</p><ol><li>Mac的Docker环境下需要在虚拟机/VPS中进行配置Proxy，强烈推荐直接用Liunx的VM来搞，不要折腾Docker for Mac</li><li>亲测Go，Git，Brew，Curl，Wget，NPM是可以正常使用的，可以达到物理带宽</li><li>不支持<code>git://</code>与<code>svn://</code>，那两个是基于socket的，你可以使用Cow配置</li><li>如果需要设置内网地址的正则（比如192，10，172），目前暂时没有完美的方案，只能枚举并手动加入<code>no_proxy</code>中</li><li>Gradle是java相关的，用的不是curl，所以需要<code>JAVA_OPTS</code>作为环境变量，注意这个环境变量只是终端的，而不是IDE下的</li></ol></blockquote><h2>附录</h2><h4>Cow的配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/.cow/rc</span><br><span class="line"><span class="comment"># uncomment </span></span><br><span class="line">alwaysProxy=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 启动 </span></span><br><span class="line">$./cow --debug</span><br></pre></td></tr></table></figure><p>可以配置plist使它自动启动</p><h4>polipo的配置</h4><p>这个主要是配合$$使用的，是目前的主流手段，安装后执行如下命令即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装polipo</span></span><br><span class="line">brew install polipo</span><br><span class="line"><span class="comment"># 执行Socket转换</span></span><br><span class="line">polipo socksParentProxy=localhost:1080</span><br></pre></td></tr></table></figure><blockquote><p>AD: 我目前使用的服务器商<a target="_blank" rel="noopener" href="https://spccloud.southeastasia.cloudapp.azure.com/aff.php?aff=301">AFF地址</a>，一定不要买多，防止跑路</p></blockquote><h4>Intellij下的Gradle/maven配置</h4><p>虽然本文讲的是Terminals的Proxy，但是Intellij的用户也很多。因此也介绍下吧</p><p>首先打开Preference，点击</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Build,Execution,Deployment &gt; Build Tools &gt; Gradle</span><br></pre></td></tr></table></figure><p>配置Gradle VM options(以polipo为例，使用其它工具的自己改端口)</p><p>下文的<code>-d</code>表示啰嗦模式，如果你确认已经ok，可以把它删除。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dhttp.proxyHost=localhost -Dhttp.proxyPort=8123 -Dhttps.proxyHost=localhost -Dhttps.proxyPort=8123 -d</span><br></pre></td></tr></table></figure><p>这样你用鼠标点击Build后，它就会自动走代理了</p><blockquote><p>我个人更推荐直接在终端里跑完(比如mvn package)，然后再打开IDEA，这时所有的依赖已经下载完了</p></blockquote><h4>清空DNS缓存</h4><p>如果仍然无法连接，试试清空DNS</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 处理DNS投毒遗留缓存</span></span><br><span class="line">sudo killall -HUP mDNSResponder</span><br></pre></td></tr></table></figure><h4>Docker配置</h4><p>在Mac下推荐使用VM Fusion的vctl，直接使用上文的环境变量即可</p><h4>配置Mirror</h4><p>如果你舍不得钱，可以使用mirror而不用代理，比如<a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/">HuaweiCloud Mirror</a></p></div><div class="tags"><a class="tag-link" href="/tags/Mac/" rel="tag">Mac</a></div></section><ul class="nav"><li>Prev:<a href="/retrofit2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/">Retrofit2源码分析[动态代理]</a></li><li>Next:<a href="/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8Brxjava%E6%93%8D%E4%BD%9C%E5%AE%9E%E4%BE%8B/">函数式编程RxJava操作实例</a></li></ul><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the<a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus</a></noscript></div></div></div></div><footer><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry</a><span>.</span></div></footer><script>window.onload=function(){var a,e,n,t;a=window,e=document,t="script",n="ga",a.GoogleAnalyticsObject=n,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=+new Date,n=e.createElement(t),t=e.getElementsByTagName(t)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",t.parentNode.insertBefore(n,t),ga("create","UA-102296742-1","auto"),ga("send","pageview")}</script></body></html>