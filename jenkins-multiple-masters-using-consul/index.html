<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="Consul is HashiCorp’s service networking solution for naming service. In this post, we will show how to use consul to design serverless Jenkins clusters."><meta name="keyword" content="Consul,DevOps,Jenkins,System Design"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Jenkins multiple masters using Consul</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"></head><body class="container"><header id="header"><div class="header"><div class="header-left"><div class="author"><div class="author-name"><a href="/">諺</a></div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">Archives</a></li><li style="font-size:.9rem"><a href="/archives" rel="nofollow">zh</a></li><li style="font-size:.9rem"><a href="#" rel="nofollow">|</a></li><li style="font-size:.9rem"><a href="/en" rel="nofollow">en</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">Epistemology</a></li><li><a href="/books" rel="nofollow">読書</a></li></ul></div></div></header><div class="content-wrapper"><div class="post"><section class="article"><div class="title">Jenkins multiple masters using Consul</div><div class="date">2019-11-26に投稿</div><div class="content"><p>Consul is HashiCorp’s service networking solution for naming service. In this post, we will show how to use consul to design serverless Jenkins clusters.</p><span id="more"></span><p>For small or Enterprise teams. there are many DevOps tools to choose.</p><div style="overflow-x:scroll"><table><thead><tr><th></th><th>Small Teams</th><th>Enterprise</th><th>Price</th></tr></thead><tbody><tr><td>SAAS</td><td>CircleCI, Azure, Codefresh, Github Action</td><td>Depends on the security level.</td><td>Pay as pipeline time</td></tr><tr><td>Self-hosted</td><td>single free Jenkins instance is enough.</td><td>Buy enterprise license of SAAS/Jenkins, or develop from Jenkins OSS version.</td><td>Infrastructure/Software License/customization</td></tr></tbody></table></div><p>This post is for readers</p><ul><li>Who are interested in Jenkins’s details.</li><li>Who are in a large team looking for a self-hosting open source(or vendor-neutral) solution, <strong>and</strong> have the ability and time to customize the Jenkins.</li><li>This post contains high-level thoughts only, the implementation may cost 6～15 man-months, and there is no open-source product available.</li></ul><h2>Liebig’s law of Jenkins</h2><p>For historical reasons, Jenkins uses a memory and file based solution to maintain the running job status.</p><div style="overflow-x:scroll"><table><thead><tr><th>Running status</th><th>Internal</th><th>Problems</th></tr></thead><tbody><tr><td>Configuration</td><td>XML file based</td><td>Not too bad</td></tr><tr><td>Queue</td><td>ArrayList</td><td>central embedded queue</td></tr><tr><td>Agent</td><td>ConcurrentSkipListMap</td><td>log(n) complexity, may slow when too much.</td></tr><tr><td>Running Jobs</td><td>Bind to agent</td><td>real-time scheduling.</td></tr><tr><td>Logs</td><td>sent from agent into master</td><td>log/network stress.</td></tr></tbody></table></div><h4>Existing multiple masters solutions</h4><p>To overcome the problem, there are some solutions already.</p><ul><li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/binary-log.html">Binlog-like</a> solution: Using <code>SCM Sync configuration plugin</code>/rsync/Enterprise version or Shared NFS to replicate settings from one to another. However, it is just a hot standby failover solution, only <strong>one</strong> Jenkins instance is working.</li><li>Strong consistent solution: You need to implement a centralized lock(Database/RAFT/WAL) to ensure each write waits until confirmation is received from both master and slave, that means you may <strong>need a team</strong> to modify and maintain the core source code from Jenkins.</li><li>Sharding based solution: split jenkins instances into disjoint services. A global and dynamic mapping(consistent hash or else) between users(tenant) and services is required.<ul><li>ClientSide mapping: <a target="_blank" rel="noopener" href="https://docs.openstack.org/infra/publications/gearman-plugin">Gearman</a> is the <strong>real</strong> multiple masters’ solution, the masters are ‘Jobs’ in Gearman. However the <a target="_blank" rel="noopener" href="https://opendev.org/x/gearman-plugin/">repository</a> is unmaintained for nearly 5 years, and it’s <a target="_blank" rel="noopener" href="https://opendev.org/jjb/jenkins-job-builder">cli</a> is more like an Ansible solution, there is no open source Jenkins GUI in this solution.</li><li>ServerSide mapping: create a praefect load balancer like Nginx/citus, however they are hard to be maintained and upgraded.</li></ul></li><li>Sidecar based solution: Using AOP and wrappers to forward RESTful services, webhooks and logs into a centralized datalake.</li></ul><p>Here is a summary</p><table><thead><tr><th>Solution</th><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td>Binlog</td><td>easy to create</td><td>only <strong>one</strong> instance is working, bind with NFS/rsync</td></tr><tr><td>Global lock</td><td>Real HA</td><td>patch and maintain source code.</td></tr><tr><td>Sharding</td><td>Easy to understand</td><td>Maintain the mapping</td></tr><tr><td>Sidecar</td><td>AOP based</td><td>Too much works to be wrapped &amp;&amp; too much stacks</td></tr></tbody></table><h2>Serverless</h2><h4>What is serverless?</h4><p>Serverless is stateless(or states are moved outside). In Jenkins, that means your Jenkins instance is only a jenkinsfile interceptor, which has no bind with the local database(in JENKINS_HOME).</p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iNTVweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjM3MHB4O2hlaWdodDo1NXB4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMzcwIDU1IiB3aWR0aD0iMzcwcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzPjxmaWx0ZXIgaGVpZ2h0PSIzMDAlIiBpZD0iZjE5OTV0eTFvdXhyc3IiIHdpZHRoPSIzMDAlIiB4PSItMSIgeT0iLTEiPjxmZUdhdXNzaWFuQmx1ciByZXN1bHQ9ImJsdXJPdXQiIHN0ZERldmlhdGlvbj0iMi4wIi8+PGZlQ29sb3JNYXRyaXggaW49ImJsdXJPdXQiIHJlc3VsdD0iYmx1ck91dDIiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAuNCAwIi8+PGZlT2Zmc2V0IGR4PSI0LjAiIGR5PSI0LjAiIGluPSJibHVyT3V0MiIgcmVzdWx0PSJibHVyT3V0MyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImJsdXJPdXQzIiBtb2RlPSJub3JtYWwiLz48L2ZpbHRlcj48L2RlZnM+PGc+PCEtLU1ENT1bZTdkZTJjNzFjYTBmMjA1YjRjYzE2ZGQyZTE0YjAwNWJdCmVudGl0eSBqLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2YxOTk1dHkxb3V4cnNyKSIgaGVpZ2h0PSIzNi43OTk5IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI4NCIgeD0iNyIgeT0iNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY0IiB4PSIxNyIgeT0iMzAuOTk5OSI+SmVua2luc2ZpbGU8L3RleHQ+PCEtLU1ENT1bZTYwMDFhZjE2ZDQ3NzRlMGZkYWQyNzE1NTcwMTE5ZDldCmVudGl0eSBtYXN0ZXItLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZjE5OTV0eTFvdXhyc3IpIiBoZWlnaHQ9IjM2Ljc5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjEzNCIgeD0iMTI2IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0IiB4PSIxMzYiIHk9IjMwLjk5OTkiPkplbmtpbnNmaWxlIFJ1bm5lcjwvdGV4dD48IS0tTUQ1PVs1NWVhZDExZjI3OWQ0M2E0OWRmODNlNzNiZmNiMDc4M10KZW50aXR5IG91dC0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmMTk5NXR5MW91eHJzcikiIGhlaWdodD0iMzYuNzk5OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNjMiIHg9IjI5NS41IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMiIHg9IjMwNS41IiB5PSIzMC45OTk5Ij5PdXRwdXQ8L3RleHQ+PCEtLU1ENT1bNmFhY2FhZDk1MjQwNjU4YmIyOTBiNzk4ZjcxM2RjMDVdCmxpbmsgaiB0byBtYXN0ZXItLT48cGF0aCBkPSJNOTEuMTksMjUuNSBDMTAxLjAxLDI1LjUgMTEwLjgzLDI1LjUgMTIwLjY1LDI1LjUgIiBmaWxsPSJub25lIiBpZD0iai10by1tYXN0ZXIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTI1Ljc5LDI1LjUsMTE2Ljc5LDIxLjUsMTIwLjc5LDI1LjUsMTE2Ljc5LDI5LjUsMTI1Ljc5LDI1LjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjwhLS1NRDU9W2VkZDhlZjViODQ5ZTkwZTMwMGUwYzhlNWM4YjFjODZhXQpsaW5rIG1hc3RlciB0byBvdXQtLT48cGF0aCBkPSJNMjYwLjI2LDI1LjUgQzI3MC4yNSwyNS41IDI4MC4yNCwyNS41IDI5MC4yMywyNS41ICIgZmlsbD0ibm9uZSIgaWQ9Im1hc3Rlci10by1vdXQiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMjk1LjQ2LDI1LjUsMjg2LjQ2LDIxLjUsMjkwLjQ2LDI1LjUsMjg2LjQ2LDI5LjUsMjk1LjQ2LDI1LjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjwhLS1NRDU9W2ViYTgxZGIxNzllM2ZjMmMxMDdkYjY1OThkNmNiNjc2XQpAc3RhcnR1bWwNCmFnZW50IGogYXMgIkplbmtpbnNmaWxlIiANCmFnZW50IG1hc3RlciBhcyAiSmVua2luc2ZpbGUgUnVubmVyIiANCmFnZW50IG91dCBhcyAiT3V0cHV0IiANCmogLT4gbWFzdGVyDQptYXN0ZXIgLT4gb3V0DQpAZW5kdW1sDQoKUGxhbnRVTUwgdmVyc2lvbiAxLjIwMjEuNChTdW4gQXByIDA0IDA4OjQ5OjM5IEdNVCAyMDIxKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogT3BlbkpESyBSdW50aW1lIEVudmlyb25tZW50CkpWTTogT3BlbkpESyA2NC1CaXQgU2VydmVyIFZNCkRlZmF1bHQgRW5jb2Rpbmc6IFVURi04Ckxhbmd1YWdlOiBlbgpDb3VudHJ5OiBVUwotLT48L2c+PC9zdmc+"><h4>What’s Jenkins-X serverless solution?</h4><p>The <a target="_blank" rel="noopener" href="https://www.cloudbees.com/blog/serverless-jenkins-jenkins-x">jenkins-X</a> is based on kubernetes, and use the Sidecar pattern too. However</p><ul><li>I just want a jenkinsfile interceptor, but got the full kubernete/helm instances(buy, install, and maintain the kubernetes clusters, and configure the F**K yaml)</li><li>Single-vendor lock in, using CD only with kubernates/GitHub.</li><li>It’s hard to customize own steps, and bind with a fixed git methodology/YAML.</li><li>JVM memory saves, but k8s creates <a target="_blank" rel="noopener" href="https://codefresh.io/continuous-deployment/codefresh-versus-jenkins-x/">new problems</a>.</li></ul><p>See more at <a target="_blank" rel="noopener" href="https://codefresh.io/continuous-deployment/codefresh-versus-jenkins-x/">https://codefresh.io/continuous-deployment/codefresh-versus-jenkins-x/</a></p><h2>My Sidecar based Solution</h2><p>Here is my solution, every masters are independence, what you need is get eventually consistency with low latency.</p><h4>Summary</h4><p>Using all opensource components.</p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iNDY2cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo1NDRweDtoZWlnaHQ6NDY2cHg7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1NDQgNDY2IiB3aWR0aD0iNTQ0cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tTUQ1PVthMjE4MzlhNjcwZDAwNDU4Zjc4N2M0NmIzNTk3YWRmZF0KY2x1c3RlciBydW5jLS0+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIxMTQiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjUzMCIgeD0iOCIgeT0iNyIvPjxwYXRoIGQ9Ik0xODQsNyBMMTg0LDE2Ljc5OTkgTDE3NCwyNi43OTk5IEw4LDI2Ljc5OTkgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY2IiB4PSIxMSIgeT0iMjEuOTk5OSI+TXVsdGktY2xvdWRzIEFnZW50IFBvb2w8L3RleHQ+PCEtLU1ENT1bYmQ2M2I4NjFhZDRkNGM2ZWQxZjU4NmE1Y2E5ZWFkOTRdCmNsdXN0ZXIgbWFzdGVycy0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTA0IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIyNTIiIHg9IjE2NCIgeT0iMTg2Ii8+PHBhdGggZD0iTTIyOCwxODYgTDIyOCwxOTUuNzk5OSBMMjE4LDIwNS43OTk5IEwxNjQsMjA1Ljc5OTkgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQiIHg9IjE2NyIgeT0iMjAwLjk5OTkiPk1hc3RlcnM8L3RleHQ+PCEtLU1ENT1bZjdhZmNiMTg4NTY1YjUxMmIwMzY3NjM4NDljODdlOGRdCmNsdXN0ZXIgY3RybC0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iOTciIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjIwMSIgeD0iNyIgeT0iMzYzIi8+PHBhdGggZD0iTTg1LDM2MyBMODUsMzcyLjc5OTkgTDc1LDM4Mi43OTk5IEw3LDM4Mi43OTk5ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY4IiB4PSIxMCIgeT0iMzc3Ljk5OTkiPkNvbnRyb2xsZXI8L3RleHQ+PCEtLU1ENT1bODMzNDAyZTkwODc2NDQyMTdjOTlmNTExOGUwZDA5NTZdCmVudGl0eSBhZ2VudDEtLT48cG9seWdvbiBmaWxsPSIjRkVGRUNFIiBwb2ludHM9IjUxLDYwLDYxLDUwLDEzNSw1MCwxMzUsODYuNzk5OSwxMjUsOTYuNzk5OSw1MSw5Ni43OTk5LDUxLDYwIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxMjUiIHgyPSIxMzUiIHkxPSI2MCIgeTI9IjUwIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTEiIHgyPSIxMjUiIHkxPSI2MCIgeTI9IjYwIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTI1IiB4Mj0iMTI1IiB5MT0iNjAiIHkyPSI5Ni43OTk5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDQiIHg9IjY2IiB5PSI4My45OTk5Ij5Ob21hZDwvdGV4dD48IS0tTUQ1PVs4OWZiYzQ3MTQ4ZTE4ZDg2ZTUzN2VjMzJiZTlmYmE2ZV0KZW50aXR5IGFnZW50NC0tPjxwb2x5Z29uIGZpbGw9IiNGRUZFQ0UiIHBvaW50cz0iNDMwLjUsNjAsNDQwLjUsNTAsNTEzLjUsNTAsNTEzLjUsODYuNzk5OSw1MDMuNSw5Ni43OTk5LDQzMC41LDk2Ljc5OTksNDMwLjUsNjAiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjUwMy41IiB4Mj0iNTEzLjUiIHkxPSI2MCIgeTI9IjUwIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNDMwLjUiIHgyPSI1MDMuNSIgeTE9IjYwIiB5Mj0iNjAiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1MDMuNSIgeDI9IjUwMy41IiB5MT0iNjAiIHkyPSI5Ni43OTk5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMiIHg9IjQ0NS41IiB5PSI4My45OTk5Ij5Eb2NrZXI8L3RleHQ+PCEtLU1ENT1bZmY4OTY5OTFlMTFjMWNhZWI3MDA0ZjE3MTlhYmI0MTZdCmVudGl0eSBhZ2VudDItLT48cG9seWdvbiBmaWxsPSIjRkVGRUNFIiBwb2ludHM9IjE3MCw2MCwxODAsNTAsMjgwLDUwLDI4MCw4Ni43OTk5LDI3MCw5Ni43OTk5LDE3MCw5Ni43OTk5LDE3MCw2MCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjcwIiB4Mj0iMjgwIiB5MT0iNjAiIHkyPSI1MCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjE3MCIgeDI9IjI3MCIgeTE9IjYwIiB5Mj0iNjAiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIyNzAiIHgyPSIyNzAiIHkxPSI2MCIgeTI9Ijk2Ljc5OTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MCIgeD0iMTg1IiB5PSI4My45OTk5Ij5LdWJlcm5ldGVzPC90ZXh0PjwhLS1NRDU9W2M4MGRiM2UxY2YyNDI4NjY0NDM4ZWY1OWZkNWNiYjYyXQplbnRpdHkgYWdlbnQzLS0+PHBvbHlnb24gZmlsbD0iI0ZFRkVDRSIgcG9pbnRzPSIzMTUsNjAsMzI1LDUwLDM5NSw1MCwzOTUsODYuNzk5OSwzODUsOTYuNzk5OSwzMTUsOTYuNzk5OSwzMTUsNjAiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjM4NSIgeDI9IjM5NSIgeTE9IjYwIiB5Mj0iNTAiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIzMTUiIHgyPSIzODUiIHkxPSI2MCIgeTI9IjYwIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMzg1IiB4Mj0iMzg1IiB5MT0iNjAiIHkyPSI5Ni43OTk5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAiIHg9IjMzMCIgeT0iODMuOTk5OSI+TWVzb3M8L3RleHQ+PCEtLU1ENT1bZTYwMDFhZjE2ZDQ3NzRlMGZkYWQyNzE1NTcwMTE5ZDldCmVudGl0eSBtYXN0ZXItLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjM2Ljc5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9Ijc1IiB4PSIyMDcuNSIgeT0iMjI5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUiIHg9IjIxNy41IiB5PSIyNTIuOTk5OSI+SmVua2luczE8L3RleHQ+PCEtLU1ENT1bYjdjZmQ0MDBkMGQ2NTRlNjgyNDk4MGM5NzVjMjZhZmVdCmVudGl0eSBtYXN0ZXIyLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIzNi43OTk5IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI3NSIgeD0iMzE3LjUiIHk9IjIyOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1IiB4PSIzMjcuNSIgeT0iMjUyLjk5OTkiPkplbmtpbnMyPC90ZXh0PjwhLS1NRDU9WzhmYTNmMTIyMWJhYTc2NzIwZTAwMTlhYTk1ZWRjODA3XQplbnRpdHkgZGwtLT48cGF0aCBkPSJNMjIuNSw0MDggQzIyLjUsMzk4IDYyLDM5OCA2MiwzOTggQzYyLDM5OCAxMDEuNSwzOTggMTAxLjUsNDA4IEwxMDEuNSw0MzMuNzk5OSBDMTAxLjUsNDQzLjc5OTkgNjIsNDQzLjc5OTkgNjIsNDQzLjc5OTkgQzYyLDQ0My43OTk5IDIyLjUsNDQzLjc5OTkgMjIuNSw0MzMuNzk5OSBMMjIuNSw0MDggIiBmaWxsPSIjRkVGRUNFIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cGF0aCBkPSJNMjIuNSw0MDggQzIyLjUsNDE4IDYyLDQxOCA2Miw0MTggQzYyLDQxOCAxMDEuNSw0MTggMTAxLjUsNDA4ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTkiIHg9IjMyLjUiIHk9IjQzNS45OTk5Ij5EYXRhIGxha2U8L3RleHQ+PCEtLU1ENT1bYzI1MWI2MjgxODIzOGI2Zjc5MjY5YWRjNWJmN2QxZTJdCmVudGl0eSBjbGktLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjM2Ljc5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjU1IiB4PSIxMzYuNSIgeT0iNDAyLjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNSIgeD0iMTQ2LjUiIHk9IjQyNi40OTk5Ij5DbGllbnQ8L3RleHQ+PCEtLU1ENT1bYjFjY2MzMzI4ZWZjNWE2MDY5Y2I4NDYxYzRhNGM2MmNdCmVudGl0eSBjb25zdWwtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjM2Ljc5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjYwIiB4PSIyOTYiIHk9IjQwMi41Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAiIHg9IjMwNiIgeT0iNDI2LjQ5OTkiPmNvbnN1bDwvdGV4dD48IS0tTUQ1PVtkNTBkYzQyM2ZlMGI1NTc2ZmQ3NjRlNDA4YjhlNjU1Zl0KbGluayBydW5jIHRvIGRsLS0+PHBhdGggZD0iTTIyLjI4MDUsMTIxLjY4NDMgQzIyLjM4NTYsMTIyLjQ3MzQgMjIuNDkxNiwxMjMuMjcgMjIuNTk4NiwxMjQuMDc0IEMyMy4wMjY3LDEyNy4yOTAyIDIzLjQ3MDYsMTMwLjYyNSAyMy45Mjg4LDEzNC4wNjY5IEMyNC44NDUyLDE0MC45NTA3IDI1LjgxODUsMTQ4LjI2MjcgMjYuODM2NSwxNTUuOTEgQzI4Ljg3MjYsMTcxLjIwNDUgMzEuMDg3MiwxODcuODM5NyAzMy4zODEyLDIwNS4wNzEzIEM0Mi41NTc1LDI3My45OTc1IDUzLjAwNSwzNTIuNDY1IDU4LjM4LDM5Mi44MyAiIGZpbGw9Im5vbmUiIGlkPSJydW5jLXRvLWRsIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjEuMCwzLjA7Ii8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSI1OS4wNiwzOTcuOTMsNjEuODQyNiwzODguNDgyNCw1OC40MDI5LDM5Mi45NzM0LDUzLjkxMiwzODkuNTMzNyw1OS4wNiwzOTcuOTMiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4IiB4PSI0NyIgeT0iMjUzIj5maWxlYmVhdHM8L3RleHQ+PCEtLU1ENT1bODMwNzVlNTZmNDRiNmFlY2JmZDg0ZmQ4NjljODFjNjhdCmxpbmsgbWFzdGVycyB0byBjb25zdWwtLT48cGF0aCBkPSJNMTgwLjE3NzYsMjkwLjA4OTkgQzE4MC4yMjE0LDI5MC4xODM0IDE4MC4yNjUzLDI5MC4yNzY5IDE4MC4zMDk1LDI5MC4zNzAyIEMxODMuMTM4OCwyOTYuMzQxMiAxODYuOTI3NSwzMDEuODUyNSAxOTIsMzA2IEMyMTIuNDksMzIyLjc1IDIyOC4zNywzMDAuMjggMjUxLDMxNCBDMjgzLjE3LDMzMy41IDMwNS4yNywzNzIuNjIgMzE2Ljc2LDM5Ny40OSAiIGZpbGw9Im5vbmUiIGlkPSJtYXN0ZXJzLXRvLWNvbnN1bCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToxLjAsMy4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMzE4LjkxLDQwMi4yNywzMTguODUyOSwzOTIuNDIxMywzMTYuODUyOCwzOTcuNzEyOCwzMTEuNTYxMywzOTUuNzEyOCwzMTguOTEsNDAyLjI3IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NSIgeD0iMjg1IiB5PSIzMzYiPkhlYWx0aCBjaGVjazwvdGV4dD48IS0tTUQ1PVthNmQ4MzEyMTE1NmU0Njk1ZDU2MGU5NWUxMmIxNmIyN10KcmV2ZXJzZSBsaW5rIGRsIHRvIG1hc3RlcnMtLT48cGF0aCBkPSJNNjQuMTMsMzkyLjM5IEM2Ni45NiwzNjkuNzcgNzMuNTgsMzM3Ljc0IDg5LDMxNCBDMTAxLjQsMjk0LjkxIDEyMS4yNiwyNzguOTQ1IDEzOC40NDM4LDI2Ny41NTc1IEMxNDcuMDM1NiwyNjEuODYzOCAxNTQuOTU4NCwyNTcuMzE0NCAxNjAuOTQ1MiwyNTQuMDkwOSBDMTYxLjY5MzUsMjUzLjY4OCAxNjIuNDExNiwyNTMuMzA1OCAxNjMuMDk2OSwyNTIuOTQ0NyBDMTYzLjI2ODMsMjUyLjg1NDQgMTYzLjQzNzYsMjUyLjc2NTQgMTYzLjYwNDgsMjUyLjY3NzggQzE2My42ODg0LDI1Mi42MzM5IDE2My43NzE1LDI1Mi41OTA0IDE2My44NTQsMjUyLjU0NzMgIiBmaWxsPSJub25lIiBpZD0iZGwtYmFja3RvLW1hc3RlcnMiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iNjMuNTEsMzk3LjYzLDY4LjUxNDMsMzg5LjE0NzMsNjQuMDgyNiwzOTIuNjYyOSw2MC41NjcsMzg4LjIzMTEsNjMuNTEsMzk3LjYzIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OCIgeD0iOTAiIHk9IjMzNiI+UnVuTGlzdGVuZXI8L3RleHQ+PCEtLU1ENT1bYzcyODNlNTM2NTUxOGE0MTYyYTZhZDM4MDhmMWEyNGJdCnJldmVyc2UgbGluayBtYXN0ZXJzIHRvIGNsaS0tPjxwYXRoIGQ9Ik0xNzAuMDM3OCwyOTAuNTY5MSBDMTY5Ljk5NDksMjkxLjQ5MDMgMTY5Ljk1MTUsMjkyLjQyMDggMTY5LjkwNzgsMjkzLjM1OTggQzE2OS44MjAzLDI5NS4yMzc3IDE2OS43MzEyLDI5Ny4xNDk4IDE2OS42NDA4LDI5OS4wOTEgQzE2OS40NTk5LDMwMi45NzM0IDE2OS4yNzM2LDMwNi45NzIgMTY5LjA4MzgsMzExLjA0NjMgQzE2Ny41NjUsMzQzLjY0IDE2NS44MiwzODEuMDcgMTY0LjgyLDQwMi40OSAiIGZpbGw9Im5vbmUiIGlkPSJtYXN0ZXJzLWJhY2t0by1jbGkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTcwLjAzNzgsMjkwLjU2OTEsMTY1LjYyMzMsMjk5LjM3MzIsMTY5LjgwNTEsMjk1LjU2MzcsMTczLjYxNDcsMjk5Ljc0NTUsMTcwLjAzNzgsMjkwLjU2OTEiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcwIiB4PSIxNjkiIHk9IjMyOCI+Sm9iLnhtbCB3aXRoPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYxIiB4PSIxNzUiIHk9IjM0My42Ij5KZW5raW5zZmlsZTwvdGV4dD48IS0tTUQ1PVs4NWNjNDk0MDdiOGU3MTk5N2UzZGY2YzM5NmJjZjRjZF0KbGluayBjb25zdWwgdG8gY2xpLS0+PHBhdGggZD0iTTI5NS43Nyw0MjEgQzI2Ny43MSw0MjEgMjI2LjA0LDQyMSAxOTcuMSw0MjEgIiBmaWxsPSJub25lIiBpZD0iY29uc3VsLXRvLWNsaSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToxLjAsMy4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTkxLjg1LDQyMSwyMDAuODUsNDI1LDE5Ni44NSw0MjEsMjAwLjg1LDQxNywxOTEuODUsNDIxIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OCIgeD0iMjA5Ljc1IiB5PSI0MTUiPmhlbHAgY2hvb3NlPC90ZXh0PjwhLS1NRDU9W2NlZjAwMjUwNzE5MDllNjA2MWM1ODg5M2MzNTkyMDA0XQpsaW5rIGFnZW50MSB0byBtYXN0ZXItLT48cGF0aCBkPSJNMTEyLjQsOTcuMTUgQzEyMy42MiwxMDkuNjEgMTM4LjM4LDEyNC45NCAxNTMsMTM3IEMxNzMuODIsMTU0LjE5IDE4NS43MSwxNTAuMTQgMjA0LDE3MCBDMjIwLjAzLDE4Ny40IDIzMS44MiwyMTIuMjMgMjM4LjU0LDIyOC44MyAiIGZpbGw9Im5vbmUiIGlkPSJhZ2VudDEtbWFzdGVyIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjEuMCwzLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYiIHg9IjE5NSIgeT0iMTU5Ij5UQ1A8L3RleHQ+PCEtLU1ENT1bYjMzNGQ2MzBmNTE4MDUwZjM0N2QzMjcyZTJlMThjN2RdCmxpbmsgYWdlbnQyIHRvIG1hc3Rlci0tPjxwYXRoIGQ9Ik0yMjcuNjYsOTcuMzQgQzIzMS42OSwxMzIuMDcgMjM5LjI5LDE5Ny40MSAyNDIuOTQsMjI4Ljc5ICIgZmlsbD0ibm9uZSIgaWQ9ImFnZW50Mi1tYXN0ZXIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6MS4wLDMuMDsiLz48IS0tTUQ1PVtmNTVmODc1NDM1YmE3NjdlYWFmMmMxNDU3NThlYjExY10KbGluayBhZ2VudDMgdG8gbWFzdGVyMi0tPjxwYXRoIGQ9Ik0zNTUsOTcuMzQgQzM1NSwxMzIuMDcgMzU1LDE5Ny40MSAzNTUsMjI4Ljc5ICIgZmlsbD0ibm9uZSIgaWQ9ImFnZW50My1tYXN0ZXIyIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjEuMCwzLjA7Ii8+PCEtLU1ENT1bYjA0Njk3NGE1MTdlYWIyMDI5N2Q0OGQzMTAzMDZlMjldCmxpbmsgYWdlbnQ0IHRvIG1hc3RlcjItLT48cGF0aCBkPSJNNDU2LjQ2LDk3LjM0IEM0MzIuODQsMTMyLjA3IDM4OC4zOSwxOTcuNDEgMzY3LjA0LDIyOC43OSAiIGZpbGw9Im5vbmUiIGlkPSJhZ2VudDQtbWFzdGVyMiIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToxLjAsMy4wOyIvPjwhLS1NRDU9Wzg2ZjI4YTUyYTYxZDE1YTQ4OWM1Yzc0OGZlYjM2ZjY1XQpAc3RhcnR1bWwNCnNraW5wYXJhbSBzaGFkb3dpbmcgZmFsc2UNCg0KYWdlbnQgY29uc3VsIGFzICJjb25zdWwiDQpmcmFtZSBydW5jIGFzICJNdWx0aS1jbG91ZHMgQWdlbnQgUG9vbCIgew0KICBub2RlIGFnZW50MSBhcyAiTm9tYWQiDQogIG5vZGUgYWdlbnQ0IGFzICJEb2NrZXIiDQogIG5vZGUgYWdlbnQyIGFzICJLdWJlcm5ldGVzIg0KICBub2RlIGFnZW50MyBhcyAiTWVzb3MiDQp9DQpmcmFtZSBtYXN0ZXJzIGFzICJNYXN0ZXJzIiB7DQogICAgYWdlbnQgbWFzdGVyIGFzICJKZW5raW5zMSINCiAgICBhZ2VudCBtYXN0ZXIyIGFzICJKZW5raW5zMiINCn0NCmZyYW1lIGN0cmwgYXMgIkNvbnRyb2xsZXIiIHsNCiAgICBkYXRhYmFzZSBkbCBhcyAiRGF0YSBsYWtlIg0KICAgIGFnZW50IGNsaSBhcyAiQ2xpZW50Ig0KfQ0KcnVuYyB+fj4gZGw6IGZpbGViZWF0cw0KbWFzdGVycyB+fj4gY29uc3VsOiBIZWFsdGggY2hlY2sNCmRsIDwtIG1hc3RlcnM6IFJ1bkxpc3RlbmVyDQptYXN0ZXJzIDwtIC0gY2xpOiBKb2IueG1sIHdpdGggXG5KZW5raW5zZmlsZQ0KY29uc3VsIH5+PiBjbGk6IGhlbHAgY2hvb3NlDQphZ2VudDEgfn4gbWFzdGVyOiBUQ1ANCmFnZW50MiB+fiBtYXN0ZXINCmFnZW50MyB+fiBtYXN0ZXIyDQphZ2VudDQgfn4gbWFzdGVyMg0KDQpAZW5kdW1sDQoKUGxhbnRVTUwgdmVyc2lvbiAxLjIwMjEuNChTdW4gQXByIDA0IDA4OjQ5OjM5IEdNVCAyMDIxKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogT3BlbkpESyBSdW50aW1lIEVudmlyb25tZW50CkpWTTogT3BlbkpESyA2NC1CaXQgU2VydmVyIFZNCkRlZmF1bHQgRW5jb2Rpbmc6IFVURi04Ckxhbmd1YWdlOiBlbgpDb3VudHJ5OiBVUwotLT48L2c+PC9zdmc+"><center>multiple-clouds Jenkins</center><p>This solution is not a smart solution, but saves your time</p><ul><li>No strongh bind with any cloud platform(Kubernetes/Nomad/Mesos).</li><li>Most works will be transformed into a Spring/Database based project -&gt; They are cost-effective, easy to be designed, developed and matainted, and make employee recruitment or outsourcing easier.</li></ul><h4>Client</h4><ul><li>Create and send raw XML to jenkins instances.</li><li>Inside the XML, the payload can be Jenkinsfile, YAML, JSON, or the other DSL.</li><li>Job definitions will be saved into a database(pg/mysql/elk).</li></ul><h4>Data lake</h4><ul><li>ELK/KsqlDB: ETL, grafana and visualization.</li><li>Jenkins <code>shell</code> step need to be reimplemented with logstash for centralized logs.</li></ul><h4>Jenkins</h4><p>Modifications with jenkins.war and other plugins are not required. PAAS bind naming services(k8s/nomad) are also not required.</p><p>Just create a jenkins plugin(not open sourced here)</p><ul><li>Use <code>hudson.model.listeners.RunListener</code> to send back job results(RUNNING/SUCCESS/FAIL).</li><li>Use <a target="_blank" rel="noopener" href="https://jenkins.io/blog/2018/04/25/configuring-jenkins-pipeline-with-yaml-file/">shared library</a> to intercepting the high-level DSL</li></ul><h4>Consul</h4><ul><li>Use Nomad’s HCL or Kubernetes CRD/annotation or sidecar to register service to the Consul -&gt; No SDK installation required in the jenkins.war.</li><li>Use consul block query and metadata for client side load balancing.</li><li>Use <a target="_blank" rel="noopener" href="https://www.consul.io/docs/commands/maint.html">maintenance mode</a> when releasing or upgrating.</li></ul><h4>Why not create and destroy Jenkins container instance per job?</h4><ul><li>JVM cold starts is too slow when you have lots of jobs/plugins(30s or more).</li><li>The main costs is infra(machines/energy) when self-hosting, and Jenkins masters always have a full workload.</li></ul><h4>Summary</h4><table><thead><tr><th>Problems</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td>Pipeline defination</td><td>Master Disk</td><td>Database</td></tr><tr><td>Build result</td><td>Master Disk</td><td>Forwarding to data lake by RunListener plugin</td></tr><tr><td>Step details</td><td>Master Disk</td><td>Just forwarding, not persistence</td></tr><tr><td>Stdout Log</td><td>Master Disk</td><td>Forwarding to ELK by filebeats</td></tr><tr><td>Webhook</td><td>Master Disk</td><td>Spring Controller wrappers</td></tr><tr><td>Cron Job</td><td>Master Disk</td><td>Quartz(on Database)+WebHook</td></tr><tr><td>SCM pulling</td><td>Master Disk</td><td>Quartz or WebHook</td></tr><tr><td>Load balancer</td><td>No</td><td>Consul blocking query</td></tr><tr><td>visualization</td><td>JSP like</td><td>Powered by controllers</td></tr></tbody></table><p>I should emphasize again that this solution is not cheap at all.</p><h2>Conclusion</h2><h4>Pros and cons</h4><div style="overflow-x:scroll"><table><thead><tr><th></th><th>Single Jenkins</th><th>Paid Solutions</th><th>Sidecar based Solution</th></tr></thead><tbody><tr><td>Costs</td><td>Free, no guarantees</td><td>License fees</td><td>Customization costs and time</td></tr><tr><td>Parallels jobs</td><td>Limited</td><td>By license type</td><td>10K Jobs+, depends on your datalake</td></tr><tr><td>HA</td><td>No</td><td>Yes</td><td>Yes(Flight jobs still down)</td></tr><tr><td>Pipelines as code</td><td>Groovy</td><td>YAML/NodeJS</td><td>Same as Jenkins + DSL</td></tr><tr><td>Tenant</td><td>No</td><td>Yes</td><td>Customized by controller(Spring)</td></tr><tr><td>Authorization</td><td>Simple</td><td>Yes</td><td>Customized by controller(RBAC/LDAP/…)</td></tr><tr><td>CD</td><td>No</td><td>Yes</td><td>DSL template</td></tr></tbody></table></div><p>So, what you will get depends on how much you pay. This post proposes a way to implement mutilple masters, but requires a lot of works and time.</p></div><div class="tags"><a class="tag-link" href="/tags/Consul/" rel="tag">Consul</a><a class="tag-link" href="/tags/DevOps/" rel="tag">DevOps</a><a class="tag-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><a class="tag-link" href="/tags/System-Design/" rel="tag">System Design</a></div></section><ul class="nav"><li>Prev:<a href="/2019-summary/">2019 Summary</a></li><li>Next:<a href="/resilient-jenkins-agents-provisioning-with-hashicorp-s-nomad/">Resilient Jenkins Agents Provisioning with HashiCorp's Nomad</a></li></ul><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the<a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus</a></noscript></div></div></div></div><footer><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry</a><span>.</span></div></footer><script>window.onload=function(){var a,e,n,t;a=window,e=document,t="script",n="ga",a.GoogleAnalyticsObject=n,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=+new Date,n=e.createElement(t),t=e.getElementsByTagName(t)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",t.parentNode.insertBefore(n,t),ga("create","UA-102296742-1","auto"),ga("send","pageview")}</script></body></html>