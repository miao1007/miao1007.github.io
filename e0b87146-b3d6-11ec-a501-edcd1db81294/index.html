<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="本文介绍常见基于劫持等抓包方案"><meta name="keyword" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Android-HTTP的几种抓包方法</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-102296742-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-102296742-1")</script><meta name="generator" content="Hexo 5.4.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">Android-HTTP的几种抓包方法</div><div class="date">2015-02-20 / modified at 2022-08-29</div><div class="content"><p>本文介绍常见基于劫持等抓包方案</p><span id="more"></span><p>如果你想干如下的事情</p><ul><li>学习到成熟的API设计</li><li>学习WebView中优雅的CSS，比如夜间模式，屏幕适配</li><li>看看BAT系列软件在后台流氓了什么</li><li><s>看看蹭网的人都在干什么</s></li></ul><p>那么这篇文章就适合你哦，本文目录如下</p><ul><li>抓包环境</li><li>基于mitmproxy的调试</li><li>基于Chrome的调试(WebView Only)</li><li>基于OpenWRT的调试</li></ul><h2>抓包环境</h2><p>本文对Unix操作基础有一定的要求，但是用熟悉了操作也不错哦</p><ul><li>手机 CM Kitkat</li><li>电脑 OSX Yosemite</li><li>它们都在一个路由内网环境下</li></ul><h1>基于mitmproxy的调试</h1><p>mitmproxy是一款运行在电脑上的proxy软件，它只抓HTTP(S)协议的包，用起来比tcpdump好用多了。</p><h4>配置mitmproxy</h4><p>以MacOS为例，安装mitmproxy</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brew install python</span><br><span class="line">pip install mitmproxy</span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">mitmweb --listen-port 8864  --web-host 0.0.0.0</span><br></pre></td></tr></table></figure><p>其中代理服务器需要填写8864，网页版为8081</p><p>大部分程序，甚至是微博/百度这种级别的程序</p><ul><li>均无条件信任系统的根证书，而不是用自己的信任链</li><li>没有进行私有加密（提高逆向难度）或者二次签名（防篡改/重放），基本上全部为明文json</li></ul><p>做的比较好的是H司的各种应用，看来被攻击的比较惨。微众银行做的有点丢人，工商银行做的非常完备。</p><p>#基于Chrome的调试(WebView Only)<br>此方法挑手机，挑chrome，挑操作系统，而且与代码是否开启调试有关，成功率不是很高。</p><p>手机(Kitkat以上)连接电脑(需要fq环境)，打开chrome</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome://inspect/#devices</span><br></pre></td></tr></table></figure><p>手机打开任意一个APP，比如简书，就可以调试<s>偷点CSS</s>了，我们可以发现简书的WebView里面既有JQuery又有大片的CSS，怪不得打开慢，流量坑。</p><p><img src="http://upload-images.jianshu.io/upload_images/98641-e83299de1cfbc15a.png" alt="jianshu"></p><h1>基于OpenWRT的调试</h1><p>基于OpenWRT路由器的调试需要有一定的Linux的基础，这个电脑手机电视什么的都可以抓，甚至可以开一个钓鱼热点抓包分析，这个相比于第一个抓包，难度更大，但是抓的东西更多，不限于HTTP协议。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install tcpdump</span><br></pre></td></tr></table></figure><p>tcpdump比较复杂，一般保持为pcap的格式，可以用Wireshark打开，我们就一笔带过吧，有兴趣去专门的路由器论坛讨论。</p></div><div class="tags"></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry</a><span>.</span></div></footer></div></body></html>