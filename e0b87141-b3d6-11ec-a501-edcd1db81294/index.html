<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="随着开源软件的兴起，传统的芯片领域也不断地被侵蚀，本文简要介绍利用开源工具实现数字电路到BES综合的流程。"><meta name="keyword" content="RISC-V"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>自己编译开源RISC-V CPU</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://eu.umami.is/script.js" data-website-id="449a84b6-be9e-49de-a4cc-e0fa6fea1df9"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">自己编译开源RISC-V CPU</div><div class="date no-print">2021-05-19 / modified at 2023-02-20 / 779 words / 3 mins</div><div class="content"><blockquote><span>️This article has been <strong>over 2 years</strong> since the last update.</span></blockquote><p>随着开源软件的兴起，传统的芯片领域也不断地被侵蚀，本文简要介绍利用开源工具实现数字电路到BES综合的流程。</p><span id="more"></span><h2>背景</h2><p>芯片开发与软件中的CURD写Controller类似，并没有&quot;全栈&quot;的任务，相反每个人反而更加原子化。未来随着开源化，芯片设计同样将廉价化，造芯片将和造车一样遍地都是。</p><p>本文介绍的流程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Chisel --(sbt)--&gt; RTL --(syn)--&gt; Netlist --(后端)---&gt; 后端暂时不介绍</span><br></pre></td></tr></table></figure><p>详细流程</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="310px" preserveAspectRatio="none" style="width:710px;height:310px;background:#fff" version="1.1" viewBox="0 0 710 310" width="710px" zoomAndPan="magnify" class="kroki">$2<defs/><g><g class="cluster" data-entity="syn" data-source-line="5" data-uid="ent0003" id="cluster_syn"><rect fill="none" height="123" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1" width="208.37" x="369.85" y="78"/><path d="M407.2758,78 L407.2758,87.2969 L397.2758,97.2969 L369.85,97.2969" fill="none" style="stroke:#696969;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="27.4258" x="372.85" y="91.9951">syn</text></g><g class="cluster" data-entity="chisel" data-source-line="8" data-uid="ent0005" id="cluster_chisel"><rect fill="none" height="194" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1" width="137.11" x="64" y="7"/><path d="M119.6914,7 L119.6914,16.2969 L109.6914,26.2969 L64,26.2969" fill="none" style="stroke:#696969;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="45.6914" x="67" y="20.9951">chisel</text></g><g class="entity" data-entity="library" data-source-line="6" data-uid="ent0004" id="entity_library"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="160.376" x="393.85" y="120.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.376" x="403.85" y="143.8451">standard cell library</text></g><g class="entity" data-entity="build" data-source-line="9" data-uid="ent0006" id="entity_build"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="80.5459" x="92.28" y="120.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.5459" x="102.28" y="143.8451">build.sbt</text></g><g class="entity" data-entity="scala" data-source-line="10" data-uid="ent0007" id="entity_scala"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="89.1045" x="88" y="49.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.1045" x="98" y="72.8451">scala files</text></g><g class="entity" data-entity="user" data-source-line="4" data-uid="ent0002" id="entity_user"><ellipse cx="132.5547" cy="237.35" fill="#454645" rx="8" ry="8" style="stroke:#454645;stroke-width:.5"/><path d="M132.5547,245.35 L132.5547,272.35 M119.5547,253.35 L145.5547,253.35 M132.5547,272.35 L119.5547,287.35 M132.5547,272.35 L145.5547,287.35" fill="none" style="stroke:#454645;stroke-width:.5"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.1094" x="97.5" y="301.8451">developer</text></g><g class="entity" data-entity="top" data-source-line="12" data-uid="ent0008" id="entity_top"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="58.7393" x="256.11" y="174.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.7393" x="266.11" y="197.8451">Top.v</text></g><g class="entity" data-entity="netlist" data-source-line="15" data-uid="ent0011" id="entity_netlist"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="71.5498" x="633.22" y="174.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.5498" x="643.22" y="197.8451">synth.v</text></g><g class="link" data-entity-1="user" data-entity-2="scala" data-source-line="13" data-uid="lnk9" id="link_user_scala"><path d="M97.17,249.89 C61.64,229.95 13.56,194.01 24.26,149.5 C29.69,126.94 30.95,118.74 48,103 C59.21,92.65 68.2958,87.2931 82.2858,81.9431" fill="none" id="user-to-scala" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="87.89,79.8,78.055,79.2786,83.2198,81.5859,80.9125,86.7508,87.89,79.8" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32.6841" x="7" y="162.5669">write</text></g><g class="link" data-entity-1="chisel" data-entity-2="top" data-source-line="14" data-uid="lnk10" id="link_chisel_top"><path d="M201.7036,193 C202.5321,193 203.3618,193 204.1922,193 C205.8532,193 207.5172,193 209.1811,193 C212.509,193 215.8364,193 219.1375,193 C232.3419,193 239.125,193 249.83,193" fill="none" id="chisel-to-top" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="255.83,193,246.83,189,250.83,193,246.83,197,255.83,193" style="stroke:#454645;stroke-width:1"/></g><g class="link" data-entity-1="top" data-entity-2="syn" data-source-line="16" data-uid="lnk12" id="link_top_syn"><path d="M315.22,193 C328.0975,193 344.1944,193 361.1462,193 C363.2652,193 365.3976,193 367.5387,193 C368.0739,193 362.6098,193 363.146,193" fill="none" id="top-to-syn" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="369.146,193,360.146,189,364.146,193,360.146,197,369.146,193" style="stroke:#454645;stroke-width:1"/></g><g class="link" data-entity-1="syn" data-entity-2="netlist" data-source-line="17" data-uid="lnk13" id="link_syn_netlist"><path d="M578.8932,193 C579.1613,193 579.4294,193 579.6973,193 C581.841,193 583.9792,193 586.1077,193 C603.1356,193 613.5425,193 627.14,193" fill="none" id="syn-to-netlist" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="633.14,193,624.14,189,628.14,193,624.14,197,633.14,193" style="stroke:#454645;stroke-width:1"/></g></g></svg><h2>前端数字设计</h2><h4>准备工作</h4><p>我们以这个标准的scala项目为例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/jlpteaching/dinocpu.git</span><br></pre></td></tr></table></figure><p>然后安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install sbt scala</span><br></pre></td></tr></table></figure><p>若需要配置SBT镜像库，详见<a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/">mirrors</a></p><h4>编译构建</h4><p>如下将下载Chisel等依赖，并在根目录生成Top.v</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sbt <span class="string">&quot;runMain dinocpu.elaborate single-cycle&quot;</span></span><br><span class="line"><span class="comment"># or </span></span><br><span class="line">sbt <span class="string">&quot;runMain dinocpu.elaborate pipelined&quot;</span></span><br></pre></td></tr></table></figure><p>Chisel的定位类似预综合，可以降低Verilog的编写门槛。</p><h2>综合(synthesis)</h2><p>参考 <a target="_blank" rel="noopener" href="http://www.clifford.at/yosys/files/yosys_presentation.pdf">http://www.clifford.at/yosys/files/yosys_presentation.pdf</a></p><p>简单介绍：RTL代码 + Cell库 -&gt; 网表</p><svg xmlns="http://www.w3.org/2000/svg" style="font-size:initial" class="pikchr" width="348" height="156" viewBox="0 0 465.166 209.574" class="kroki">$2<path d="M3.03552,110.16L75.0355,110.16L75.0355,23.76L53.4355,2.16L3.03552,2.16Z" style="fill:none;stroke-width:2.16;stroke:#000"/><path d="M53.4355,2.16L53.4355,23.76L75.0355,23.76" style="fill:none;stroke-width:2.16;stroke:#000"/><text x="39.0355" y="56.16" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">verilogs</text><polygon points="183.036,56.16 171.516,60.48 171.516,51.84" style="fill:#000"/><path d="M75.0355,56.16L177.276,56.16" style="fill:none;stroke-width:2.16;stroke:#000"/><text x="129.036" y="41.7888" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">read</text><text x="129.036" y="70.5312" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">design</text><path d="M198.036,88.038L266.75,88.038A15 15 0 0 0 281.75 73.038L281.75,39.282A15 15 0 0 0 266.75 24.282L198.036,24.282A15 15 0 0 0 183.036 39.282L183.036,73.038A15 15 0 0 0 198.036 88.038Z" style="fill:none;stroke-width:2.16;stroke:#000"/><text x="232.393" y="43.4088" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">synthesis</text><text x="232.393" y="68.9112" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">(yosys)</text><polygon points="389.75,56.16 378.23,60.48 378.23,51.84" style="fill:#000"/><path d="M281.75,56.16L383.99,56.16" style="fill:none;stroke-width:2.16;stroke:#000"/><text x="335.75" y="41.7888" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">link</text><text x="335.75" y="70.5312" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">opt</text><path d="M389.75,110.16L461.75,110.16L461.75,23.76L440.15,2.16L389.75,2.16Z" style="fill:none;stroke-width:2.16;stroke:#000"/><path d="M440.15,2.16L440.15,23.76L461.75,23.76" style="fill:none;stroke-width:2.16;stroke:#000"/><text x="425.75" y="56.16" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">netlist.v</text><polygon points="232.393,88.038 236.713,99.558 228.073,99.558" style="fill:#000"/><path d="M232.393,93.798L232.393,122.598" style="fill:none;stroke-width:2.16;stroke:#000"/><path d="M183.606,133.398L183.606,196.614A48.7872 10.8 0 0 0 281.18 196.614L281.18,133.398A48.7872 10.8 0 0 0 183.606 133.398A48.7872 10.8 0 0 0 281.18 133.398" style="fill:none;stroke-width:2.16;stroke:#000"/><text x="232.393" y="160.355" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">Standard</text><text x="232.393" y="185.857" text-anchor="middle" fill="rgb(0,0,0)" font-size="110%" dominant-baseline="central">Cell</text></svg><h4>安装yosys</h4><p>直接brew安装即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install yosys</span><br></pre></td></tr></table></figure><h4>什么是 standard cell库</h4><p>电路的各种物理约束，大部分是闭源格式，你应该找EDA厂商/Fab厂商去要</p><blockquote><p>这些Cell与具体的工艺、厂商、IP绑定。比如台积电会优先与Synopsys共同开发新的5nm的lib库，而你没有这种库的话，从综合这一步开始就要被“卡脖子”了。</p></blockquote><p>开源的格式类似于yaml，详见https://www.physicaldesigninsight.com/post/liberty-file-format</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载lib库(standard cell library)</span></span><br><span class="line">wget https://raw.githubusercontent.com/YosysHQ/yosys/master/manual/PRESENTATION_Intro/mycells.lib</span><br></pre></td></tr></table></figure><h4>综合命令</h4><p>如下是综合脚本，与官网一致</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># read design </span></span><br><span class="line">read_verilog Top.v</span><br><span class="line"></span><br><span class="line"><span class="comment"># elaborate design hierarchy</span></span><br><span class="line">hierarchy -check -top Top</span><br><span class="line"></span><br><span class="line"><span class="comment"># the high-level stuff</span></span><br><span class="line">proc; opt; fsm; opt; memory; opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># mapping to internal cell library</span></span><br><span class="line">techmap; opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># mapping flip-flops to mycells.lib</span></span><br><span class="line">dfflibmap -liberty mycells.lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># mapping logic to mycells.lib</span></span><br><span class="line"><span class="comment"># 需要数个小时，真正的BES开发要同时跑多个design，不能干等</span></span><br><span class="line">abc -liberty mycells.lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># cleanup</span></span><br><span class="line">clean</span><br><span class="line"></span><br><span class="line"><span class="comment"># write synthesized design</span></span><br><span class="line">write_verilog synth.v</span><br></pre></td></tr></table></figure><p>它会生成逻辑上的CPU modules</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="MINDMAP" height="1035px" preserveAspectRatio="none" style="width:447px;height:1035px;background:#fff" version="1.1" viewBox="0 0 447 1035" width="447px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="46.0039" x="10" y="498.5234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26.0039" x="20" y="521.5186">Top</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="146.9912" x="106.0039" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.9912" x="116.0039" y="42.9951">DCombinMemPort</text><path d="M56.0039,516.6719 L66.0039,516.6719 C81.0039,516.6719 81.0039,38.1484 96.0039,38.1484 L106.0039,38.1484" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="140.3398" x="106.0039" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120.3398" x="116.0039" y="99.292">ICombinMemPort</text><path d="M56.0039,516.6719 L66.0039,516.6719 C81.0039,516.6719 81.0039,94.4453 96.0039,94.4453 L106.0039,94.4453" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="208.4395" x="106.0039" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="188.4395" x="116.0039" y="155.5889">DualPortedCombinMemory</text><path d="M56.0039,516.6719 L66.0039,516.6719 C81.0039,516.6719 81.0039,150.7422 96.0039,150.7422 L106.0039,150.7422" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="112.4492" x="106.0039" y="582.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.4492" x="116.0039" y="605.9639">PipelinedCPU</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.5898" x="268.4531" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.5898" x="278.4531" y="211.8857">StageReg_6</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,207.0391 258.4531,207.0391 L268.4531,207.0391" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.5898" x="268.4531" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.5898" x="278.4531" y="268.1826">StageReg_5</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,263.3359 258.4531,263.3359 L268.4531,263.3359" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.5898" x="268.4531" y="301.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.5898" x="278.4531" y="324.4795">StageReg_4</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,319.6328 258.4531,319.6328 L268.4531,319.6328" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.5898" x="268.4531" y="357.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.5898" x="278.4531" y="380.7764">StageReg_3</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,375.9297 258.4531,375.9297 L268.4531,375.9297" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.5898" x="268.4531" y="414.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.5898" x="278.4531" y="437.0732">StageReg_2</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,432.2266 258.4531,432.2266 L268.4531,432.2266" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="103.5898" x="268.4531" y="470.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.5898" x="278.4531" y="493.3701">StageReg_1</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,488.5234 258.4531,488.5234 L268.4531,488.5234" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="87.6826" x="268.4531" y="526.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.6826" x="278.4531" y="549.667">StageReg</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,544.8203 258.4531,544.8203 L268.4531,544.8203" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="98.1758" x="268.4531" y="582.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.1758" x="278.4531" y="605.9639">HazardUnit</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,601.1172 258.4531,601.1172 L268.4531,601.1172" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="127.1943" x="268.4531" y="639.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.1943" x="278.4531" y="662.2607">ForwardingUnit</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,657.4141 258.4531,657.4141 L268.4531,657.4141" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="61.7197" x="268.4531" y="695.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.7197" x="278.4531" y="718.5576">Adder</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,713.7109 258.4531,713.7109 L268.4531,713.7109" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="166.5693" x="268.4531" y="751.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146.5693" x="278.4531" y="774.8545">ImmediateGenerator</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,770.0078 258.4531,770.0078 L268.4531,770.0078" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="47.624" x="268.4531" y="808.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.624" x="278.4531" y="831.1514">ALU</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,826.3047 258.4531,826.3047 L268.4531,826.3047" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="98.5381" x="268.4531" y="864.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.5381" x="278.4531" y="887.4482">ALUControl</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,882.6016 258.4531,882.6016 L268.4531,882.6016" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="102.7148" x="268.4531" y="920.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7148" x="278.4531" y="943.7451">RegisterFile</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,938.8984 258.4531,938.8984 L268.4531,938.8984" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="70.9141" x="268.4531" y="977.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.9141" x="278.4531" y="1000.042">Control</text><path d="M218.4531,601.1172 L228.4531,601.1172 C243.4531,601.1172 243.4531,995.1953 258.4531,995.1953 L268.4531,995.1953" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M56.0039,516.6719 L66.0039,516.6719 C81.0039,516.6719 81.0039,601.1172 96.0039,601.1172 L106.0039,601.1172" fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><p>最终生成的v文件(netlist)是机器反复优化的产物，虽然仍然是文本，但是编辑将很费劲了，如果强行编辑，这种叫做“<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E5%B7%A5%E7%A8%8B%E6%94%B9%E5%8F%98%E5%91%BD%E4%BB%A4">ECO</a>”，并需要FM形式化证明。</p><blockquote><p>当前遇到一个问题，我的Mac版CPU只有一个core在工作，导致真八核只跑了一个核，没找到类似makefile的j8这种参数。同时内存至少给8G，否则后续优化跑不动。</p></blockquote><p>这个文件将上百MB，可以用verdi等商用或者开源工具打开，也可以用<code>show</code>命令渲染，或者用这个<a target="_blank" rel="noopener" href="https://github.com/nturley/netlistsvg">svg项目</a>查看</p><h2>总结</h2><p>上述只是用现成的工具拼接而成的产物</p><ul><li>没有涉及验证、SIMU、EMU等前端流程</li><li>没有涉及DFT、PT、FM等BES流程</li><li>不能只跑Top，而不跑别的Design。</li></ul><p>所以本文只跑了一个入门大概流程。后续还有Place and routing等流程，最终才能交付制造。</p></div><div class="tags"><a class="tag-link" href="/tags/RISC-V/" rel="tag">RISC-V</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry.</a><span> All contents are not allowed to be redistributed or synthesised without an explicit permission.</span></div></footer></div></body></html>