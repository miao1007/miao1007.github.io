<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="在上一篇的递归中，我们从形而上的角度（数码物）去了解递归，本文从工程角度对递归进行进一步分析。"><meta name="keyword" content="Recursion"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>递归在应试场景下的使用</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://eu.umami.is/script.js" data-website-id="449a84b6-be9e-49de-a4cc-e0fa6fea1df9"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">递归在应试场景下的使用</div><div class="date no-print">2022-04-23 / modified at 2023-04-30 / 1.7k words / 6 mins</div><div class="content"><blockquote><span>️This article has been <strong>over 2 years</strong> since the last update.</span></blockquote><p>在上一篇的<a href="/a13f3492-b3d6-11ec-bc8b-a33112d068ea">递归</a>中，我们从形而上的角度（数码物）去了解递归，本文从工程角度对递归进行进一步分析。</p><span id="more"></span><p>虽然递归理论上是代码信息密度最高的实现，但是真实拧螺丝中，大部分工作反而是过程式的代码翻译工作，而涉及到递归时一般会有解释器（Curry化）、文件系统或者调度等高级工程问题，因此本文只能介绍应试场景。</p><p>应试场景的递归主要难度为代码翻译，代码在定义上很优雅的同时，执行效率上一般是暴力遍历。</p><h2>大纲</h2><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="MINDMAP" height="387px" preserveAspectRatio="none" style="width:580px;height:387px;background:#fff" version="1.1" viewBox="0 0 580 387" width="580px" zoomAndPan="magnify" class="kroki">$2<defs/><g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="47.9999" x="10" y="174.8164"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.9999" x="20" y="197.8115">&#36882;&#24402;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="47.9999" x="107.9999" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.9999" x="117.9999" y="42.9951">&#29702;&#35770;</text><path d="M57.9999,192.9648 L67.9999,192.9648 C82.9999,192.9648 82.9999,38.1484 97.9999,38.1484 L107.9999,38.1484" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="75.9998" x="107.9999" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.9998" x="117.9999" y="99.292">&#24212;&#35797;&#22330;&#26223;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="47.7197" x="233.9996" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.7197" x="243.9996" y="99.292">DFS</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="51.5342" x="331.7194" y="48.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.5342" x="341.7194" y="71.1436">Tree</text><path d="M281.7194,94.4453 L291.7194,94.4453 C306.7194,94.4453 306.7194,66.2969 321.7194,66.2969 L331.7194,66.2969" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="111.2666" x="331.7194" y="104.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91.2666" x="341.7194" y="127.4404">Backtracking</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="75.9998" x="492.986" y="104.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.9998" x="502.986" y="127.4404">&#25490;&#21015;&#32452;&#21512;</text><path d="M442.986,122.5938 L452.986,122.5938 C467.986,122.5938 467.986,122.5938 482.986,122.5938 L492.986,122.5938" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M281.7194,94.4453 L291.7194,94.4453 C306.7194,94.4453 306.7194,122.5938 321.7194,122.5938 L331.7194,122.5938" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M183.9996,94.4453 L193.9996,94.4453 C208.9996,94.4453 208.9996,94.4453 223.9996,94.4453 L233.9996,94.4453" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M57.9999,192.9648 L67.9999,192.9648 C82.9999,192.9648 82.9999,94.4453 97.9999,94.4453 L107.9999,94.4453" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="75.9998" x="107.9999" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.9998" x="117.9999" y="211.8857">&#24037;&#31243;&#20248;&#21270;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="172.8307" x="233.9996" y="160.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.8307" x="243.9996" y="183.7373">&#32531;&#23384;&#35760;&#24518;&#65288;Top-down&#65289;</text><path d="M183.9996,207.0391 L193.9996,207.0391 C208.9996,207.0391 208.9996,178.8906 223.9996,178.8906 L233.9996,178.8906" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="195.9362" x="233.9996" y="217.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175.9362" x="243.9996" y="240.0342">dp&#21160;&#24577;&#35268;&#21010;&#65288;Bottom-up&#65289;</text><path d="M183.9996,207.0391 L193.9996,207.0391 C208.9996,207.0391 208.9996,235.1875 223.9996,235.1875 L233.9996,235.1875" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M57.9999,192.9648 L67.9999,192.9648 C82.9999,192.9648 82.9999,207.0391 97.9999,207.0391 L107.9999,207.0391" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="89.9997" x="107.9999" y="301.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.9997" x="117.9999" y="324.4795">&#36816;&#34892;&#26102;&#30340;&#26632;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="85.1669" x="247.9996" y="273.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65.1669" x="257.9996" y="296.3311">stack&#27169;&#25311;</text><path d="M197.9996,319.6328 L207.9996,319.6328 C222.9996,319.6328 222.9996,291.4844 237.9996,291.4844 L247.9996,291.4844" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="71.8778" x="247.9996" y="329.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.8778" x="257.9996" y="352.6279">cps&#20248;&#21270;</text><path d="M197.9996,319.6328 L207.9996,319.6328 C222.9996,319.6328 222.9996,347.7813 237.9996,347.7813 L247.9996,347.7813" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M57.9999,192.9648 L67.9999,192.9648 C82.9999,192.9648 82.9999,319.6328 97.9999,319.6328 L107.9999,319.6328" fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><h2>理论</h2><h4>工程纬度分析</h4><p>在任何一个递归函数中，我们一定只有有限的步骤可以操作，这些是可以枚举的</p><ul><li>判断：是否为空、比大小（一般需要传递）等</li><li>操作：只有四种<ul><li>更深入到子递归；<ul><li>linear recursion</li><li>tree recursion</li></ul></li><li>停机（比如空）；</li><li>有限步骤操作（比如加减计算）；</li><li>迭代（但是很少见）；</li></ul></li><li>结果：求高度、高度差、总数等，一般会放在递归的Context参数中</li></ul><h4>关于想象</h4><p>在上一篇的文章中介绍过，递归是时间的综合，它不是发条式思考，我们不能用递归函数的物理运动轨迹（比如分析调用栈的深度，用笔模拟计算、思考何时回栈、光线追踪等）来代表运动本身，用原子论来描述整体论。递归重点是在定义上，是结构性、声明式为主的状态机定义，而不是过程式编程。</p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Dominoeffect.png/640px-Dominoeffect.png" alt="From wikipedia" style="max-width:40%"><center>为什么所有的骨牌都会最终倒下？</center><h4>“归纳法”与工程代码的割裂</h4><p>我们在递归想象上，强调了分而治之的想法，然而在工程上递归始终是从root一侧开始“绕圈”进行遍历的，本质是<strong>仍然一个环形的迭代</strong>，在DFS一个node一定只会被遍历一次。这就意味着即使你想出了分而治之的思考与递归的定义，物理运动轨迹仍然需要用迭代方案来实现，这种摇摆带来了理解的困难。</p><p>这也意味着，你在工程生产中运用的断点分析、函数式计算等积累的经验均难以使用。个人建议是将思考割裂到底，高阶思考时不需要考虑调用栈、前后序遍历等细节，落地时再分析。</p><h4>Top-down与Bottom-up的思考方式</h4><p>在真实项目管理中，我们通过拆解<code>Milestone</code>-<code>Storoy</code>-<code>Task</code>来制定任务，这是一种典型的Top-down的思考方式，在递归中也一样， 比如计算Tree的深度，等价于先计算Tree的左与右的最大值。然后编码设计状态机，最终执行。</p><p>而Bottom-up的方案，本质是求积分，需要做好时刻的割裂。</p><h2>应试场景</h2><h4>DFS on binary tree</h4><p>当我们对Binary Tree的Node进行处理（解释）时，它的属性只有4个，理论上只要逻辑上处理了4个值，就能解决<strong>所有</strong>的潜在问题。</p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="MINDMAP" height="284px" preserveAspectRatio="none" style="width:653px;height:284px;background:#fff" version="1.1" viewBox="0 0 653 284" width="653px" zoomAndPan="magnify" class="kroki">$2<title>&#26641;&#30340;&#38382;&#39064;&#26522;&#20030;</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="83.9996" x="283.3912" y="32.9951">&#26641;&#30340;&#38382;&#39064;&#26522;&#20030;</text></g><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="54.9385" x="10" y="141.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="34.9385" x="20" y="164.7373">node</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="140.3808" x="114.9385" y="57.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120.3808" x="124.9385" y="80.292">&#31354;(exit condition)</text><path d="M64.9385,159.8906 L74.9385,159.8906 C89.9385,159.8906 89.9385,75.4453 104.9385,75.4453 L114.9385,75.4453" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="47.9999" x="114.9385" y="169.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.9999" x="124.9385" y="192.8857">&#38750;&#31354;</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="135.5065" x="212.9384" y="113.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.5065" x="222.9384" y="136.5889">it.val(&#19968;&#33324;&#20551;&#35774;&#31354;)</text><path d="M162.9384,188.0391 L172.9384,188.0391 C187.9384,188.0391 187.9384,131.7422 202.9384,131.7422 L212.9384,131.7422" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="163.1309" x="212.9384" y="169.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143.1309" x="222.9384" y="192.8857">it.left(exit condition)</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="195.7656" x="426.0692" y="169.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175.7656" x="436.0692" y="192.8857">it.left?.val(exit condition)</text><path d="M376.0692,188.0391 L386.0692,188.0391 C401.0692,188.0391 401.0692,188.0391 416.0692,188.0391 L426.0692,188.0391" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M162.9384,188.0391 L172.9384,188.0391 C187.9384,188.0391 187.9384,188.0391 202.9384,188.0391 L212.9384,188.0391" fill="none" style="stroke:#454645;stroke-width:1"/><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="173.1045" x="212.9384" y="226.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153.1045" x="222.9384" y="249.1826">it.right(exit condition)</text><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:1.5" width="205.7393" x="436.0428" y="226.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185.7393" x="446.0428" y="249.1826">it.right?.val(exit condition)</text><path d="M386.0428,244.3359 L396.0428,244.3359 C411.0428,244.3359 411.0428,244.3359 426.0428,244.3359 L436.0428,244.3359" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M162.9384,188.0391 L172.9384,188.0391 C187.9384,188.0391 187.9384,244.3359 202.9384,244.3359 L212.9384,244.3359" fill="none" style="stroke:#454645;stroke-width:1"/><path d="M64.9385,159.8906 L74.9385,159.8906 C89.9385,159.8906 89.9385,188.0391 104.9385,188.0391 L114.9385,188.0391" fill="none" style="stroke:#454645;stroke-width:1"/></g></svg><p>而所谓的问题，一般是“翻译问题”，和日常拧螺丝的工作并没有本质的区别。值得注意的是，这里一般是用自然语言来描述递归定义（比如 root-to-leaf/inclusive ），你只能用算法/真值表来定义它，难以用亚里士多德的主谓宾的方式来定义。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dfs伪代码，对上面场景的枚举</span></span><br><span class="line"><span class="comment">// Context是上下文，可以为map/array/StringBuilder等，一般需要“fork”创建</span></span><br><span class="line"><span class="comment">// 可以储存tree的深度/用过的值等</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">dfs</span><span class="params">(Node n, Context c)</span>&#123;</span><br><span class="line">  <span class="comment">// exit condition</span></span><br><span class="line">  <span class="keyword">if</span>(isAtomic(n))&#123;</span><br><span class="line">    <span class="comment">// 一般为最下面的叶子/单节点</span></span><br><span class="line">    atomicHook(n, c);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 一般为根节点和中间节点</span></span><br><span class="line">  <span class="keyword">for</span>(child in n.child)&#123;</span><br><span class="line">    <span class="comment">// 遍历到叶子前的积累操作，主要用于处理AnyMatch</span></span><br><span class="line">    preHook(n, child, c);</span><br><span class="line">    dfs(child)</span><br><span class="line">    <span class="comment">// 从叶子向上回溯，直到有子节点为止，一定需要处理AllMatch</span></span><br><span class="line">    postHook(n, child, c);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里执行步骤是反直觉的，同时与“分而治之”的想象是割裂的，是按照如下栈的形式执行的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pre-&gt;pre-&gt;...-&gt;pre(atomic)-&gt;atomic-&gt;post(atomic)-&gt;...-&gt;post-&gt;post</span><br></pre></td></tr></table></figure><p>这里是最难的思考是<code>postHook</code>，可以用给<code>preHook</code>和<code>postHook</code>染色来进行理解。</p><p>这是可能有人就会疑问，这样岂不是变成了死记硬背----当然是这样，for循环加递归这种写法处理时，本质上就是暴力解法，一般会组合爆炸，比较低效，但是高效的算法又是hard的，考起来都完蛋，所以比较尴尬。</p><p>さらに、更高阶思考的《递归与偶然》的作者许煜研究递归耗费10年才写出一本书，刷过leetcode只能证明可以借助模版拧螺丝。在这个前提下，DFS问题就简化为了一个如何在一次迭代中实现某个需求，比如求深度、最大值等。</p><h5>常见DFS问题</h5><p>求Binary Tree的最大高度：</p><p>比如计算“Visible Tree Node”</p><ul><li>Tree的高度：遍历到头时栈的深度</li><li>Tree的三种遍历与反推：建议直接绕过，先了解回溯。</li><li>记录Tree的path</li></ul><h4>Backtracking</h4><p>主要用于排列组合问题（比如n!，必须有序或者独立），这类问题一般会组合爆炸，比较低效，但是高效的算法又是hard的，所以定位上比较尴尬。<br>常见例子有</p><ul><li>find all root-to-leaf paths</li><li>Combinations/Subsets/Combination Sum</li><li>substring</li><li>爬楼梯/Decode Ways（约束条件的爬楼梯）</li></ul><p>这些问题主要就是暴力循环解决，并适当加一些缓存。</p><h2>关键控制流</h2><h4>何时判断null</h4><p>在进行tree的递归时，我们时常会纠结到底用root==null还是root.childs==null，TBD</p><h2>工程优化</h2><h4>缓存优化</h4><p>从参数中选一个或者多个参数，返回值可以消费，比如or运算。</p><h4>DP优化</h4><p>dp中所用的数组本质上是一种层化的时间维度，用运动轨迹来代替其存在</p><h2>运行时的栈（选读）</h2><p>详见<a href="/e0b84a36-b3d6-11ec-a501-edcd1db81294">动态规划与JenkinsCPS技术</a></p><h2>其他</h2><p>更高的难度问题，比如node多次遍历，依据上下文左右选择等，需要<strong>MCTS</strong>等方案。</p></div><div class="tags"><a class="tag-link" href="/tags/Recursion/" rel="tag">Recursion</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry.</a><span> All contents are not allowed to be redistributed or synthesised without an explicit permission.</span></div></footer></div></body></html>