<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="Gradle下载jar包慢到飞起？Github同步一半断了？Docker下载频繁报错？是时候为你的终端统一设置一个代理了。本文以Mac(Unix平台)与HTTP_PROXY为例，讲解如何在终端下进行配置代理。"><meta name="keyword" content="Mac"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>在Mac终端下配置Proxy</title><link rel="icon" href="data:image/svg+xml,%3Csvg width='24' height='28' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext font-size='24' y='24'%3E諺%3C/text%3E%3C/svg%3E" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-102296742-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-102296742-1")</script><meta name="generator" content="Hexo 5.4.0"></head><body><header><div class="header no-print"><div class="header-container"><div class="header-left"><a href="/">諺</a></div><ul class="header-right"><li><a href="/archives">Archives</a></li><li><a href="/tags" rel="nofollow">Tags</a></li><li><a href="/about" rel="nofollow">About</a></li><li><a href="/epistemology" rel="nofollow">認識論</a></li><li><a href="/books" rel="nofollow">読書</a></li><li><a href="/archives" rel="nofollow">zh</a><a href="#" rel="nofollow">/</a><a href="/en" rel="nofollow">en</a></li></ul></div></div></header><div class="container"><div class="content-wrapper"><div class="post"><section class="article"><div class="title">在Mac终端下配置Proxy</div><div class="date">2015-11-21 / modified at 2022-11-12</div><div class="content"><p>Gradle下载jar包慢到飞起？Github同步一半断了？Docker下载频繁报错？是时候为你的终端统一设置一个代理了。本文以Mac(Unix平台)与HTTP_PROXY为例，讲解如何在终端下进行配置代理。</p><span id="more"></span><h2>1. 选择Proxy</h2><p>首先，要购买挑选一个Proxy，购买前需要注意服务商需要能够提供<code>Http Proxy</code>，或者使用转换工具配合SS</p><h2>2. 配置终端</h2><h4>2.1. 打开终端Terminal</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查当前Shell</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$0</span></span><br><span class="line"><span class="comment"># 用bash的终端使用这个文件</span></span><br><span class="line">open -t ~/.bash_profile</span><br><span class="line"><span class="comment"># 如果用zsh的话，用下面的文件，没有就新建一个文件</span></span><br><span class="line">open -t ~/.zshenv</span><br></pre></td></tr></table></figure><blockquote><p>.bash_profile 可以理解为Term打开后能够自动执行的脚本文件</p></blockquote><h4>2.2. 在文本中添加如下内容</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#proxy </span></span><br><span class="line">LANTERN=127.0.0.1:8787</span><br><span class="line">COW=<span class="string">&#x27;127.0.0.1:7777&#x27;</span></span><br><span class="line">LO=<span class="string">&#x27;127.0.0.1:1087&#x27;</span></span><br><span class="line">defp=<span class="variable">$LO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># No Proxy</span></span><br><span class="line"><span class="keyword">function</span> noproxy</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">unset</span> http_proxy HTTP_PROXY https_proxy HTTPS_PROXY all_proxy ALL_PROXY ftp_proxy FTP_PROXY dns_proxy DNS_PROXY JAVA_OPTS GRADLE_OPTS MAVEN_OPTS</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;clear proxy done&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> setproxy</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    inArg=<span class="variable">$defp</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    inArg=<span class="variable">$1</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  HOST=$(<span class="built_in">echo</span> <span class="variable">$inArg</span> |<span class="built_in">cut</span> -d: -f1)</span><br><span class="line">  PORT=$(<span class="built_in">echo</span> <span class="variable">$inArg</span> |<span class="built_in">cut</span> -d: -f2)</span><br><span class="line">  http_proxy=http://<span class="variable">$HOST</span>:<span class="variable">$PORT</span></span><br><span class="line">  HTTP_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">  all_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">  ALL_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">  ftp_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">  FTP_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">  dns_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">  DNS_PROXY=<span class="variable">$http_proxy</span></span><br><span class="line">  https_proxy=<span class="variable">$http_proxy</span></span><br><span class="line">  HTTPS_PROXY=<span class="variable">$https_proxy</span></span><br><span class="line">  JAVA_OPTS=<span class="string">&quot;-Dhttp.proxyHost=<span class="variable">$HOST</span> -Dhttp.proxyPort=<span class="variable">$PORT</span> -Dhttps.proxyHost=<span class="variable">$HOST</span> -Dhttps.proxyPort=<span class="variable">$PORT</span>&quot;</span></span><br><span class="line">  GRADLE_OPTS=<span class="string">&quot;-Dgradle.user.home=<span class="variable">$HOME</span>/.gradle&quot;</span></span><br><span class="line">  MAVEN_OPTS=<span class="variable">$JAVA_OPTS</span></span><br><span class="line">  no_proxy=<span class="string">&quot;.cn,.aliyun.com,localhost,127.0.0.1,localaddress,.huaweicloud.com,.localdomain.com,.coding.net,.ruby-china.org&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;current proxy is <span class="variable">$&#123;http_proxy&#125;</span>&quot;</span> &gt;&gt; /dev/stderr</span><br><span class="line">  <span class="built_in">export</span> no_proxy http_proxy HTTP_PROXY https_proxy HTTPS_PROXY all_proxy ALL_PROXY ftp_proxy FTP_PROXY dns_proxy DNS_PROXY JAVA_OPTS GRADLE_OPTS MAVEN_OPTS</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setproxy</span><br></pre></td></tr></table></figure><h4>2.3. 保存配置</h4><p>重启shell即可</p><blockquote><p>该方法配置好后，在IDEA等工具的<code>终端</code>下同样有用，但是IDEA本身的maven, gradle需要再次配置</p></blockquote><h2>3. 使用</h2><p>打开终端后，默认会提示正在使用默认的<code>$defp</code>地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">current proxy is http://127.0.0.1:8123</span><br></pre></td></tr></table></figure><p>当不需要时，可以执行<code>noproxy</code>以取消</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">noproxy</span> </span><br><span class="line">clear proxy done</span><br></pre></td></tr></table></figure><p>当然可以在某些情况下手动修改地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">setproxy <span class="variable">$depf</span></span></span><br><span class="line">current proxy is http://127.0.0.1:8123</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">setproxy <span class="variable">$LANTERN</span></span></span><br><span class="line">current proxy is http://127.0.0.1:8787</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">setproxy 127.0.0.1:443</span></span><br><span class="line">current proxy is http://127.0.0.1:443</span><br></pre></td></tr></table></figure><h2>4. 查看效果</h2><p>我们可以执行curl的命令，此网站会自动告诉了你当前的位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl https://ifconfig.co/country</span><br><span class="line"><span class="comment"># ==&gt; Hong Kong</span></span><br></pre></td></tr></table></figure><p>我们也可以使用wget/curl进行SpeedTest</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试下载(run speed <span class="built_in">test</span>)</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget -O /dev/null http://speedtest-sfo1.digitalocean.com/10mb.<span class="built_in">test</span></span></span><br></pre></td></tr></table></figure><p>最难折腾的Gradle现在也飞速了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">折腾Gradle项目</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gradle package -d</span></span><br></pre></td></tr></table></figure><p>最后，体验Git，Brew，Gradle等工具的飞速下载吧！</p><blockquote><p>注意：</p><ul><li>亲测Go，Git，Brew，Curl，Wget，NPM是可以正常使用的，可以达到物理带宽</li><li>不支持<code>git://</code>与<code>svn://</code>，那两个是基于socket的，你可以使用cow/ss配置</li><li>如果需要设置内网地址的正则（比如192，10，172），目前暂时没有完美的方案，只能枚举并手动加入<code>no_proxy</code>中</li><li>Gradle是java相关的，用的不是curl，所以需要<code>JAVA_OPTS</code>作为环境变量，注意这个环境变量只是终端的，而不是IDE下的</li></ul></blockquote><h2>附录</h2><h4>Cow的配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/.cow/rc</span><br><span class="line"><span class="comment"># uncomment </span></span><br><span class="line">alwaysProxy=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 启动 </span></span><br><span class="line">$./cow --debug</span><br></pre></td></tr></table></figure><p>可以配置plist使它自动启动</p><h4>Git-ssh配置</h4><p>需要配置如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 或 创建 文件，如下位置  ~/.ssh/config</span></span><br><span class="line">Host github.com</span><br><span class="line">   HostName github.com</span><br><span class="line">   User git</span><br><span class="line">   <span class="comment"># socks5 代理</span></span><br><span class="line">   ProxyCommand nc -v -x 127.0.0.1:1080 %h %p</span><br></pre></td></tr></table></figure><h4>polipo的配置</h4><p>这个主要是配合$$使用的，是目前的主流手段，安装后执行如下命令即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装polipo</span></span><br><span class="line">brew install polipo</span><br><span class="line"><span class="comment"># 执行Socket转换</span></span><br><span class="line">polipo socksParentProxy=localhost:1080</span><br></pre></td></tr></table></figure><blockquote><p>AD: 我目前使用的服务器商<a target="_blank" rel="noopener" href="https://cn1.fengzg.net/#/register?code=q33wVW8X">AFF地址</a> ，一定不要年付，防止跑路</p></blockquote><h4>Intellij下的Gradle/maven配置</h4><p>虽然本文讲的是Terminals的Proxy，但是Intellij的用户也很多。因此也介绍下吧</p><p>首先打开Preference，点击</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Build,Execution,Deployment &gt; Build Tools &gt; Gradle</span><br></pre></td></tr></table></figure><p>配置Gradle VM options(以polipo为例，使用其它工具的自己改端口)</p><p>下文的<code>-d</code>表示啰嗦模式，如果你确认已经ok，可以把它删除。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dhttp.proxyHost=localhost -Dhttp.proxyPort=8123 -Dhttps.proxyHost=localhost -Dhttps.proxyPort=8123 -d</span><br></pre></td></tr></table></figure><p>这样你用鼠标点击Build后，它就会自动走代理了</p><blockquote><p>我个人更推荐直接在终端里跑完(比如mvn package)，然后再打开IDEA，这时所有的依赖已经下载完了</p></blockquote><h4>清空DNS缓存</h4><p>如果仍然无法连接，试试清空DNS。尤其是Git的SSH，非常容易被中间人入侵。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 处理DNS投毒遗留缓存</span></span><br><span class="line">sudo killall -HUP mDNSResponder</span><br></pre></td></tr></table></figure><h4>Docker配置</h4><p>在Mac下推荐使用虚拟机，然后基于Linux进行配置，个人更推荐直接配置mirror（比如<a target="_blank" rel="noopener" href="https://www.daocloud.io/mirror">daocloud</a>），或者搭建一个Harbor/Artifactory作为前置代理<br>Dockerfile本身构建时，建议RUN中硬编码配置apt的mirror，或者<code>-e</code>传入HTTP_PROXY环境。过程中需要下载的二进制也建议通过Artifactory私服实现缓存中转。</p><h4>配置Mirror</h4><p>如果你舍不得钱，可以使用mirror而不用代理，比如<a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/">HuaweiCloud Mirror</a></p><h4>PAC与ACL的区别</h4><p>如下为分类</p><ul><li>手动模式：不配置任何ACL/PAC，均在应用侧（比如mvn/SwitchyOmega/HTTP_PROXY）等手动配置方法进行切换，比如如下是配置了专门开一个火狐上外网，safari只用来上内网，npm下载全部走外网。这个方案也是大型IT企业的外网安全审计方案。</li></ul> <?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="191px" preserveAspectRatio="none" style="width:773px;height:191px;background:#fff" version="1.1" viewBox="0 0 773 191" width="773px" zoomAndPan="magnify" class="kroki">$2<defs/><g><g id="elem_browser1"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="180" x="98" y="78"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="108" y="100.9951">firefox with proxy config</text></g><g id="elem_browser2"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="64" x="156" y="149"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="166" y="171.9951">safarai</text></g><g id="elem_npm"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="179" x="98.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159" x="108.5" y="29.9951">npm with HTTP_PROXY</text></g><g id="elem_ss"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="174" x="412" y="43"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="422" y="65.9951">socket localhost:1080</text></g><g id="elem_bypass"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="105" x="662" y="149"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="672" y="171.9951">DirectServer</text></g><g id="elem_proxy"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="101" x="664" y="43"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="674" y="65.9951">ProxyServer</text></g><g id="elem_user"><ellipse cx="21.5" cy="66.5" fill="#454645" rx="8" ry="8" style="stroke:#454645;stroke-width:.5"/><path d="M21.5,74.5 L21.5,101.5 M8.5,82.5 L34.5,82.5 M21.5,101.5 L8.5,116.5 M21.5,101.5 L34.5,116.5 " fill="none" style="stroke:#454645;stroke-width:.5"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="6" y="130.9951">user</text></g><g id="link_user_browser1"><path d="M37.39,96.15 C50.46,96.15 70.67,96.15 92.06,96.15 " fill="none" id="user-to-browser1" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="96.82,96.15,87.82,92.15,91.82,96.15,87.82,100.15,96.82,96.15" style="stroke:#454645;stroke-width:1"/></g><g id="link_user_browser2"><path d="M37.4,103.64 C52.52,111.15 76.69,122.89 98,132.15 C115.1,139.58 134.33,147.23 150.52,153.47 " fill="none" id="user-to-browser2" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="154.89,155.53,147.9373,148.5544,150.2262,153.7274,145.0532,156.0164,154.89,155.53" style="stroke:#454645;stroke-width:1"/></g><g id="link_user_npm"><path d="M37.39,86.59 C45.88,81.37 56.82,74.99 67,70.15 C85.83,61.2 106.95,52.77 126.16,45.69 " fill="none" id="user-to-npm" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="130.52,43.72,120.6942,43.0461,125.8227,45.4333,123.4355,50.5618,130.52,43.72" style="stroke:#454645;stroke-width:1"/></g><g id="link_npm_ss"><path d="M277.96,35.52 C317.98,40.18 365.2,45.68 405.62,50.39 " fill="none" id="npm-to-ss" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="410.53,51.08,402.0598,46.0544,405.5643,50.495,401.1238,53.9995,410.53,51.08" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="309" y="36.2169">http/socket</text></g><g id="link_browser1_ss"><path d="M278.2,96.64 C310.97,95.84 348.28,93.78 382,89.15 C396.13,87.21 411.06,84.29 425.32,81.05 " fill="none" id="browser1-to-ss" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="429.96,79.75,420.2894,77.8845,425.089,80.8785,422.095,85.678,429.96,79.75" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="309" y="85.2169">http/socket</text></g><g id="link_browser2_bypass"><path d="M220.24,167.15 C305.82,167.15 545.03,167.15 655.82,167.15 " fill="none" id="browser2-to-bypass" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="660.65,167.15,651.65,163.15,655.65,167.15,651.65,171.15,660.65,167.15" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="481" y="163.2169">direct</text></g><g id="link_ss_proxy"><path d="M586.22,61.15 C610.34,61.15 635.91,61.15 657.75,61.15 " fill="none" id="ss-to-proxy" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="662.51,61.15,653.51,57.15,657.51,61.15,653.51,65.15,662.51,61.15" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="617" y="57.2169">ss</text></g></g></svg><ul><li>白名单（bypass）模式：所有流量经过本地socket后，ss侧进行判断，假定所有的国外 IP 都被 GFWed，国外全部代理</li></ul> <?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="183px" preserveAspectRatio="none" style="width:815px;height:183px;background:#fff" version="1.1" viewBox="0 0 815 183" width="815px" zoomAndPan="magnify" class="kroki">$2<defs/><g><g id="cluster_ss"><rect fill="none" height="123" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1" width="191" x="421" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="175" x="429" y="21.9951">socket localhost:1080</text></g><g id="elem_browser"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="195" x="98" y="69.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175" x="108" y="92.8451">browser with proxy config</text></g><g id="elem_npm"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="179" x="106" y="140.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159" x="116" y="163.8451">npm with HTTP_PROXY</text></g><g id="elem_acl"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="89" x="472" y="49.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="482" y="72.8451">ACL Rules</text></g><g id="elem_bypass"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="105" x="704" y="14.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="714" y="37.8451">DirectServer</text></g><g id="elem_proxy"><rect fill="#F1F1F1" height="36.2969" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:.5" width="101" x="706" y="85.85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="716" y="108.8451">ProxyServer</text></g><g id="elem_user"><ellipse cx="21.5" cy="94.35" fill="#454645" rx="8" ry="8" style="stroke:#454645;stroke-width:.5"/><path d="M21.5,102.35 L21.5,129.35 M8.5,110.35 L34.5,110.35 M21.5,129.35 L8.5,144.35 M21.5,129.35 L34.5,144.35 " fill="none" style="stroke:#454645;stroke-width:.5"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="6" y="158.8451">user</text></g><g id="link_user_browser"><path d="M37.46,120.87 C51.99,117.83 75.36,112.94 99.68,107.85 " fill="none" id="user-to-browser" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="104.54,106.62,94.916,104.5273,99.6438,107.6335,96.5376,112.3613,104.54,106.62" style="stroke:#454645;stroke-width:1"/></g><g id="link_user_npm"><path d="M37.46,127.05 C51.99,130 75.36,134.76 99.68,139.71 " fill="none" id="user-to-npm" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="104.54,140.9,96.5216,135.1811,99.641,139.9002,94.9219,143.0196,104.54,140.9" style="stroke:#454645;stroke-width:1"/></g><g id="link_npm_ss"><path d="M285.36,148.7 C331.815,143.31 388.2925,136.7575 433.6725,131.4925 C436.5088,131.1634 439.3017,130.8394 442.046,130.521 C443.4182,130.3618 444.7783,130.204 446.1256,130.0477 " fill="none" id="npm-to-ss" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="446.1256,130.0477,436.7246,127.1116,441.1589,130.6239,437.6466,135.0583,446.1256,130.0477" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="324" y="132.0669">http/socket</text></g><g id="link_browser_ss"><path d="M293.08,98.29 C316.185,100.755 341.3881,103.4425 366.2575,106.0937 C378.6922,107.4194 391.0434,108.7359 403.0073,110.0111 C408.9892,110.6487 414.8742,111.2759 420.6244,111.8887 " fill="none" id="browser-to-ss" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="420.6244,111.8887,412.099,106.9575,415.6526,111.3589,411.2512,114.9124,420.6244,111.8887" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="324" y="97.0669">http/socket</text></g><g id="link_acl_bypass"><path d="M561.43,61.54 C599.79,55.9 655.73,47.67 697.71,41.5 " fill="none" id="acl-to-bypass" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="702.53,40.64,693.0429,37.9952,697.5834,41.3691,694.2095,45.9097,702.53,40.64" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="637" y="42.0669">direct</text></g><g id="link_acl_proxy"><path d="M561.43,74.65 C600.43,80.55 657.6,89.19 699.8,95.58 " fill="none" id="acl-to-proxy" style="stroke:#454645;stroke-width:1"/><polygon fill="#454645" points="704.65,96.46,696.3444,91.1668,699.7055,95.7169,695.1555,99.078,704.65,96.46" style="stroke:#454645;stroke-width:1"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="648" y="82.0669">ss</text></g></g></svg><p>不推荐使用的：多个规则混在一起，难以分析定位</p><ul><li>PAC模式：将判断先交给浏览器，再扔给ss客户端，这里流程变复杂了，而且pac是维护的proxylist，需要频繁更新</li><li>全局模式：所有流量（理论上包括系统更新/下载/QQ/音乐等）都经过本地socket后，全部走外网，也就是所谓的Digital nomad。然而事实上很多应用无法透明地支持（比如curl），因此比较鸡肋。这种场景建议把国内应用扔到虚拟机中，并做二级代理。</li><li>ACL自动：版本与实现非常混乱，不推荐折腾</li></ul></div><div class="tags"><a class="tag-link" href="/tags/Mac/" rel="tag">Mac</a></div></section><div class="comments no-print"><noscript>Please enable JavaScript to view comments.</noscript><script async src="https://giscus.app/client.js" data-repo="miao1007/miao1007.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzA1NTY1MDU=" data-category="General" data-category-id="DIC_kwDOB8giWc4COaTx" data-mapping="url" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous"></script></div></div></div><footer class="no-print"><div class="rights"><a href="/feed.xml" rel="external nofollow">RSS</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" rel="external nofollow" target="_blank">Curry</a><span>.</span></div></footer></div></body></html>